"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{88030:function(e,t,n){n.d(t,{$Y:function(){return S},Mz:function(){return F},T3:function(){return k}});var l=n(57437),a=n(41637),s=n(96507),r=n(14172),o=n(88444),i=n(85269),c=n(46776),d=n(52481),x=n(90053),u=n(2265),h=n(35048),p=n(41125),m=n(16573),j=n(24235),g=n(33343),f=n(50039),y=n(2047),b=n(89366),v=n(561),Z=n(79857),w=n(31863),C=n(11093);function k(e){let t,{omic:n,scatterData:r,mdataCol:o,PCA:i}=e,[c,d]=(0,u.useState)(!1),{OMIC2NAME:Z}=(0,C.S)(),w=(0,u.useRef)(),k=(0,a.tc)().mdataType[o].type;return"categorical"==k&&(t="category"),"numeric"==k&&(t="number"),(0,l.jsxs)(s.Z,{children:[(0,l.jsx)(A,{scatterRef:w,name:Z[n]}),(0,l.jsx)(h.h,{width:"100%",height:400,children:(0,l.jsxs)(p.G,{ref:w,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(m.q,{}),(0,l.jsx)(j.K,{type:t,dataKey:"mdataValue",name:o,allowDuplicatedCategory:!1,children:(0,l.jsx)(g._,{value:o,offset:-10,position:"insideBottom"})}),(0,l.jsx)(f.B,{type:"number",dataKey:"projection",name:"PCA ".concat(i),children:(0,l.jsx)(g._,{value:"PCA ".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(y.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(M,{})}),(0,l.jsx)(b.b,{data:r,fill:x.s[0],children:c&&(0,l.jsx)(v.e,{dataKey:"element",position:"right"})})]})}),(0,l.jsx)(F,{showLabels:c,setShowLabels:d})]})}function S(e){let{omic:t,scatterData:n,selectedPlot2D:a}=e,{OMIC2NAME:r}=(0,C.S)(),o=(0,u.useRef)(),[i,c]=(0,u.useState)(!1);return(0,l.jsxs)(s.Z,{children:[(0,l.jsx)(A,{scatterRef:o,name:r[t]}),(0,l.jsx)(h.h,{width:"100%",height:400,children:(0,l.jsxs)(p.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(m.q,{}),(0,l.jsx)(j.K,{type:"number",dataKey:"x",name:"PCA ".concat(a.x),children:(0,l.jsx)(g._,{value:"PCA ".concat(a.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(f.B,{type:"number",dataKey:"y",name:"PCA ".concat(a.y),children:(0,l.jsx)(g._,{value:"PCA ".concat(a.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(y.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(M,{})}),Object.keys(n).length>1&&(0,l.jsx)(Z.D,{verticalAlign:"top"}),Object.keys(n).map((e,t)=>(0,l.jsx)(b.b,{data:n[e],fill:x.s[t%x.s.length],name:e,children:i&&(0,l.jsx)(v.e,{dataKey:"element",position:"top"})},e))]})}),(0,l.jsx)(s.Z,{sx:{mt:1},children:(0,l.jsx)(F,{showLabels:i,setShowLabels:c})})]})}let F=e=>{let{showLabels:t,setShowLabels:n}=e;return(0,l.jsx)(s.Z,{sx:{mt:0,display:"flex",justifyContent:"center"},children:(0,l.jsxs)(s.Z,{sx:{width:100,textAlign:"center",position:"relative",left:30,border:"0px solid red"},children:[(0,l.jsx)(r.Z,{component:"legend",sx:{pt:0},children:"Show Labels"}),(0,l.jsx)(o.Z,{sx:{position:"relative",top:-10,border:"0px solid red"},checked:t,onChange:e=>{n(e=>!e)},inputProps:{"aria-label":"controlled"}})]})})},M=e=>{let{active:t,payload:n}=e;return t&&n&&n.length?(0,l.jsxs)(s.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(i.Z,{variant:"h8",sx:{display:"block"},children:"".concat(n[0].payload.element)}),(0,l.jsx)(i.Z,{variant:"h9",sx:{display:"block"},children:"".concat(n[0].name,": ").concat("string"==typeof n[0].value?n[0].value:n[0].value.toFixed(3))}),(0,l.jsx)(i.Z,{variant:"h9",sx:{display:"block"},children:"".concat(n[1].name,": ").concat(n[1].value.toFixed(3))})]}):null},A=e=>{let{scatterRef:t,name:n}=e;return(0,l.jsx)(s.Z,{sx:{height:0},children:(0,l.jsx)(s.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,l.jsx)(c.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),l=window.document.createElement("div");l.appendChild(e),(0,w.default)(l,"PCA_Scatter-".concat(n))},sx:{opacity:.5},children:(0,l.jsx)(d.Z,{})})})})}},113:function(e,t,n){n.r(t),n.d(t,{default:function(){return eF}});var l=n(57437),a=n(96507),s=n(54986),r=n(49600),o=n(65498),i=n(47042),c=n(85269),d=n(24094),x=n(2265),u=n(64728),h=n(11093),p=n(41637),m=n(46776),j=n(38939),g=n(23503),f=n(75897),y=n(53514),b=n(77370),v=n(80470),Z=n(57842),w=n(62254),C=n(55183);let k="rgba(200,200,200,0.5)",S=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(k),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(k)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(k)}}),F={textAlign:"center",padding:.5,border:"1px solid ".concat(k),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},M=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),A=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function L(e){let{anova:t,explained_variance:n,setSelectedPlot:s,selectedCell:r,setSelectedCell:o,scatterMode:i,factorNames:c,colNames:d,rowNames:u}=e,{OMIC2NAME:L}=(0,h.S)(),{omics:D}=(0,p.tc)(),P=S(i),O=(0,x.useMemo)(()=>u.map(e=>c.map(n=>t[n][e].pvalue)),[t,u,c]),N=(0,x.useMemo)(()=>D.reduce((e,t)=>({...e,[t]:c.map(e=>n[t][e].Explained_Variance)}),{}),[n,c,D]),R=(e,t)=>{"2D"!=i&&(o({rowIndex:e,colIndex:t}),s({mdataCol:u[e],Factor:c[t]}),console.log("Plot scatter: MOFA ".concat(c[t]," vs ").concat(u[e])))},I=(0,x.useMemo)(()=>{let e=[];e.push(["Factor / Cond.",...d]),D.map(t=>e.push(["%Var (".concat(t.toUpperCase(),")"),...N[t]]));let t=O.map((e,t)=>[u[t],...e]);return e=[...e,...t]},[d,O,u,D,N]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,l.jsx)(m.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,l.jsx)(C.CSVLink,{data:I,filename:"MOFA_Anova_pvalues.csv",separator:",",children:(0,l.jsx)(w.Z,{})})})}),(0,l.jsxs)(j.ZP,{container:!0,children:[(0,l.jsx)(j.ZP,{item:!0,xs:2,children:(0,l.jsx)(g.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(y.Z,{children:(0,l.jsx)(b.Z,{children:(0,l.jsx)(v.Z,{sx:{padding:0,textAlign:"center"},children:"Factor / Cond."})})}),(0,l.jsxs)(Z.Z,{children:[D.map((e,t)=>(0,l.jsx)(b.Z,{children:(0,l.jsx)(v.Z,{sx:{padding:0,border:0},children:(0,l.jsxs)(a.Z,{sx:{...F,borderBottom:t==D.length-1&&"1px solid rgba(10,10,10,1)"},children:["%Var (",L[e].slice(0,4),".)"]})})},e)),u.map((e,t)=>(0,l.jsx)(b.Z,{children:(0,l.jsx)(v.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(a.Z,{sx:F,children:e})})},t))]})]})})}),(0,l.jsx)(j.ZP,{item:!0,xs:10,children:(0,l.jsx)(g.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(y.Z,{children:(0,l.jsx)(b.Z,{children:d.map((e,t)=>(0,l.jsx)(v.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:e},t))})}),(0,l.jsxs)(Z.Z,{children:[D.map(e=>N[e]).map((e,t)=>(0,l.jsx)(b.Z,{children:e.map((e,n)=>(0,l.jsx)(v.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(a.Z,{sx:{padding:.5,border:"1px solid ".concat(k),borderBottom:t==D.length-1&&"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:A(e),userSelect:"none"},children:e.toFixed(2)})},n))},t)),O.map((e,t)=>(0,l.jsx)(b.Z,{children:e.map((e,n)=>(0,l.jsx)(v.Z,{sx:{padding:0,border:0},onClick:()=>R(t,n),children:(0,l.jsx)(a.Z,{sx:r&&r.rowIndex===t&&r.colIndex===n?{...P.cell,...P.selectedCell,...M(e)}:{...P.cell,...M(e)},children:e<.001?e.toExponential(3):e.toFixed(3)})},n))},t))]})]})})})]})]})}var D=n(50294);function P(e){let{factorNames:t,rowNames:n,selectedPlot2D:s,setSelectedPlot2D:r}=e,o=(0,u.mX)(),{mdataType:i}=(0,p.tc)();return(0,l.jsxs)(a.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)(a.Z,{sx:{width:"25%"},children:(0,l.jsx)(D.$S,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,x:e.value})),o({type:"set-selected-plot-2d-mofa",mode:{...s,x:e.value}})},value:{label:"".concat(s.x),value:s.x},label:"X axis"})}),(0,l.jsx)(a.Z,{sx:{width:"25%"},children:(0,l.jsx)(D.$S,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,y:e.value})),o({type:"set-selected-plot-2d-mofa",mode:{...s,y:e.value}})},value:{label:"".concat(s.y),value:s.y},label:"Y axis"})}),(0,l.jsx)(a.Z,{sx:{width:"40%"},children:(0,l.jsx)(D.$S,{options:[{label:"No color",value:"No color"},...n.filter(e=>"categorical"==i[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),o({type:"set-selected-plot-2d-mofa",mode:{...s,g:e.value}})},value:{label:s.g,value:s.g},label:"Color by"})})]})}function O(e){let{factorNames:t,rowNames:n,selectedPlot:s,setSelectedPlot:r,setSelectedCell:o}=e;(0,u.mX)();let{mdataType:i}=(0,p.tc)();return(0,l.jsxs)(a.Z,{sx:{height:75,display:"flex",justifyContent:"space-around"},children:[(0,l.jsx)(a.Z,{sx:{width:"25%"},children:(0,l.jsx)(D.$S,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,Factor:e.value})),o(n=>({...n,colIndex:t.map((e,t)=>[e,t]).filter(t=>t[0]==e.value)[0][1]}))},value:{label:"".concat(s.Factor),value:s.Factor},label:"Factor"})}),(0,l.jsx)(a.Z,{sx:{width:"40%"},children:(0,l.jsx)(D.$S,{options:n.filter(e=>"categorical"==i[e].type).map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,mdataCol:e.value})),o(t=>({...t,rowIndex:n.map((e,t)=>[e,t]).filter(t=>t[0]==e.value)[0][1]}))},value:{label:s.mdataCol,value:s.mdataCol},label:"Group by"})})]})}var N=n(92233),R=n(5301),I=function(e){let{scatterMode:t,setScatterMode:n,disable2D:s}=e,r=(0,u.mX)();return(0,l.jsx)(a.Z,{sx:{textAlign:"center"},children:(0,l.jsx)(a.Z,{sx:{mb:2},children:(0,l.jsxs)(N.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{n(e.target.value),r({type:"set-scatter-mode-mofa",mode:e.target.value})},"aria-label":"Platform",children:[(0,l.jsx)(R.Z,{value:"1D",children:"1D"}),(0,l.jsx)(R.Z,{value:"2D",disabled:s,children:"2D"})]})})})},_=n(90053),z=n(35048),E=n(41125),K=n(16573),B=n(24235),T=n(33343),V=n(50039),q=n(2047),H=n(89366),G=n(561),X=n(79857),$=n(2678),W=n(88030);let Y=e=>{let{active:t,payload:n}=e;return t&&n&&n.length?(0,l.jsxs)(a.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(c.Z,{variant:"h8",sx:{display:"block"},children:"".concat(n[0].payload.element)}),(0,l.jsx)(c.Z,{variant:"h9",sx:{display:"block"},children:"".concat(n[0].name,": ").concat("string"==typeof n[0].value?n[0].value:n[0].value.toFixed(3))}),(0,l.jsx)(c.Z,{variant:"h9",sx:{display:"block"},children:"".concat(n[1].name,": ").concat(n[1].value.toFixed(3))})]}):null};function Q(e){let t,{scatterData:n,mdataCol:s,Factor:r}=e,[o,i]=(0,x.useState)(!1),c=(0,x.useRef)(),d=(0,p.tc)().mdataType[s].type;return"categorical"==d&&(t="category"),"numeric"==d&&(t="number"),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(W.Mz,{showLabels:o,setShowLabels:i}),(0,l.jsx)($.L,{scatterRef:c,fileName:"MOFA_Scatter_1D"}),(0,l.jsx)(z.h,{width:"100%",height:400,children:(0,l.jsxs)(E.G,{ref:c,margin:{top:5,right:20,bottom:20,left:20},children:[(0,l.jsx)(K.q,{}),(0,l.jsx)(B.K,{type:t,dataKey:"mdataValue",name:s,allowDuplicatedCategory:!1,children:(0,l.jsx)(T._,{value:s,offset:-10,position:"insideBottom"})}),(0,l.jsx)(V.B,{type:"number",dataKey:"projection",name:"".concat(r),children:(0,l.jsx)(T._,{value:"".concat(r),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(q.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(Y,{})}),(0,l.jsx)(H.b,{data:n,fill:_.s[0],children:o&&(0,l.jsx)(G.e,{dataKey:"element",position:"right"})})]})})]})}function U(e){let{scatterData:t,selectedPlot2D:n}=e,[s,r]=(0,x.useState)(!1),o=(0,x.useRef)();return(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(W.Mz,{showLabels:s,setShowLabels:r}),(0,l.jsx)($.L,{scatterRef:o,fileName:"MOFA_Scatter_2D"}),(0,l.jsx)(z.h,{width:"100%",height:400,children:(0,l.jsxs)(E.G,{ref:o,margin:{top:5,right:20,bottom:20,left:20},children:[(0,l.jsx)(K.q,{}),(0,l.jsx)(B.K,{type:"number",dataKey:"x",name:"".concat(n.x),children:(0,l.jsx)(T._,{value:"".concat(n.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(V.B,{type:"number",dataKey:"y",name:"".concat(n.y),children:(0,l.jsx)(T._,{value:"".concat(n.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(q.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(Y,{})}),Object.keys(t).length>1&&(0,l.jsx)(X.D,{verticalAlign:"top"}),Object.keys(t).map((e,n)=>(0,l.jsx)(H.b,{data:t[e],fill:_.s[n%_.s.length],name:e,children:s&&(0,l.jsx)(G.e,{dataKey:"element",position:"top"})},e))]})})]})}let J=(e,t,n,l,a,s)=>{let r=null;if(n&&"1D"==t){r=[];let t=a.column(n.mdataCol),l={};t.index.map((e,n)=>{l[e]=t.values[n]}),Object.keys(e).map(t=>{r.push({element:t,mdataValue:l[t],projection:e[t][n.Factor]})})}else"2D"==t&&(r={},Object.keys(s).includes(l.g)?s[l.g].levels.map(t=>{r[t]=[...s[l.g].level2id[t].map(t=>Object.keys(e).includes(t)?{element:t,x:e[t][l.x],y:e[t][l.y]}:null).filter(e=>null!=e)]}):r[l.g]=Object.keys(e).map(t=>({element:t,x:e[t][l.x],y:e[t][l.y]})));return r};var ee=function(e){let{scatterMode:t,setScatterMode:n,selectedPlot:s,setSelectedPlot:r,setSelectedCell:o,selectedPlot2D:i,setSelectedPlot2D:c,factorNames:d,rowNames:u,projections:h}=e,{mdata:m}=(0,p.tc)().user,{mdataType:g}=(0,p.tc)(),f=(0,x.useMemo)(()=>J(h,t,s,i,m,g),[h,t,s,i,m,g]);return(0,l.jsxs)(j.ZP,{container:!0,children:[(0,l.jsxs)(j.ZP,{sx:{pt:2},item:!0,xs:6,children:[(0,l.jsx)(I,{scatterMode:t,setScatterMode:n,disable2D:Object.keys(Object.values(h)[0]).length<2}),(0,l.jsx)(a.Z,{sx:{px:3,pt:7,textAlign:"center"},children:"1D"==t?(0,l.jsx)(O,{factorNames:d,rowNames:u,selectedPlot:s,setSelectedPlot:r,setSelectedCell:o}):(0,l.jsx)(P,{factorNames:d,rowNames:u,selectedPlot2D:i,setSelectedPlot2D:c})})]}),(0,l.jsx)(j.ZP,{item:!0,xs:6,children:f&&(0,l.jsx)(a.Z,{sx:{height:470},children:"1D"==t?(0,l.jsx)(Q,{scatterData:f,mdataCol:s.mdataCol,Factor:s.Factor}):(0,l.jsx)(U,{scatterData:f,selectedPlot2D:i})})})]})},et=n(13716),en=n(73295),el=n(67248),ea=n(38227),es=n(20003),er=n(27978),eo=n(19223),ei=n(15632);function ec(e){return"".concat(e)}var ed=function(e){let{omic:t,fLVec:n,nFeatRef:s,thrLRef:r,plotHeatMap:o}=e,[i,d]=(0,x.useState)({down:0,up:0}),[u,h]=(0,x.useState)({down:0,up:0});(0,x.useEffect)(()=>{let e={down:Math.floor(.01*n.length),up:Math.floor(.01*n.length)};h(e),s.current[t]=e;let l={down:n[e.down][1],up:n[n.length-e.up-1][1]};d(l),r.current[t]=l},[n,s,t,r]),(0,x.useEffect)(()=>{let e=setTimeout(o,100);return()=>clearInterval(e)},[u,o]);let p=(0,x.useMemo)(()=>{let e=Math.min(200,n.length),t=Math.floor(n.length/e);return n.map(e=>({f:e[0],loading:Math.floor(1e4*e[1])/1e4,quantile:e[2]})).filter((e,l)=>l%t==0||l==n.length-1).map(e=>e.loading>i.down&&e.loading<i.up?{...e,qNS:e.quantile}:{...e,qS:e.quantile})},[n,i]),m=e=>{let[l,a]=e,o={down:Math.min(l,0),up:Math.max(a,0)};d(o),r.current[t]=o;let i={down:n.filter(e=>e[1]<o.down).length,up:n.filter(e=>e[1]>o.up).length};h(i),s.current[t]=i},j=e=>{if(e<0){d(t=>({...t,down:e})),r.current[t].down=e;let l=n.filter(t=>t[1]<e).length;h(e=>({...e,down:l})),s.current[t].down=l}else{d(t=>({...t,up:e})),r.current[t].up=e;let l=n.filter(t=>t[1]>e).length;h(e=>({...e,up:l})),s.current[t].up=l}},g=(e,l)=>{let a=parseInt(e);if(isNaN(a)){h(e=>({...e,[l]:0}));return}if("down"==l){let e=n.filter(e=>e[1]<0);a>=0&&a<e.length?(h(e=>({...e,down:a})),s.current[t].down=a,d(t=>({...t,down:e[a][1]})),r.current[t].down=e[a][1]):a>=e.length&&(h(t=>({...t,down:e.length})),s.current[t].down=e.length,d(e=>({...e,down:0})),r.current[t].down=0)}if("up"==l){let e=n.filter(e=>e[1]>0);a>=0&&a<e.length?(h(e=>({...e,up:a})),s.current[t].up=a,d(t=>({...t,up:e[e.length-a-1][1]})),r.current[t].up=e[e.length-a-1][1]):a<0?(h(e=>({...e,up:0})),s.current[t].up=0,d(t=>({...t,up:e[e.length-1][1]})),r.current[t].up=e[e.length-1][1]):a>=e.length&&(h(t=>({...t,up:e.length})),s.current[t].up=e.length,d(e=>({...e,up:0})),r.current[t].up=0)}},f=Math.ceil(1e3*Math.max(Math.abs(n[0][1]),Math.abs(n[n.length-1][1])))/1e3;return(0,l.jsx)(a.Z,{sx:{overflow:"auto"},children:(0,l.jsxs)(a.Z,{sx:{mt:1,display:"block",m:"auto",width:400},children:[(0,l.jsx)(a.Z,{sx:{width:400,position:"relative"},children:(0,l.jsxs)(ea.w,{data:p,margin:{top:5,right:30,left:20,bottom:20},width:400,height:200,onClick:e=>null!=e&&j(e.activeLabel),children:[(0,l.jsx)(K.q,{strokeDasharray:"3 3"}),(0,l.jsx)(B.K,{dataKey:"loading",type:"number",name:"Loadings",domain:[-f,f],label:{value:"Loading",position:"insideBottom",offset:-10},ticks:(0,ei.jI)(-f,f,6)}),(0,l.jsx)(V.B,{type:"number",label:{value:"Quantile",position:"insideLeft",angle:-90,dy:30,offset:-5}}),(0,l.jsx)(es.z,{x1:i.down,x2:i.up,y1:0,y2:1}),(0,l.jsx)(er.d,{x:0,stroke:"#333333",strokeDasharray:"3 3"}),(0,l.jsx)(eo.x,{type:"monotone",dataKey:"quantile",stroke:"#aaaaaa",dot:!1,strokeWidth:1}),(0,l.jsx)(eo.x,{type:"monotone",dataKey:"qS",stroke:"#8884d8",dot:!1,strokeWidth:3})]})}),(0,l.jsx)(a.Z,{sx:{width:290,position:"relative",left:80},children:(0,l.jsx)(en.ZP,{track:"inverted",value:[Math.floor(1e3*i.down)/1e3,Math.ceil(1e3*i.up)/1e3],getAriaValueText:ec,valueLabelDisplay:"auto",step:.001,min:-f,max:f,onChange:e=>m(e.target.value)})}),(0,l.jsxs)(a.Z,{sx:{width:290,position:"relative",left:80,display:"flex",textAlign:"center",justifyContent:"space-around"},children:[(0,l.jsxs)(a.Z,{sx:{width:"33%"},children:[(0,l.jsx)(c.Z,{variant:"body2",children:"Negatively Associated"}),(0,l.jsx)(el.Z,{size:"small",value:u.down,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>g(e.target.value,"down")})]}),(0,l.jsxs)(a.Z,{sx:{width:"33%"},children:[(0,l.jsx)(c.Z,{variant:"body2",children:"Positively Associated"}),(0,l.jsx)(el.Z,{size:"small",value:u.up,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>g(e.target.value,"up")})]})]})]})})},ex=function(e){let{fLVec:t,nFeatRef:n,thrLRef:s,plotHeatMap:r}=e,{omics:o}=(0,p.tc)(),{OMIC2NAME:i}=(0,h.S)();return(0,l.jsx)(a.Z,{sx:{my:3,display:"flex",justifyContent:"space-evenly"},children:o.map((e,o)=>(0,l.jsxs)(a.Z,{sx:{width:"31%"},children:[(0,l.jsx)(c.Z,{variant:"h6",sx:{textAlign:"center"},children:i[e]}),(0,l.jsx)(ed,{omic:e,fLVec:t[e],nFeatRef:n,thrLRef:s,plotHeatMap:r})]},o))})},eu=n(63870);function eh(e){let{omic:t,myIndex:n,myFeat:s,mdataCol:r,zLegend:o}=e,i=2*(0,p.tc)().omics.length,c=(0,p.tc)().norm["x".concat(t)],d=(0,p.tc)().mdataType[r],u=(0,x.useMemo)(()=>em(n,s,c,d),[n,s,c,d]);return(0,l.jsx)(a.Z,{sx:{height:510,width:1160/i,marginRight:.5,border:"2px solid #444444"},children:(0,l.jsx)(eu.Tu,{data:u,margin:{top:0,right:0,bottom:0,left:0},axisTop:{tickSize:0,tickPadding:0,tickRotation:0,legend:"",legendOffset:0},colors:{type:"diverging",scheme:"red_blue",minValue:o.min,maxValue:o.max},emptyColor:"#555555",isInteractive:!1,animate:!1,enableLabels:!1})})}let ep=e=>{let{myIndex:t,mdataCol:n,showBorder:a,showLevel:s}=e,r=(0,p.tc)().mdataType[n],o=(0,x.useMemo)(()=>em(t,[],null,r),[t,r]),i=[];i=s?o.map(e=>e.id.split("##")).map(e=>e[e.length-1]):o.map(e=>e.id.split("##")).map(e=>e.slice(0,-1).join("##"));let d={};i.forEach(e=>{d[e]=(d[e]||0)+1});let u=[...new Set(i)];return(0,l.jsx)("table",{children:(0,l.jsx)("tbody",{children:u.map((e,t)=>(0,l.jsx)("tr",{style:{height:500*d[e]/i.length,borderTop:a&&"2px solid #444444",borderBottom:a&&"2px solid #444444"},children:(0,l.jsx)("td",{style:{paddingRight:5},children:(0,l.jsx)(c.Z,{variant:"h7",children:e})})},t))})})},em=(e,t,n,l)=>{let a={};return e.map(e=>{a[e]=[]}),t.map(t=>{let l=n.column(t);l.index.map((e,t)=>[e,l.values[t]]).filter(t=>e.includes(t[0])).map(e=>{a[e[0]].push({x:t,y:-e[1]})})}),"categorical"==l.type?a=l.levels.map(t=>l.level2id[t].filter(t=>e.includes(t)).map(e=>({id:"".concat(e,"##").concat(t),data:a[e]}))).flat():"numeric"==l.type&&(a=e.map(e=>({id:e,data:a[e]}))),a};var ej=function(e){let{nFeatRef:t}=e,{OMIC2NAME:n}=(0,h.S)(),s=(0,p.tc)().omics;return(0,l.jsxs)(a.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,l.jsx)(a.Z,{sx:{width:"5%"}}),s.map(e=>(0,l.jsx)(a.Z,{children:(t.current[e].up>0||t.current[e].down>0)&&(0,l.jsxs)(a.Z,{sx:{marginRight:.5},children:[(0,l.jsx)(a.Z,{children:(0,l.jsx)(c.Z,{variant:"h6",children:n[e]})}),(0,l.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current[e].down>0&&(0,l.jsx)(a.Z,{sx:{width:1160/(2*s.length),marginRight:.5},children:(0,l.jsx)(a.Z,{children:"Negatively Associated"})}),t.current[e].up>0&&(0,l.jsx)(a.Z,{sx:{width:1160/(2*s.length)},children:(0,l.jsx)(a.Z,{children:"Positively Associated"})})]})]},e)},e)),(0,l.jsx)(a.Z,{sx:{width:"5%"}})]})};let eg=e=>{let{a:t,b:n,updateZLegend:a,omic:s,plotHeatMap:r}=e,[o,i]=(0,x.useState)({min:t,max:n}),c=(0,u.mX)(),d=(t+n)/2,h={display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:"10px",background:"linear-gradient(to right, ".concat("#1f4e79",", ").concat("rgb(255, 255, 255)"," ").concat((d-t)/(n-t)*100,"%, ").concat("#9e2a2b",")"),color:"#fff",height:"15px"},p=(e,t)=>{let n=Number(t);i(n=>({...n,[e]:t})),"number"!=typeof n||isNaN(n)||(a(t=>{t[s][e]=n}),c({type:"update-zlegend",omic:s,minmax:e,numValue:n}),r())};return(0,l.jsxs)("div",{style:h,children:[(0,l.jsx)("div",{children:(0,l.jsx)("input",{type:"text",style:{width:30,height:20,textAlign:"center"},value:o.min,onChange:e=>p("min",e.target.value)})}),(0,l.jsx)("div",{style:{color:"black"},children:d.toFixed(0)}),(0,l.jsx)("div",{children:(0,l.jsx)("input",{type:"text",style:{width:30,height:20,textAlign:"center"},value:o.max,onChange:e=>p("max",e.target.value)})})]})};var ef=e=>{let{nFeatRef:t,zLegend:n,updateZLegend:s,plotHeatMap:r}=e,o=(0,p.tc)().omics;return(0,l.jsxs)(a.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,l.jsx)(a.Z,{sx:{width:"5%"}}),o.map(e=>(0,l.jsx)(a.Z,{sx:{mr:.7},children:(t.current[e].up>0||t.current[e].down>0)&&(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(eg,{a:n[e].min,b:n[e].max,updateZLegend:s,omic:e,plotHeatMap:r}),(0,l.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current[e].down>0&&(0,l.jsx)(a.Z,{sx:{width:1160/(2*o.length)}}),t.current[e].up>0&&(0,l.jsx)(a.Z,{sx:{width:1160/(2*o.length)}})]})]})},e)),(0,l.jsx)(a.Z,{sx:{width:"5%"}})]})},ey=n(36970),eb=function(e){let{nFeatRef:t,fLVec:n,mdataCol:s,plotHM:r,plotHeatMap:o}=e,{omics:i}=(0,p.tc)(),c=(0,p.tc)().user.mdata.shape[0]<=24;(0,p.tc)().user.mdata.columns[0];let d=(0,u.a0)().MOFA.displayOpts.zLegend,[h,m]=(0,ey.x)(i.reduce((e,t)=>({...e,[t]:{min:d[t].min,max:d[t].max}}),{})),j=(0,p.tc)().norm,g=(0,x.useMemo)(()=>i.map(e=>j["x".concat(e)].index).reduce((e,t)=>e.filter(e=>t.includes(e))),[i,j]),f=(0,x.useMemo)(()=>{console.log(r);let e={};return console.log(n),i.map(l=>{e[l]={down:n[l].filter((e,n)=>n<t.current[l].down).map(e=>e[0]),up:n[l].filter((e,a)=>a>=n[l].length-t.current[l].up).map(e=>e[0])}}),e},[i,t,n,r]);return(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(ej,{nFeatRef:t}),(0,l.jsxs)(a.Z,{sx:{mt:1,display:"flex",justifyContent:"center"},children:[(0,l.jsx)(a.Z,{sx:{width:"5%",display:"flex",justifyContent:"flex-end"},children:(0,l.jsx)(ep,{myIndex:g,mdataCol:s,showBorder:!0,showLevel:!0})}),i.map(e=>(0,l.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"center"},children:[t.current[e].down>0&&(0,l.jsx)(eh,{omic:e,myIndex:g,myFeat:f[e].down,mdataCol:s,zLegend:h[e]}),t.current[e].up>0&&(0,l.jsx)(eh,{omic:e,myIndex:g,myFeat:f[e].up,mdataCol:s,zLegend:h[e]})]},e)),(0,l.jsx)(a.Z,{sx:{width:"5%",display:"flex",justifyContent:"flex-start"},children:c&&(0,l.jsx)(ep,{myIndex:g,mdataCol:s,showBorder:!1,showLevel:!1})})]}),(0,l.jsx)(ef,{nFeatRef:t,zLegend:h,updateZLegend:m,plotHeatMap:o})]})},ev=n(98864),eZ=n.n(ev);let ew=eZ()(()=>Promise.all([n.e(813),n.e(30),n.e(378),n.e(791)]).then(n.bind(n,86455)),{loadableGenerated:{webpack:()=>[86455]}}),eC=e=>{if(null==e)return[null,null];let t=Object.keys(e.anova),n=t.map((e,t)=>t+1);return[n,t]},ek=(e,t)=>null==e?null:Object.keys(e.anova[t[0]]).map(n=>[n,t.map(t=>0==Object.keys(e.anova[t][n]).length).every(e=>e)]).filter(e=>!e[1]).map(e=>e[0]),eS=(e,t,n)=>{if(null==e||null==t)return null;let l=n.reduce((e,t)=>({...e,[t]:[]}),{});return Object.keys(l).map(n=>{l[n]=Object.keys(e.loadings[n][t.Factor]).map(l=>[l,e.loadings[n][t.Factor][l]]),l[n].sort((e,t)=>e[1]-t[1]),l[n]=l[n].map((e,t)=>[...e,(t+1)/l[n].length])}),l};var eF=function(){let e=(0,u.mX)(),{API_URL:t}=(0,h.S)(),{jobID:n}=(0,p.tc)(),m=(0,u.a0)().MOFA.data,[j,g]=(0,x.useState)(m),f=(0,u.a0)().MOFA.displayOpts.scatterMode,[y,b]=(0,x.useState)(f),v=(0,u.a0)().MOFA.displayOpts.selectedPlot,[Z,w]=(0,x.useState)(v),C=(0,u.a0)().MOFA.displayOpts.selectedCell,[k,S]=(0,x.useState)(C),F=(0,u.a0)().MOFA.displayOpts.selectedPlot2D,[M,A]=(0,x.useState)(F),D=(0,x.useCallback)(async()=>{if(console.log("Fetching MOFA data"),null==m){let l=await fetch("".concat(t,"/get_mofa/").concat(n)),a=await l.json();g(a.dataMOFA),e({type:"set-mofa-data",data:a.dataMOFA})}},[m,t,e,n]);(0,x.useEffect)(()=>{let e=setTimeout(D,100);return()=>clearTimeout(e)},[D]);let[P,O]=(0,x.useMemo)(()=>eC(j),[j]),N=(0,x.useMemo)(()=>ek(j,O),[j,O]);null!=O&&null!=N&&null==Z&&(w({mdataCol:N[0],Factor:O[0]}),S({rowIndex:0,colIndex:0})),(0,x.useEffect)(()=>{if(null!=O&&null!=N&&null==M){let t={x:O[0],y:O.length>1?O[1]:O[0],g:"No color"};A(t),e({type:"set-selected-plot-2d-mofa",mode:t})}},[O,N,M,e]);let[R,I]=(0,x.useState)(!1),_=(0,x.useCallback)(()=>{console.log("Refresh"),I(e=>!e)},[I]);(0,x.useEffect)(()=>{let e=setTimeout(_,1e3);return()=>clearTimeout(e)},[I,_]),(0,x.useEffect)(()=>{null!=Z&&null!=k&&(_(),e({type:"set-selected-plot-cell-mofa",rowIndex:k.rowIndex,colIndex:k.colIndex,mdataCol:Z.mdataCol,Factor:Z.Factor}))},[Z,k,e,_]);let{omics:z}=(0,p.tc)(),E=(0,x.useRef)(z.reduce((e,t)=>({...e,[t]:{down:0,up:0}}),{})),K=(0,x.useRef)(z.reduce((e,t)=>({...e,[t]:{down:0,up:0}}),{})),B=(0,x.useMemo)(()=>eS(j,Z,z),[j,Z,z]),[T,V]=(0,x.useState)(!1),[q,H]=(0,x.useState)(!1);return(0,l.jsx)(a.Z,{children:(0,l.jsx)(et.c,{height:"80vh",children:null!=j&&null!=Z&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(et.E,{children:(0,l.jsx)(a.Z,{sx:{p:5},children:(0,l.jsx)(L,{anova:j.anova,explained_variance:j.explained_variance,setSelectedPlot:w,selectedCell:k,setSelectedCell:S,scatterMode:y,rowNames:N,colNames:P,factorNames:O})})}),(0,l.jsxs)(et.E,{children:[(0,l.jsx)(s.Z,{children:"Projections"}),(0,l.jsx)(a.Z,{sx:{mt:2},children:(0,l.jsx)(ee,{scatterMode:y,setScatterMode:b,selectedPlot:Z,setSelectedPlot:w,setSelectedCell:S,selectedPlot2D:M,setSelectedPlot2D:A,rowNames:N,factorNames:O,projections:j.projections})})]}),"1D"==y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(et.E,{sx:{mt:1},children:[(0,l.jsxs)(s.Z,{variant:"h6",sx:{textAlign:"center"},children:["Feature Loading Analysis: ",Z.Factor]}),(0,l.jsx)(ex,{fLVec:B,nFeatRef:E,thrLRef:K,plotHeatMap:_})]}),(0,l.jsxs)(et.E,{children:[(0,l.jsx)(s.Z,{children:"HeatMap"}),(0,l.jsx)(eb,{nFeatRef:E,fLVec:B,mdataCol:Z.mdataCol,plotHM:R,plotHeatMap:_})]}),(0,l.jsxs)(et.E,{children:[(0,l.jsx)(a.Z,{sx:{textAlign:"center",mt:2},children:(0,l.jsx)(r.Z,{color:"primary",variant:"outlined",endIcon:(0,l.jsx)(d.Z,{}),onClick:()=>{H(!0),V(!0)},children:"Explore Features"})}),(0,l.jsx)(o.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:q,children:(0,l.jsxs)(a.Z,{sx:{textAlign:"center"},children:[(0,l.jsx)(i.Z,{color:"inherit"}),(0,l.jsx)(a.Z,{sx:{pt:2},children:(0,l.jsx)(c.Z,{children:"Loading features..."})})]})}),T&&(0,l.jsx)(ew,{exploreF:T,setExploreF:V,Factor:Z.Factor,mdataCol:Z.mdataCol,thrLRef:K.current,setEFLoading:H})]})]})]})})})}},2678:function(e,t,n){n.d(t,{L:function(){return i}});var l=n(57437),a=n(96507),s=n(46776),r=n(52481),o=n(31863);let i=e=>{let{scatterRef:t,fileName:n}=e;return(0,l.jsx)(a.Z,{sx:{height:0},children:(0,l.jsx)(a.Z,{sx:{width:50,position:"relative",top:0,zIndex:500},children:(0,l.jsx)(s.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),l=window.document.createElement("div");l.appendChild(e),(0,o.default)(l,n)},sx:{opacity:.5},children:(0,l.jsx)(r.Z,{})})})})}}}]);