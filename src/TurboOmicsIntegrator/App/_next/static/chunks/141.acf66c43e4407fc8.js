"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{88030:function(e,t,a){a.d(t,{$Y:function(){return S},Mz:function(){return P},T3:function(){return A}});var l=a(57437),n=a(41637),s=a(96507),r=a(14172),o=a(88444),i=a(85269),c=a(46776),d=a(52481),u=a(90053),x=a(2265),h=a(35048),p=a(41125),m=a(16573),j=a(24235),g=a(33343),b=a(50039),f=a(2047),y=a(89366),v=a(561),C=a(79857),Z=a(31863),w=a(11093);function A(e){let t,{omic:a,scatterData:r,mdataCol:o,PCA:i}=e,[c,d]=(0,x.useState)(!1),{OMIC2NAME:C}=(0,w.S)(),Z=(0,x.useRef)(),A=(0,n.tc)().mdataType[o].type;return"categorical"==A&&(t="category"),"numeric"==A&&(t="number"),(0,l.jsxs)(s.Z,{children:[(0,l.jsx)(D,{scatterRef:Z,name:C[a]}),(0,l.jsx)(h.h,{width:"100%",height:400,children:(0,l.jsxs)(p.G,{ref:Z,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(m.q,{}),(0,l.jsx)(j.K,{type:t,dataKey:"mdataValue",name:o,allowDuplicatedCategory:!1,children:(0,l.jsx)(g._,{value:o,offset:-10,position:"insideBottom"})}),(0,l.jsx)(b.B,{type:"number",dataKey:"projection",name:"PCA ".concat(i),children:(0,l.jsx)(g._,{value:"PCA ".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(f.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(k,{})}),(0,l.jsx)(y.b,{data:r,fill:u.s[0],children:c&&(0,l.jsx)(v.e,{dataKey:"element",position:"right"})})]})}),(0,l.jsx)(P,{showLabels:c,setShowLabels:d})]})}function S(e){let{omic:t,scatterData:a,selectedPlot2D:n}=e,{OMIC2NAME:r}=(0,w.S)(),o=(0,x.useRef)(),[i,c]=(0,x.useState)(!1);return(0,l.jsxs)(s.Z,{children:[(0,l.jsx)(D,{scatterRef:o,name:r[t]}),(0,l.jsx)(h.h,{width:"100%",height:400,children:(0,l.jsxs)(p.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(m.q,{}),(0,l.jsx)(j.K,{type:"number",dataKey:"x",name:"PCA ".concat(n.x),children:(0,l.jsx)(g._,{value:"PCA ".concat(n.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(b.B,{type:"number",dataKey:"y",name:"PCA ".concat(n.y),children:(0,l.jsx)(g._,{value:"PCA ".concat(n.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(f.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(k,{})}),Object.keys(a).length>1&&(0,l.jsx)(C.D,{verticalAlign:"top"}),Object.keys(a).map((e,t)=>(0,l.jsx)(y.b,{data:a[e],fill:u.s[t%u.s.length],name:e,children:i&&(0,l.jsx)(v.e,{dataKey:"element",position:"top"})},e))]})}),(0,l.jsx)(s.Z,{sx:{mt:1},children:(0,l.jsx)(P,{showLabels:i,setShowLabels:c})})]})}let P=e=>{let{showLabels:t,setShowLabels:a}=e;return(0,l.jsx)(s.Z,{sx:{mt:0,display:"flex",justifyContent:"center"},children:(0,l.jsxs)(s.Z,{sx:{width:100,textAlign:"center",position:"relative",left:30,border:"0px solid red"},children:[(0,l.jsx)(r.Z,{component:"legend",sx:{pt:0},children:"Show Labels"}),(0,l.jsx)(o.Z,{sx:{position:"relative",top:-10,border:"0px solid red"},checked:t,onChange:e=>{a(e=>!e)},inputProps:{"aria-label":"controlled"}})]})})},k=e=>{let{active:t,payload:a}=e;return t&&a&&a.length?(0,l.jsxs)(s.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(i.Z,{variant:"h8",sx:{display:"block"},children:"".concat(a[0].payload.element)}),(0,l.jsx)(i.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[0].name,": ").concat("string"==typeof a[0].value?a[0].value:a[0].value.toFixed(3))}),(0,l.jsx)(i.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[1].name,": ").concat(a[1].value.toFixed(3))})]}):null},D=e=>{let{scatterRef:t,name:a}=e;return(0,l.jsx)(s.Z,{sx:{height:0},children:(0,l.jsx)(s.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,l.jsx)(c.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),l=window.document.createElement("div");l.appendChild(e),(0,Z.default)(l,"PCA_Scatter-".concat(a))},sx:{opacity:.5},children:(0,l.jsx)(d.Z,{})})})})}},17141:function(e,t,a){a.r(t),a.d(t,{default:function(){return H}});var l=a(57437),n=a(96507),s=a(2265),r=a(11093),o=a(41637),i=a(92233),c=a(5301),d=a(85269),u=a(47042),x=a(46776),h=a(38939),p=a(23503),m=a(75897),j=a(53514),g=a(77370),b=a(80470),f=a(57842),y=a(62254),v=a(55183),C=a(64728);let Z="rgba(200,200,200,0.5)",w=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(Z),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(Z)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(Z),"&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(Z)}}}),A={textAlign:"center",padding:.5,border:"1px solid ".concat(Z),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},S=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),P=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function k(e){let{omic:t,data:a,rowNames:o,colNames:i,expVar:c,setSelectedPlot:d,scatterMode:u}=e,{OMIC2NAME:k}=(0,r.S)(),D=(0,C.a0)().EDA.PCA[t].displayOpts.selectedCell,[E,O]=(0,s.useState)(D),F=(0,C.mX)(),R=w(u),L=(e,a)=>{"2D"!=u&&(O({rowIndex:e,colIndex:a}),d({mdataCol:o[e],PCA:i[a]}),F({omic:t,type:"set-selected-plot-cell",rowIndex:e,colIndex:a,mdataCol:o[e],PCA:i[a]}),console.log("Plot scatter: PCA ".concat(i[a]," vs ").concat(o[e])))},z=(0,s.useMemo)(()=>{let e=[];e.push(["PCA / Cond.",...i]),e.push(["%Variance",...c]);let t=a.map((e,t)=>[o[t],...e]);return[...e,...t]},[i,c,a,o]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,l.jsx)(x.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,l.jsx)(v.CSVLink,{data:z,filename:"PCA_Anova_pvalues/".concat(k[t],".csv"),separator:",",children:(0,l.jsx)(y.Z,{})})})}),(0,l.jsxs)(h.ZP,{container:!0,children:[(0,l.jsx)(h.ZP,{item:!0,xs:2,children:(0,l.jsx)(p.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(m.Z,{children:[(0,l.jsx)(j.Z,{children:(0,l.jsx)(g.Z,{children:(0,l.jsx)(b.Z,{sx:{padding:0,textAlign:"center"},children:"PCA / Cond."})})}),(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(g.Z,{children:(0,l.jsx)(b.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(n.Z,{sx:{...A,borderBottom:"1px solid rgba(10,10,10,1)"},children:"%Variance"})})},"expVar"),o.map((e,t)=>(0,l.jsx)(g.Z,{children:(0,l.jsx)(b.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(n.Z,{sx:A,children:e})})},t))]})]})})}),(0,l.jsx)(h.ZP,{item:!0,xs:10,children:(0,l.jsx)(p.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(m.Z,{children:[(0,l.jsx)(j.Z,{children:(0,l.jsx)(g.Z,{children:a[0].map((e,t)=>(0,l.jsx)(b.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:t+1},t))})}),(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(g.Z,{children:c.map((e,t)=>(0,l.jsx)(b.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(n.Z,{sx:{padding:.5,border:"1px solid ".concat(Z),borderBottom:"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:P(e),userSelect:"none"},children:e})},t))},"expVar"),a.map((e,t)=>(0,l.jsx)(g.Z,{children:e.map((e,a)=>(0,l.jsx)(b.Z,{sx:{padding:0,border:0},onClick:()=>L(t,a),children:(0,l.jsx)(n.Z,{sx:E&&E.rowIndex===t&&E.colIndex===a?{...R.cell,...R.selectedCell,...S(e)}:{...R.cell,...S(e)},children:e<.001?e.toExponential(3):e.toFixed(3)})},a))},t))]})]})})})]})]})}var D=a(88030),E=a(67248),O=a(50294),F=a(9140),R=a(33457),L=a(92069);function z(e){let{omic:t,selectedLoadings:a,selectedPCA:i}=e,{OMIC2NAME:c}=(0,r.S)(),d=(0,C.mX)(),{displayOpts:u}=(0,C.a0)().EDA.PCA[t],[h,p]=(0,s.useState)(""),[m,j]=(0,s.useState)(u.filterCol),g=(0,o.tc)().user["".concat(t,"2i")],{filteredFeatures:b,columns:f}=(0,s.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:60},{accessorKey:"mdataValue",header:"",size:10},...i.map((e,t)=>({accessorKey:"PCA".concat(t),header:"Loadings PCA".concat(e)}))];if(g.columns.includes(m)){e=(e=g.column(m)).values.map((t,l)=>void 0==a[e.index[l]]?null:{ID:e.index[l],mdataValue:t,...a[e.index[l]].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e.index[l]][0]})}).filter(e=>null!=e);let l=RegExp("");try{l=new RegExp(h)}catch(e){l=RegExp("")}e=e.filter(e=>null!=e.mdataValue&&l.test(e.mdataValue)),t[1].header=m,t[1].size=100}else e=Object.keys(a).map((e,t)=>({ID:e,mdataValue:"",...a[e].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e][0]})}));return{filteredFeatures:e,columns:t}},[a,h,m,g,i]);return(0,l.jsxs)(n.Z,{sx:{width:"95%",margin:"auto"},children:[(0,l.jsxs)(n.Z,{sx:{display:"flex",height:"10vh"},children:[(0,l.jsx)(n.Z,{sx:{mt:4,ml:0},children:(0,l.jsx)(x.Z,{"aria-label":"download",size:"small",onClick:e=>V(c[t],b,f),sx:{opacity:.5,color:"rgb(13,110,253)"},variant:"danger",children:(0,l.jsx)(y.Z,{})})}),(0,l.jsx)(n.Z,{sx:{width:"40%",pt:1,ml:3},children:(0,l.jsx)(O.$S,{options:[{label:"All features",value:"All features"},...g.columns.map(e=>({label:e,value:e}))],onChange:e=>{j(e.value),d({type:"set-filter-col",value:e.value,omic:t})},value:{label:m,value:m}})}),g.columns.includes(m)&&(0,l.jsx)(F.Z,{children:(0,l.jsx)(n.Z,{sx:{mt:3,ml:3},children:(0,l.jsx)(E.Z,{id:"standard-name",placeholder:"Filter text",value:h,onChange:e=>{p(e.target.value)}})})})]}),(0,l.jsx)(n.Z,{sx:{mt:0},children:(0,l.jsx)(I,{data:b,columns:f})})]})}let V=(e,t,a)=>{let l=(0,L.iL)({useKeysAsHeaders:!0,filename:"PCA_Loading_Table-".concat(e)}),n=t.map(e=>{let t={};return a.map(a=>{""!=a.header&&(t[a.header]=e[a.accessorKey])}),t}),s=(0,L.gB)(l)(n);(0,L.LR)(l)(s)};function I(e){let{columns:t,data:a}=e,n=(0,s.useRef)(null),[r,o]=(0,s.useState)(!0),[i,c]=(0,s.useState)([]);(0,s.useEffect)(()=>{o(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=n.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[i]);let d=(0,R.X0)({columns:t,data:a,defaultDisplayColumn:{enableResizing:!0},layoutMode:"grid",enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableGlobalFilterModes:!1,enablePagination:!1,enableColumnPinning:!1,enableRowNumbers:!1,enableColumnFilters:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"510px"}},onSortingChange:c,state:{isLoading:r,sorting:i},rowVirtualizerInstanceRef:n,rowVirtualizerOptions:{overscan:5},columnVirtualizerOptions:{overscan:2}});return(0,l.jsx)(F.Z,{children:(0,l.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,l.jsx)(R.P2,{table:d})})})}var T=function(e){let{pvColNames:t,pvRowNames:a,selectedPlot2D:s,setSelectedPlot2D:r,omic:i}=e,c=(0,C.mX)(),{mdataType:d}=(0,o.tc)();return(0,l.jsxs)(n.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)(n.Z,{sx:{width:"25%"},children:(0,l.jsx)(O.$S,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,x:e.value})),c({type:"set-selected-plot-2d",option:"x",value:e.value,omic:i})},value:{label:"PCA ".concat(s.x),value:s.x},label:"X axis"})}),(0,l.jsx)(n.Z,{sx:{width:"25%"},children:(0,l.jsx)(O.$S,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,y:e.value})),c({type:"set-selected-plot-2d",option:"y",value:e.value,omic:i})},value:{label:"PCA ".concat(s.y),value:s.y},label:"Y axis"})}),(0,l.jsx)(n.Z,{sx:{width:"40%"},children:(0,l.jsx)(O.$S,{options:[{label:"No color",value:"No color"},...a.filter(e=>"categorical"==d[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),c({type:"set-selected-plot-2d",option:"g",value:e.value,omic:i})},value:{label:s.g,value:s.g},label:"Color by"})})]})};function _(e){let{omic:t}=e,a=(0,s.useRef)(null),{API_URL:x}=(0,r.S)(),h=(0,C.mX)(),p=(0,C.a0)().EDA.PCA[t].status,[m,j]=(0,s.useState)(p),g=(0,C.a0)().EDA.PCA[t].data,[b,f]=(0,s.useState)(g),{projections:y,loadings:v,explained_variance:Z,anova:w}=b,{mdata:A}=(0,o.tc)().user,{mdataType:S}=(0,o.tc)(),{jobID:P}=(0,o.tc)(),{displayOpts:E}=(0,C.a0)().EDA.PCA[t],[O,F]=(0,s.useState)(E.scatterMode),[R,L]=(0,s.useState)(E.selectedPlot),[V,I]=(0,s.useState)(E.selectedPlot2D),_=(0,s.useCallback)(async()=>{console.log("Fetching data");let e=await fetch("".concat(x,"/get_eda_pca/").concat(P,"/").concat(t)),{resStatus:l,dataPCA:n}=await e.json();console.log(l),"waiting"!=l.status&&(console.log("Status changed: ".concat(JSON.stringify(l))),f(n),j(l),h({type:"set-eda-pca-data",data:n,omic:t}),h({type:"set-eda-pca-status",status:l,omic:t}),clearInterval(a.current))},[x,P,t,h,a]);(0,s.useEffect)(()=>{if("waiting"==m.status)return console.log("Get data from server"),a.current=setInterval(_,2e3),()=>clearInterval(a.current)},[a,_,m.status]);let{pvTable:N,pvRowNames:H,pvColNames:$,pvExpVar:q}=(0,s.useMemo)(()=>K(w,Z,A,m),[w,Z,A,m]),G=(0,s.useMemo)(()=>B(y,A,S,R,V,m,O),[y,A,S,R,V,m,O]),X=(0,s.useMemo)(()=>M(v,R,V,m,O),[v,R,V,m,O]);return(0,l.jsx)(n.Z,{children:"ok"==m.status?(0,l.jsxs)(n.Z,{sx:{padding:.2,transition:"all 1s ease"},children:[(0,l.jsx)(n.Z,{sx:{margin:"auto",pt:3,width:"90%"},children:(0,l.jsx)(k,{omic:t,data:N,rowNames:H,colNames:$,expVar:q,setSelectedPlot:L,scatterMode:O})}),(0,l.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:[(0,l.jsxs)(n.Z,{sx:{width:"45%"},children:[(0,l.jsx)(n.Z,{sx:{textAlign:"center",mt:2},children:(0,l.jsx)(n.Z,{sx:{mb:2},children:(0,l.jsxs)(i.Z,{color:"primary",value:O,exclusive:!0,onChange:(e,a)=>{F(e.target.value),h({type:"set-scatter-mode",mode:e.target.value,omic:t})},"aria-label":"Platform",children:[(0,l.jsx)(c.Z,{value:"1D",children:"1D"}),(0,l.jsx)(c.Z,{value:"2D",children:"2D"})]})})}),(0,l.jsx)(n.Z,{sx:{textAlign:"center"},children:"1D"==O?(0,l.jsx)(n.Z,{sx:{height:75,pt:3},children:(0,l.jsx)(d.Z,{variant:"body1",children:"Select a pvalue cell to plot PCA"})}):(0,l.jsx)(T,{pvColNames:$,pvRowNames:H,selectedPlot2D:V,setSelectedPlot2D:I,omic:t})}),G&&(0,l.jsx)(n.Z,{children:"1D"==O?(0,l.jsx)(D.T3,{omic:t,scatterData:G,mdataCol:R.mdataCol,PCA:R.PCA}):(0,l.jsx)(D.$Y,{omic:t,scatterData:G,selectedPlot2D:V})})]}),(0,l.jsx)(n.Z,{sx:{width:"45%"},children:X&&(0,l.jsx)(n.Z,{sx:{marginTop:5,textAlign:"center"},children:(0,l.jsx)(z,{omic:t,selectedLoadings:X,selectedPCA:"1D"==O?[R.PCA]:[V.x,V.y]})})})]})]}):(0,l.jsx)(n.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:(0,l.jsx)(u.Z,{size:100,thickness:2})})})}let K=(e,t,a,l)=>{let n,s,r,o,i;if("ok"==l.status){n=a.columns.map(t=>Object.keys(e).map(a=>[t,parseInt(a),e[a][t]]));for(let e=0;e<n.length;e++)n[e].sort((e,t)=>e[1]-t[1]);r=(n=n.filter(e=>!e.map(e=>0==Object.keys(e[2]).length).every(e=>e))).map(e=>e[0][0]),o=n[0].map(e=>e[1]),s=n.map(e=>e.map(e=>e[2].pvalue)),i=Object.keys(t).map(e=>(100*t[e].Explained_Variance).toFixed(1))}return{pvTable:s,pvRowNames:r,pvColNames:o,pvExpVar:i}},B=(e,t,a,l,n,s,r)=>{let o=null;if("ok"==s.status&&"1D"==r&&l){let a=t.column(l.mdataCol);o=Object.keys(e).map(t=>({element:t,projection:e[t][l.PCA],mdataValue:a.values[a.index.indexOf(t)]}))}else"ok"==s.status&&"2D"==r&&n&&(Object.keys(a).includes(n.g)?(o={},a[n.g].levels.map(t=>{o[t]=[],a[n.g].level2id[t].map(a=>{Object.keys(e).includes(a)&&o[t].push({element:a,x:e[a][n.x],y:e[a][n.y]})})})):o={[n.g]:Object.keys(e).map(t=>({element:t,x:e[t][n.x],y:e[t][n.y]}))});return o},M=(e,t,a,l,n)=>{let s=null;return"ok"==l.status&&"1D"==n&&t?(s={},Object.keys(e).map(a=>{s[a]=[parseFloat(e[a][t.PCA].toFixed(5))]})):"ok"==l.status&&"2D"==n&&(s={},Object.keys(e).map(t=>{s[t]=[parseFloat(e[t][a.x].toFixed(5)),parseFloat(e[t][a.y].toFixed(5))]})),s};a(13716);var N=a(19636);function H(){let{omics:e}=(0,o.tc)(),[t,a]=(0,s.useState)(e[0]),r=(0,s.useRef)();return(0,l.jsxs)(n.Z,{children:[(0,l.jsx)(N.Z,{selOmic:t,setSelOmic:a,omicViewRef:r}),(0,l.jsx)(n.Z,{ref:r,sx:{overflow:"hidden"},children:(0,l.jsx)(n.Z,{sx:{display:"flex",width:"".concat(e.length,"00%")},children:e.map(a=>(0,l.jsx)(n.Z,{sx:{width:"".concat(100/e.length,"%"),opacity:a==t?1:0,transition:"all 1s ease"},children:(0,l.jsx)(_,{omic:a})},a))})})]})}},92069:function(e,t,a){a.d(t,{LR:function(){return Z},gB:function(){return C},iL:function(){return n}});var l={fieldSeparator:",",decimalSeparator:".",quoteStrings:!0,quoteCharacter:'"',showTitle:!1,title:"My Generated Report",filename:"generated",showColumnHeaders:!0,useTextFile:!1,useBom:!0,columnHeaders:[],useKeysAsHeaders:!1,boolDisplay:{true:"TRUE",false:"FALSE"},replaceUndefinedWith:""},n=e=>Object.assign({},l,e);class s extends Error{constructor(e){super(e),this.name="CsvGenerationError"}}class r extends Error{constructor(e){super(e),this.name="EmptyHeadersError"}}class o extends Error{constructor(e){super(e),this.name="CsvDownloadEnvironmentError"}}var i=e=>e,c=e=>e,d=e=>"object"==typeof e?i(e.key):i(e),u=e=>"object"==typeof e?i(e.displayLabel):i(e),x=(e,...t)=>t.reduce((e,t)=>t(e),e),h=e=>t=>e.useBom?i(c(t)+"\uFEFF"):t,p=e=>t=>e.showTitle?i(c(t)+e.title):t,m=e=>t=>i(c(e)+c(t)+"\r\n"),j=e=>(t,a)=>g(e)(i(t+a)),g=e=>t=>i(c(t)+e.fieldSeparator),b=(e,t)=>a=>{if(!e.showColumnHeaders)return a;if(t.length<1)throw new r("Option to show headers but none supplied. Make sure there are keys in your collection or that you've supplied headers through the config options.");let l=i("");for(let a=0;a<t.length;a++){let n=u(t[a]);l=j(e)(l,v(e,n))}return l=i(c(l).slice(0,-1)),m(a)(l)},f=(e,t,a)=>l=>{let n=l;for(var s=0;s<a.length;s++){let l=i("");for(let n=0;n<t.length;n++){let r=d(t[n]),o=void 0===a[s][c(r)]?e.replaceUndefinedWith:a[s][c(r)];l=j(e)(l,v(e,o))}l=i(c(l).slice(0,-1)),n=m(n)(l)}return n},y=e=>+e===e&&(!isFinite(e)||!!(e%1)),v=(e,t)=>{if("locale"===e.decimalSeparator&&y(t))return t.toLocaleString();if("."!==e.decimalSeparator&&y(t))return t.toString().replace(".",e.decimalSeparator);if("string"==typeof t){let a=t;return(e.quoteStrings||e.fieldSeparator&&t.indexOf(e.fieldSeparator)>-1||t.indexOf("\n")>-1||t.indexOf("\r")>-1)&&(a=e.quoteCharacter+t+e.quoteCharacter),a}if("boolean"==typeof t&&e.boolDisplay){let a=t?"true":"false";return e.boolDisplay[a]}return t},C=e=>t=>{let a=n(e),l=a.useKeysAsHeaders?Object.keys(t[0]):a.columnHeaders,r=x(i(""),h(a),p(a),b(a,l),f(a,l,t));if(c(r).length<1)throw new s("Output is empty. Is your data formatted correctly?");return r},Z=e=>t=>{if(!window)throw new o("Downloading only supported in a browser environment.");let a=n(e),l=c(t),s=a.useTextFile?"plain":"csv",r=a.useTextFile?"txt":"csv",i=new Blob([l],{type:`text/${s};charset=utf8;`}),d=document.createElement("a");d.download=`${a.filename}.${r}`,d.href=URL.createObjectURL(i),d.setAttribute("visibility","hidden"),document.body.appendChild(d),d.click(),document.body.removeChild(d)}}}]);