"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{34360:function(e,t,l){l.r(t),l.d(t,{default:function(){return H}});var a=l(57437),i=l(96507),n=l(49600),s=l(93202),r=l(2265),o=l(41637),c=l(85269),d=l(7377),u=l(78295),_=l(24235),p=l(50039),E=l(39677),m=(0,d.z)({chartName:"BarChart",GraphicalChild:u.$,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:_.K},{axisType:"yAxis",AxisComp:p.B}],formatAxisMap:E.t9}),C=l(16573),x=l(33343),h=l(2047),A=l(79857),R=l(36612),g=l(90053),y=l(11093),S=l(16691),F=l.n(S),N=l(38592),f=l(92069),b=l(7035);let T=["GO:MF","GO:BP","GO:CC","KEGG","REAC"],G=e=>{let{myData:t}=e,l=(0,r.useRef)();return(0,a.jsx)(i.Z,{sx:{height:520,overflowY:"auto",overflowX:"hidden"},children:(0,a.jsxs)(i.Z,{sx:{width:550,m:"auto"},children:[(0,a.jsx)(i.Z,{sx:{width:0,position:"relative",left:50},children:(0,a.jsx)(b.Wd,{scatterRef:l,name:"GO_Enrichment"})}),(0,a.jsxs)(m,{ref:l,width:530,height:Math.max(480,80*t.length),data:t,margin:{top:0,right:0,left:150,bottom:20},layout:"vertical",children:[(0,a.jsx)(C.q,{strokeDasharray:"3 3"}),(0,a.jsx)(p.B,{type:"category",dataKey:"name",minTickGap:30,style:{fontFamily:"Calibri",border:"1px solid red"},padding:{top:30}}),(0,a.jsx)(_.K,{type:"number",style:{fontFamily:"Calibri"},children:(0,a.jsx)(x._,{value:"-Log10 (FDR)",offset:-10,position:"insideBottom",style:{fontFamily:"Calibri"}})}),(0,a.jsx)(h.u,{content:(0,a.jsx)(I,{})}),(0,a.jsx)(A.D,{content:()=>(0,a.jsx)(j,{}),align:"center",verticalAlign:"top"}),(0,a.jsx)(u.$,{dataKey:"-Log10(pvalue)",barSize:15,children:t.map(e=>(0,a.jsx)(R.b,{fill:P(e.source)},e.native))})]})]})})},I=e=>{let{active:t,payload:l}=e;return t&&l&&l.length?(0,a.jsxs)(i.Z,{className:"custom-tooltip",sx:{width:350,backgroundColor:"rgba(255,255,255,0.8)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,1)"},children:[(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.source," - ").concat(l[0].payload.native)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.name)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.description)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"FDR = ".concat(l[0].payload.FDR)})]}):null},j=()=>{let e=[{value:"GO:MF",color:g.s[0]},{value:"GO:BP",color:g.s[1]},{value:"GO:CC",color:g.s[2]},{value:"KEGG",color:g.s[3]},{value:"REAC",color:g.s[4]}].filter(e=>T.includes(e.value));return(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"10px"},children:e.map((e,t)=>(0,a.jsxs)("div",{style:{marginRight:"20px",display:"flex",alignItems:"center"},children:[(0,a.jsx)("div",{style:{width:"15px",height:"15px",backgroundColor:e.color,marginRight:"5px"}}),(0,a.jsx)("span",{children:e.value})]},t))})},P=e=>{switch(e){case"GO:MF":return g.s[0];case"GO:BP":return g.s[1];case"GO:CC":return g.s[2];case"KEGG":return g.s[3];case"REAC":return g.s[4]}},v=e=>{let{myData:t,setCategory:l,myUsrFilt:o,setMyUsrFilt:c}=e,d=()=>{let e=(0,f.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"Protein_GO_Enrichment"}),l=t.map(e=>({GO:e.native,Type:e.source,Name:e.name,FDR:e.FDR})),a=(0,f.gB)(e)(l);(0,f.LR)(e)(a)},u=(0,r.useMemo)(()=>[{header:"GO",accessorKey:"native",size:100},{header:"Type",accessorKey:"source",size:170,filterVariant:"multi-select"},{header:"Name",accessorKey:"name",size:220},{header:"FDR",accessorKey:"FDR",size:50,filterFn:"lessThan"}],[]),_=(0,r.useMemo)(()=>t.length>0?{[t[0].native]:!0}:{},[t]),[p,E]=(0,r.useState)(_);(0,r.useEffect)(()=>{0==Object.keys(p).length?l(null):l(t.filter(e=>e.native==Object.keys(p)[0])[0])},[p,t,l]);let m=(0,N.X0)({columns:u,data:t,layoutMode:"grid",enableBottomToolbar:!1,enableColumnResizing:!0,enablePagination:!1,enableColumnPinning:!1,enableRowNumbers:!1,enableRowActions:!1,enableRowSelection:!0,enableMultiRowSelection:!1,enableDensityToggle:!1,enableColumnFilters:!0,enableFullScreenToggle:!1,enableHiding:!1,enableColumnActions:!1,muiTableContainerProps:{sx:{maxHeight:"250px"}},enableFacetedValues:!0,initialState:{density:"compact",showGlobalFilter:!0,showColumnFilters:!0,columnFilters:[{id:"FDR",value:.1}],rowSelection:{initialSelectedRow:_}},positionToolbarAlertBanner:"bottom",getRowId:e=>e.native,muiTableBodyRowProps:e=>{let{row:t}=e;return{onClick:t.getToggleSelectedHandler(),sx:{cursor:"pointer"}}},onRowSelectionChange:E,state:{rowSelection:p},renderTopToolbarCustomActions:e=>{let{table:t}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:(0,a.jsx)(n.Z,{onClick:d,startIcon:(0,a.jsx)(s.Z,{}),children:"Export All Data"})})}}),[C,x]=(0,r.useState)(t.map(e=>e.native)),h=m.getFilteredRowModel().rows.map(e=>e.id);return C.every(e=>h.includes(e))&&h.every(e=>C.includes(e))||x(h),(0,r.useEffect)(()=>{console.log("Setting ID"),o.every(e=>C.includes(e))&&C.every(e=>o.includes(e))||c(C)},[C,c,o]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(N.P2,{table:m})})};var M=function(e){let{omic:t,fRef:l,setCategory:n,colFid:s,setQ2cat:d}=e,u=(0,y.S)().BASE_URL,_=(0,o.tc)().user["".concat(t,"2i")],{OS:p}=(0,o.tc)(),[E,m]=(0,r.useState)(null),C=(0,r.useMemo)(()=>{let e=_.column(s.id).values;return e.filter((t,l)=>e.indexOf(t)==l)},[_,s]),x=(0,r.useMemo)(()=>{let e=l.map(e=>e[s.id]);return e.filter((t,l)=>e.indexOf(t)==l)},[s,l]),h=(0,r.useCallback)(async()=>{let e;let t=e=>new Promise(async(t,l)=>{console.log("Trying ",e);try{let l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:p.id,query:x,domain_scope:"custom",background:C,user_threshold:.1,significance_threshold_method:"bonferroni",sources:T})});t(l)}catch(e){l(e)}});try{e=await t("https://biit.cs.ut.ee/gprofiler/api/gost/profile/")}catch(l){console.log(l),e=await t("https://biit.cs.ut.ee/gprofiler_beta/api/gost/profile/")}let l=await e.json(),a=l.meta.genes_metadata.query.query_1.mapping;l.ensgs2myid={},Object.keys(a).map((e,t)=>{l.ensgs2myid[Object.values(a)[t][0]]=e}),l.myid=l.meta.genes_metadata.query.query_1.ensgs.map(e=>l.ensgs2myid[e]),l.result=l.result.map(e=>({...e,myid:l.myid.filter((t,l)=>e.intersections[l].length>0)})),0==l.myid.length&&alert("No protein/transcript ID could be mapped. Please, check that organism and column containing ID were correctly selected"),m(l)},[p,x,C]);(0,r.useEffect)(()=>{let e=setTimeout(h,100);return()=>clearTimeout(e)},[x,C,h]);let A=(0,r.useMemo)(()=>{if(null==E)return null;let e=E.result.map(e=>({...e,"-Log10(pvalue)":Math.round(-(1e4*Math.log10(e.p_value)))/1e4,FDR:Number.parseFloat(e.p_value).toExponential(2),labelName:e.name.split(" ").slice(0,4).join(" ")+(e.name.split(" ").length>4?"...":"")}));return e},[E]),[R,g]=(0,r.useState)([]),S=(0,r.useMemo)(()=>{if(null===A)return null;let e=A.filter(e=>R.includes(e.native));return e},[A,R]);return(0,r.useEffect)(()=>{if(null===S)return;let e={};E.myid.map(t=>{e[t]=[]}),S.map(t=>{t.myid.map(l=>e[l].push(t))}),d(e)},[S,E,d]),(0,a.jsxs)(i.Z,{sx:{mt:3},children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:[(0,a.jsx)(i.Z,{sx:{mr:2},children:(0,a.jsx)(c.Z,{variant:"h6",children:"GO Enrichment with"})}),(0,a.jsx)(i.Z,{sx:{cursor:"pointer"},onClick:()=>window.open("https://biit.cs.ut.ee/gprofiler/gost","_blank","noreferrer"),children:(0,a.jsx)(F(),{src:"".concat(u,"/gProfiler_logo.png"),width:110,height:30,className:"d-inline-block align-top",alt:"g:Profiler"})})]}),(0,a.jsx)(i.Z,{children:A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{sx:{border:"0px solid #999999",borderRadius:5,p:1,maxWidth:700,m:"auto"},children:(0,a.jsx)(G,{myData:S})}),(0,a.jsx)(i.Z,{sx:{pl:2,mt:1,width:"206%"},children:(0,a.jsx)(v,{myData:A,setCategory:n,myUsrFilt:R,setMyUsrFilt:g})})]})})]})},O=l(64728);let D=["AFFY_HC_G110","AFFY_HG_FOCUS","AFFY_HG_U133A_2","AFFY_HG_U133B","AFFY_HG_U133_PLUS_2","AFFY_HG_U95A","AFFY_HG_U95AV2","AFFY_HG_U95B","AFFY_HG_U95C","AFFY_HG_U95D","AFFY_HG_U95E","AFFY_HTA_2_0","AFFY_HT_HG_U133_PLUS_PM","AFFY_HUEX_1_0_ST_V2","AFFY_HUGENEFL","AFFY_HUGENE_1_0_ST_V1","AFFY_HUGENE_2_0_ST_V1","AFFY_HUGENE_2_1_ST_V1","AFFY_PRIMEVIEW","AFFY_U133_X3P","AGILENT_CGH_44B","AGILENT_GPL19072","AGILENT_GPL26966","AGILENT_GPL6848","AGILENT_SUREPRINT_G3_GE_8X60K","AGILENT_SUREPRINT_G3_GE_8X60K_V2","AGILENT_WHOLEGENOME","AGILENT_WHOLEGENOME_4X44K_V1","AGILENT_WHOLEGENOME_4X44K_V2","ARRAYEXPRESS","BIOGRID","CCDS","CCDS_ACC","CHEMBL","CODELINK_CODELINK","DBASS3","DBASS3_ACC","DBASS5","DBASS5_ACC","EMBL","ENSG","ENSP","ENST","ENS_LRG_GENE","ENS_LRG_TRANSCRIPT","ENTREZGENE","ENTREZGENE_ACC","ENTREZGENE_TRANS_NAME","GENECARDS","GENECARDS_ACC","GO","GOSLIM_GOA","HGNC","HGNC_ACC","HGNC_TRANS_NAME","HPA","HPA_ACC","ILLUMINA_HUMANREF_8_V3","ILLUMINA_HUMANWG_6_V3","MEROPS","MIM_GENE","MIM_GENE_ACC","MIM_MORBID","MIM_MORBID_ACC","MIRBASE","MIRBASE_ACC","MIRBASE_TRANS_NAME","PDB","PHALANX_ONEARRAY","PROTEIN_ID","PROTEIN_ID_ACC","REACTOME","REACTOME_GENE","REACTOME_TRANSCRIPT","REFSEQ_MRNA","REFSEQ_MRNA_ACC","REFSEQ_MRNA_PREDICTED","REFSEQ_MRNA_PREDICTED_ACC","REFSEQ_NCRNA","REFSEQ_NCRNA_ACC","REFSEQ_NCRNA_PREDICTED","REFSEQ_NCRNA_PREDICTED_ACC","REFSEQ_PEPTIDE","REFSEQ_PEPTIDE_ACC","REFSEQ_PEPTIDE_PREDICTED","REFSEQ_PEPTIDE_PREDICTED_ACC","RFAM","RFAM_ACC","RFAM_TRANS_NAME","RNACENTRAL","UCSC","UNIPARC","UNIPROTSPTREMBL","UNIPROTSPTREMBL_ACC","UNIPROTSWISSPROT","UNIPROTSWISSPROT_ACC","UNIPROT_GN","UNIPROT_GN_ACC","UNIPROT_ISOFORM","WIKIGENE","WIKIGENE_ACC"];var w=l(51808);let L=e=>{let{qCat:t,fRef:l,omic:o,colFid:c}=e,d=c.id,u=(0,r.useMemo)(()=>{let e={};return l.map(t=>{e[t[d]]=!0}),e},[l,d]),_=(0,r.useMemo)(()=>{let e=Object.keys(u),l=[];return(l=t.map(t=>({...t,desc:t.description.replace(/\[[^\]]*\]/g,""),filtered:e.includes(t.converted)?1:0}))).sort((e,t)=>t.filtered-e.filtered),l},[t,u]),p=(0,r.useMemo)(()=>[{header:"ID",accessorKey:"converted",size:60},{header:"GN",accessorKey:"name",size:60},{header:"Description",accessorKey:"desc"}],[]),E=()=>{let e=(0,f.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"CategoryProteins"}),t=_.map(e=>({ID:e.converted,GN:e.name,Description:e.desc,Filtered:e.filtered})),l=(0,f.gB)(e)(t);(0,f.LR)(e)(l)},m=(0,r.useRef)(null),[C,x]=(0,r.useState)(!0),[h,A]=(0,r.useState)([]);(0,r.useEffect)(()=>{x(!1)},[]),(0,r.useEffect)(()=>{try{var e,t;null===(t=m.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[h]);let R=(0,N.X0)({columns:p,data:_,layoutMode:"grid",enableBottomToolbar:!0,positionToolbarAlertBanner:"bottom",enableSelectAll:!1,enablePagination:!1,enableRowPinning:!1,enableRowSelection:!1,enableStickyHeader:!0,enableColumnPinning:!1,enableDensityToggle:!1,enableColumnFilters:!1,enableFullScreenToggle:!1,enableHiding:!1,enableColumnActions:!1,rowPinningDisplayMode:"select-sticky",muiTableContainerProps:{sx:{maxHeight:"300px"}},enableRowVirtualization:!0,enableColumnVirtualization:!0,getRowId:e=>e.converted,state:{rowSelection:u,isLoading:C,sorting:h},rowVirtualizerInstanceRef:m,rowVirtualizerOptions:{overscan:5},columnVirtualizerOptions:{overscan:2},initialState:{rowSelection:u,density:"compact",showGlobalFilter:!0},renderTopToolbarCustomActions:e=>{let{table:t}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:(0,a.jsx)(n.Z,{onClick:E,startIcon:(0,a.jsx)(s.Z,{}),children:"Export All Data"})})}});return(0,a.jsx)(N.P2,{table:R})};var H=function(e){let{omic:t,fRef:l,f2MeanL:n,setQ2cat:s,colFid:c,setColFid:d}=e,{OS:u}=(0,o.tc)(),_=(0,O.a0)().MOFA.displayOpts.selectedPlot.mdataCol,p=(0,o.tc)().mdataType[_],[E,m]=(0,r.useState)(null),[C,x]=(0,r.useState)(null),[h,A]=(0,r.useState)(!0),R=(0,o.tc)().user["".concat(t,"2i")],g=(0,r.useMemo)(()=>R.columns.map(e=>({label:e,id:e})),[R]),y=(0,r.useMemo)(()=>D.map(e=>({id:e,label:e})),[]),[S,F]=(0,r.useState)("q"==t?y[97]:y[42]),N=(0,r.useCallback)(async()=>{let e;A(!0);let t=e=>new Promise(async(t,l)=>{console.log("Trying ",e);try{let l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:u.id,query:E.native,target:S.id})});t(l)}catch(e){l(e)}});try{e=await t("https://biit.cs.ut.ee/gprofiler/api/convert/convert/")}catch(l){console.log(l),e=await t("https://biit.cs.ut.ee/gprofiler_beta/api/convert/convert/")}let l=await e.json(),a=[...new Set(R.column(c.id).values)],i=l.result.filter(e=>a.includes(e.converted));x(i=i.filter((e,t,l)=>t===l.findIndex(t=>t.converted===e.converted))),setTimeout(()=>A(!1),500)},[E,u,c.id,R,S]);return(0,r.useEffect)(()=>{if(null==E)x(null);else{let e=setTimeout(N,100);return()=>clearTimeout(e)}},[E,N]),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:[(0,a.jsx)(w.Z,{options:g,selectedField:c,setSelectedField:d,children:"Select Column Containing ID"}),(0,a.jsx)(i.Z,{sx:{width:10}}),(0,a.jsx)(w.Z,{options:y,selectedField:S,setSelectedField:F,children:"Select ID Format"})]}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[(0,a.jsx)(i.Z,{sx:{width:"45%",mt:3},children:(0,a.jsx)(M,{omic:t,fRef:l,setCategory:m,colFid:c,setQ2cat:s})}),(0,a.jsx)(i.Z,{sx:{width:"45%"},children:"categorical"==p.type&&p.levels.length>1&&C&&(0,a.jsx)(i.Z,{sx:{pl:2,mt:13},children:(0,a.jsx)(i.Z,{sx:{opacity:h?0:1,transition:"all ease 0.2s"},children:(0,a.jsx)(L,{qCat:C,fRef:l,omic:t,colFid:c})})})})]})]})}},51808:function(e,t,l){var a=l(57437),i=l(2265),n=l(96507),s=l(85269),r=l(70812),o=l(67248);t.Z=e=>{let{options:t,selectedField:l,setSelectedField:c,children:d}=e,u=(e,l)=>{l?c(l):c(t[0])};return(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(s.Z,{variant:"h6",children:d}),(0,a.jsx)(r.Z,{id:"feature-id-field",sx:{width:300,margin:"auto",mt:2},disableListWrap:!0,value:l,onChange:(e,t)=>u(e,t),options:t,renderInput:e=>(0,a.jsx)(o.Z,{...e,label:"Field"}),renderOption:(e,t)=>(0,i.createElement)("li",{...e,key:t.label},t.label),isOptionEqualToValue:(e,t)=>e.id===t.id})]})}}}]);