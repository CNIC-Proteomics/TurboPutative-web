"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{26398:function(e,t,l){var a=l(26314);t.Z=void 0;var n=a(l(80984)),s=l(57437),i=(0,n.default)((0,s.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.Z=i},59637:function(e,t,l){var a=l(26314);t.Z=void 0;var n=a(l(80984)),s=l(57437),i=(0,n.default)((0,s.jsx)("path",{d:"m3.5 18.49 6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"}),"ShowChart");t.Z=i},90643:function(e,t,l){l.r(t),l.d(t,{default:function(){return es}});var a=l(57437),n=l(2265),s=l(41637),i=l(96507),o=l(19636),r=l(54986),c=l(85269),d=l(75745),u=l(11093),p=l(64728),m=l(9140),x=l(70812),h=l(67248),b=l(49600),g=l(26398);let y=["ChEBI","KEGG","HMDB","PubChem"],f={"Mean difference":{text1:"Select metadata variable",text2:"Metadata Variable"},"t-test":{text1:"Select metadata variable",text2:"Metadata Variable"},PCA:{text1:"Select Principal Component",text2:"Principal Component"},MOFA:{text1:"Select MOFA Factor",text2:"MOFA Factor"},Custom:{text1:"Select column with ranking metric",text2:"Ranking Metric Column"}};var j=function(e){let{omic:t,g2info:l,setG2info:o,gidCol:r,setGidCol:j,mParams:C,setMParams:Z,rankCol:E,setRankCol:k,subRankCol:S,setSubRankCol:v,groups:O,setGroups:w,handleRunGSEA:M,ready:T,mMethod:A}=e,G="m"==t,{OMIC2NAME:I,API_URL:F}=(0,u.S)(),{OS:P,jobID:R}=(0,s.tc)(),D=(0,p.a0)(),_=(0,p.mX)(),z=D.GSEA[t],{mdataType:V}=(0,s.tc)(),[K]=(0,d.Z)(t),N=(0,n.useMemo)(()=>K.columns.map(e=>({label:e,id:e})),[K]),[B,q]=(0,n.useState)({}),L=async(e,l)=>{if(null==l)return;o(null),j(l);let a={},n=K.column(l.id);if(!G){if(Object.keys(B).includes(l.id))a=B[l.id];else{n.values.map((e,t)=>{Object.keys(a).includes(e)?a[e].f.push(n.index[t]):a[e]={f:[n.index[t]]}}),console.log("Fetch ENTREZ identifiers");let e=await fetch("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:P.id,target:"ENTREZGENE_ACC",query:Object.keys(a)})}),t=await e.json(),s=[];t.result.map(e=>{s.includes(e.incoming)||"None"==e.converted||(s.push(e.incoming),a[e.incoming].gn=e.name,a[e.incoming].egn=e.name.toUpperCase(),a[e.incoming].eid=e.converted)}),q(e=>({...e,[l.id]:a}))}}o(a),_({type:"set-g2info",omic:t,g2info:a,gidCol:l})},H=(0,p.a0)().status,W=(0,n.useMemo)(()=>[{label:"Mean difference",disabled:!Object.keys(V).some(e=>"categorical"==V[e].type)},{label:"t-test",disabled:!Object.keys(V).some(e=>"categorical"==V[e].type)},{label:"PCA",disabled:"ok"!=H.EDA_PCA.status},{label:"MOFA",disabled:"ok"!=H.MOFA.status},{label:"Custom",disabled:!K.ctypes.values.some(e=>e.includes("int")||e.includes("float"))}],[H,K,V]),[J,$]=(0,n.useState)(z.rankParams.subRankColOpts),[X,U]=(0,n.useState)(z.rankParams.showSubSection),[Q,Y]=(0,n.useState)(z.rankParams.groupColOpts),ee=async(e,l)=>{if(!l)return;k(l),v(null),Y([]),w({g1:null,g2:null}),U(!1),setTimeout(e=>U(!0),100);let a=[];if("PCA"==l.label){let e=D.EDA.PCA[t].data.explained_variance;if(null==e){let l=await fetch("".concat(F,"/get_eda_pca/").concat(R,"/").concat(t)),{resStatus:a,dataPCA:n}=await l.json();_({type:"set-eda-pca-data",data:n,omic:t}),_({type:"set-eda-pca-status",status:a,omic:t}),e=n.explained_variance}a=Object.keys(e).map(e=>({label:"PCA".concat(e),id:"PCA".concat(e)}))}if("MOFA"==l.label){let e;if(null==D.MOFA.data){let l=await fetch("".concat(F,"/get_mofa/").concat(R)),a=await l.json();_({type:"set-mofa-data",data:a.dataMOFA}),e=a.dataMOFA.explained_variance[t]}else e=D.MOFA.data.explained_variance[t];a=Object.keys(e).map(e=>({label:e,id:e}))}if(["Mean difference","t-test"].includes(l.label)&&(a=Object.keys(V).filter(e=>"categorical"==V[e].type).map(e=>({label:e,id:e}))),"Custom"==l.label){let e=K.ctypes;a=e.index.filter((t,l)=>e.values[l].includes("int")||e.values[l].includes("float")).map(e=>({label:e,id:e}))}$(a),_({type:"handle-rank-col-opts",omic:t,rankParams:{rankCol:l,subRankCol:null,groups:{g1:null,g2:null},subRankColOpts:a,groupColOpts:[],showSubSection:!0}})},[et,el]=(0,n.useState)(G?z.ionValOpts:[]);return(0,a.jsxs)(i.Z,{sx:{mt:2},children:[(0,a.jsxs)(i.Z,{children:[!G&&(0,a.jsxs)(i.Z,{sx:{textAlign:"center",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select column containing ".concat(I[t]," ID")}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:N,sx:{width:300},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"".concat(I[t]," ID column")}),isOptionEqualToValue:(e,t)=>e.id===t.id,value:r,onChange:L,renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),G&&(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",textAlign:"center"},children:[(0,a.jsxs)(i.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"MSEA"}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",flexDirection:"column",mt:2},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Metabolite ID"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:N,sx:{width:250},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"Metabolite ID"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.mid,onChange:(e,t)=>{Z(e=>({...e,mid:t})),_({type:"set-m-params",attr:"mid",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select ID Type"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:y.map(e=>({id:e,label:e})),sx:{width:250},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"ID Type"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.midType,onChange:(e,t)=>{Z(e=>({...e,midType:t})),_({type:"set-m-params",attr:"midType",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})]}),(0,a.jsx)(i.Z,{sx:{width:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(i.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"Mummichog"}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",mt:2},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Apex m/z Column"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:N,sx:{width:250},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"Apex m/z"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.mz,onChange:(e,t)=>{Z(e=>({...e,mz:t})),_({type:"set-m-params",attr:"mz",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Retention Time Column (min)"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:N,sx:{width:250},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"RT column (min)"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.rt,onChange:(e,t)=>{Z(e=>({...e,rt:t})),_({type:"set-m-params",attr:"rt",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Ion Mode Column"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:N,sx:{width:250},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"Ion Mode Column"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionCol,onChange:(e,t)=>{if(Z(e=>({...e,ionCol:t})),_({type:"set-m-params",attr:"ionCol",value:t}),Z(e=>({...e,ionVal:{pos:null,neg:null}})),_({type:"set-m-params",attr:"ionVal",value:{pos:null,neg:null}}),!t)return;let l=[...new Set(K.column(t.id).values)].map(e=>({label:e,id:e})).slice(0,10);el(l),_({type:"set-ion-val-opts",ionValOpts:l})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:4},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Positive Ion Value"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:et,sx:{width:150},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"Positive Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionVal.pos,onChange:(e,t)=>{Z(e=>({...e,ionVal:{...e.ionVal,pos:t}})),_({type:"set-ion-val",mode:"pos",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(i.Z,{sx:{width:"5%"}}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Negative Ion Value"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:et,sx:{width:150},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"Negative Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionVal.neg,onChange:(e,t)=>{Z(e=>({...e,ionVal:{...e.ionVal,neg:t}})),_({type:"set-ion-val",mode:"neg",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})]})]})]})]}),(0,a.jsx)(i.Z,{sx:{height:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center",textAlign:"center",mt:3},children:[(0,a.jsxs)(i.Z,{sx:{width:"30%"},children:[(0,a.jsxs)(c.Z,{type:"body2",children:["Select ",G?"Enrichment":"GSEA"," Ranking Metric"]}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:W,sx:{width:300},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"GSEA Ranking Metric"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:E,onChange:ee,renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{width:"30%"},children:[(0,a.jsx)(c.Z,{type:"body2",children:X?f[E.label].text1:"-"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:J,sx:{width:300},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:X?f[E.label].text2:""}),disabled:!X,isOptionEqualToValue:(e,t)=>e.label===t.label,value:S,onChange:(e,l)=>{if(null!=l&&(v(l),_({type:"set-sub-rank-col",subRankCol:l,omic:t}),["Mean difference","t-test"].includes(E.label))){w({g1:null,g2:null});let e=V[l.id].levels.map(e=>({label:e,id:e}));Y(e),_({type:"set-group-col-opts",groupColOpts:e,omic:t})}},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]}),X&&["Mean difference","t-test"].includes(E.label)&&(0,a.jsx)(m.Z,{children:(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",textAlign:"center",mt:5},children:["Mean difference","t-test"].includes(E.label)&&(0,a.jsxs)(i.Z,{sx:{display:"flex"},children:[(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 1st group"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:Q,sx:{width:200},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"1st Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:O.g1,onChange:(e,l)=>{w(e=>({...e,g1:l})),_({type:"set-group",g:"g1",value:l,omic:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(i.Z,{sx:{width:"20%",mx:2,display:"flex",alignItems:"flex-end"},children:(0,a.jsx)(c.Z,{type:"body1",sx:{py:2},children:"vs"})}),(0,a.jsxs)(i.Z,{sx:{},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 2nd group"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(x.Z,{options:Q,sx:{width:200},renderInput:e=>(0,a.jsx)(h.Z,{...e,label:"2nd Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:O.g2,onChange:(e,l)=>{w(e=>({...e,g2:l})),_({type:"set-group",g:"g2",value:l,omic:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})})}),(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:5},children:(0,a.jsx)(b.Z,{variant:"outlined",color:"primary",endIcon:(0,a.jsx)(g.Z,{}),disabled:!(T&&E&&S&&(!["Mean difference","t-test"].includes(E.label)||O.g1&&O.g2)&&(!G||A.msea||A.mummichog)&&(G||r&&l)),onClick:M,children:"Run QEA"})})]})]})},C=l(10537),Z=l(47042);let E=e=>{let{selDb:t,setDb:l,dbid:s,status:o,label:r,setShowEnrichment:c}=e,d=t==s,[u,p]=(0,n.useState)(!1),m="#00000015",x="#000000aa";return d?(m="#006633ff",x="#ffffff"):"ok"!=o?(m="#00000033",x="#000000aa"):u&&(m="#00000033",x="#000000aa"),(0,a.jsx)(i.Z,{sx:{px:1,py:.5,mx:.5,fontSize:"1em",color:x,backgroundColor:m,userSelect:"none",cursor:"ok"==o?"pointer":"no-drop",transition:"ease 1s"},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{"ok"==o&&(c(!1),setTimeout(()=>c(!0),500),l(e=>e.map(e=>e.db==s?{...e,show:!0}:{...e,show:!1})))},children:(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:["waiting"==o&&(0,a.jsx)(i.Z,{sx:{mr:1,display:"flex",alignItems:"center"},children:(0,a.jsx)(Z.Z,{disableShrink:!0,size:15})}),(0,a.jsx)(i.Z,{children:r})]})})};var k=e=>{let{db:t,selDb:l,setDb:n,setShowEnrichment:s}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex"},children:t.map(e=>(0,a.jsx)(E,{selDb:l,setDb:n,dbid:e.db,status:e.status,label:e.label,setShowEnrichment:s},e.db))})};let S=(e,t)=>{let l=e.length,a=t.length,n=l-1,s=a-1,i=e.reduce((e,t)=>e+t)/l,o=t.reduce((e,t)=>e+t)/a,r=e.map(e=>e-i^2).reduce((e,t)=>e+t)/n,c=t.map(e=>e-o^2).reduce((e,t)=>e+t)/s,d=(i-o)/Math.sqrt((r*n+c*s)/(n+s)*(1/l+1/a));return d},v=e=>{e=[...e].sort((e,t)=>e-t);let t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},O=(e,t)=>{let l=e.reduce((e,t)=>e+t)/e.length,a=t.reduce((e,t)=>e+t)/t.length;return l-a};var w=l(86056),M=l(33457),T=l(92069),A=l(93202);let G={muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},I={t:[{header:"Pathway",accessorKey:"pathway",size:310,...G},{header:"pval",accessorKey:"pval",size:80,filterFn:"lessThanOrEqualTo",...G,columnFilterModeOptions:[]},{header:"padj",accessorKey:"padj",filterFn:"lessThanOrEqualTo",size:100,columnFilterModeOptions:[],...G},{header:"ES",accessorKey:"ES",filterFn:"greaterThan",size:100,...G},{header:"NES",accessorKey:"NES",size:100,filterFn:"greaterThan",...G},{header:"N. Leading Edge",accessorKey:"nLeadingEdge",filterFn:"greaterThan",size:200,...G},{header:"Size",accessorKey:"size",size:120,filterFn:"greaterThan",...G}],m:[{header:"Pathway",accessorKey:"pathway",size:400,...G},{header:"pval",accessorKey:"p-value",size:80,filterFn:"lessThanOrEqualTo",...G,columnFilterModeOptions:[]},{header:"Overlap Size",accessorKey:"overlap_size",size:180,filterFn:"greaterThanOrEqualTo",...G,columnFilterModeOptions:["lessThanOrEqualTo","greaterThanOrEqualTo"]},{header:"Pathway Size",accessorKey:"pathway_size",size:180,filterFn:"greaterThanOrEqualTo",...G,columnFilterModeOptions:["lessThanOrEqualTo","greaterThanOrEqualTo"]},{header:"Features",accessorKey:"overlap_fid",size:220,...G,muiTableBodyCellProps:{align:"left"}}]},F=(e,t)=>{let l=(0,T.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"GSEA_Enrichment_".concat(t)}),a=(0,T.gB)(l)(e).replace(/,null/g,",");(0,T.LR)(l)(a)};var P=function(e){let{gseaRes:t,omic:l,db:s}=e,o="m"==l,r=(0,n.useMemo)(()=>{let e=null;return o&&["pos","neg"].includes(s)&&(e="mummichog"),o&&["KEGG","ChEBI"].includes(s)&&(e="msea"),e},[s,o]),c=(0,n.useMemo)(()=>I[o&&"mummichog"==r?"m":"t"],[o,r]),d=(0,n.useMemo)(()=>o&&"mummichog"==r?t.filter(e=>!(0==e.overlap_size||0==e.pathway_size)):t.map(e=>({...e,pval:0==e.pval?1e-4:e.pval,nLeadingEdge:e.leadingEdge.length,leadingEdge:e.leadingEdge.reduce((e,t)=>"".concat(e," // ").concat(t))})),[t,o,r]),u=(0,n.useMemo)(()=>o&&"mummichog"==r?d.map(e=>({...e,"p-value":Number.parseFloat(e["p-value"]).toExponential(2)})):d.map(e=>({...e,pval:0==e.pval?0:Number.parseFloat(e.pval).toExponential(2),padj:Number.parseFloat(e.padj).toExponential(2),ES:Number.parseFloat(e.ES),NES:Number.parseFloat(e.NES)})),[d,o,r]),[p,m]=(0,n.useState)({}),x=(0,M.X0)({columns:c,data:u,enableStickyHeader:!0,enableBottomToolbar:!1,enableColumnResizing:!0,enablePagination:!1,enableColumnPinning:!1,enableRowNumbers:!1,enableRowActions:!1,enableRowSelection:!0,enableMultiRowSelection:!0,enableDensityToggle:!1,enableColumnFilters:!0,enableColumnFilterModes:!0,enableFullScreenToggle:!1,enableHiding:!1,enableColumnActions:!1,muiTableContainerProps:{sx:{maxHeight:"500px"}},enableFacetedValues:!0,initialState:{density:"compact",showGlobalFilter:!0,showColumnFilters:!0},positionToolbarAlertBanner:"bottom",getRowId:e=>e.native,muiTableBodyRowProps:e=>{let{row:t}=e;return{onClick:t.getToggleSelectedHandler(),sx:{cursor:"pointer"}}},onRowSelectionChange:m,state:{rowSelection:p},renderTopToolbarCustomActions:e=>{let{table:t}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:(0,a.jsx)(b.Z,{onClick:()=>F(d,s),startIcon:(0,a.jsx)(A.Z,{}),children:"Export All Data"})})}});return(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,a.jsx)(i.Z,{sx:{width:1150,border:"0px solid red"},children:(0,a.jsx)(M.P2,{table:x})})})},R=l(22079),D=l(59637),_=l(38592);l(16691);var z=l(35048),V=l(38227),K=l(24235),N=l(50039),B=l(16573),q=l(19223),L=l(27978),H=l(90045),W=l(51125),J=l(30188);let $=e=>{let{ES:t,setBool:l,deltaZ:n,score:s,pvalue:o}=e;t.length;let r=t.map((e,t)=>({ES:e,index:t})),d=n.map((e,t)=>({deltaZ:e,index:t}));return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",my:0},children:(0,a.jsxs)(c.Z,{children:["Enrichment Score = ",Math.round(1e3*s)/1e3]})}),(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",my:1},children:(0,a.jsxs)(c.Z,{children:["Empirical p-value ","≤"," ",o]})}),(0,a.jsx)(i.Z,{children:(0,a.jsx)(z.h,{width:"100%",height:250,children:(0,a.jsxs)(V.w,{data:r,margin:{top:5,right:20,left:10,bottom:0},children:[(0,a.jsx)(K.K,{dataKey:"index",tick:!1}),(0,a.jsx)(N.B,{label:{value:"ES",angle:-90,position:"insideLeft"}}),(0,a.jsx)(B.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(q.x,{type:"monotone",dataKey:"ES",stroke:"grey",strokeWidth:1,dot:!1})]})})}),(0,a.jsx)(i.Z,{sx:{position:"relative",top:-28,border:"0px solid red"},children:(0,a.jsx)(z.h,{width:"100%",height:80,children:(0,a.jsxs)(V.w,{margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(B.q,{strokeDasharray:"3 3"}),(0,a.jsx)(K.K,{dataKey:"name",domain:(0,J.Z)(0,l.length,1),tick:!1}),(0,a.jsx)(N.B,{}),l.map((e,t)=>e&&(0,a.jsx)(L.d,{x:t,strokeWidth:.5,stroke:"grey"},t))]})})}),(0,a.jsx)(i.Z,{sx:{position:"relative",top:-58,border:"0px solid red"},children:(0,a.jsx)(z.h,{width:"100%",height:120,children:(0,a.jsxs)(H.T,{data:d,margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(K.K,{dataKey:"index",tick:!1}),(0,a.jsx)(N.B,{label:{value:"ΔZ",angle:-90,position:"insideLeft"}}),(0,a.jsx)(B.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(W.u,{type:"monotone",dataKey:"deltaZ",stroke:"grey",fill:"grey"})]})})})]})},X=(e,t)=>{var l,a;let n=e.map(e=>[...e,t.includes(e[0])]);(n=n.map(e=>[e[0],e[1],e[2],e[2]?Math.abs(e[1]):0,e[2]?0:1])).sort((e,t)=>t[1]-e[1]);let s=n.map(e=>e[3]).reduce((e,t)=>e+t),i=n.map(e=>e[4]).reduce((e,t)=>e+t),o=n.map((l=0,e=>l+=e[3]/s)),r=n.map((a=0,e=>a+=e[4]/i)),c=o.map((e,t)=>e-r[t]),d=n.map(e=>e[2]),u=n.map(e=>e[1]);return{ES:c,setBool:d,deltaZ:u,score:Math.abs(Math.max(...c))>Math.abs(Math.min(...c))?Math.max(...c):Math.min(...c)}};var U=function(e){let{f2MeanL:t,fSet:l}=e;(0,u.S)().BASE_URL;let[s,o]=(0,n.useState)(!1),r=(0,n.useMemo)(()=>Object.keys(t).map(e=>[e,t[e]]),[t]),{ES:d,setBool:p,deltaZ:m,score:x}=(0,n.useMemo)(()=>X(r,l),[r,l]),[h,b]=(0,n.useState)(null),g=(0,n.useCallback)(async()=>{let e=await new Promise(e=>{isNaN(x)&&e(1);let a=[];for(let e=0;e<100;e++){let e=function(e,t){let l=[],a=[...e];t=Math.min(t,e.length);for(let e=0;e<t;e++){let e=Math.floor(Math.random()*a.length),t=a.splice(e,1)[0];l.push(t)}return l}(Object.keys(t),l.length),n=X(r,e).score;a.push(n)}let n=a.filter(e=>Math.abs(e)>Math.abs(x)).length/100;e(n=0==n?.01:n)});b(e)},[x,100,t,l,r]);return(0,n.useEffect)(()=>{g()},[g]),(0,a.jsxs)(i.Z,{sx:{mt:0,height:540},children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(i.Z,{sx:{mr:2},children:(0,a.jsx)(c.Z,{variant:"h5",children:"Set Enrichment Analysis"})})}),(0,a.jsx)(i.Z,{sx:{mt:3,opacity:s?0:1,transition:"all ease 1s"},children:(0,a.jsx)($,{ES:d,setBool:p,deltaZ:m,score:x,pvalue:h})})]})};let Q=e=>{let{table:t,myData:l,setPlotGseaFn:n}=e,s=(e,t)=>{let l=e.getFilteredRowModel().rows.map(e=>e.original);console.log(l),console.log(t);let a=Object.keys(t[0])[0],n=l.map(e=>e[a]),s=t.map(e=>({...e,CustomSet:n.includes(e[a])})),i=(0,T.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"Enrichment_Table"}),o=(0,T.gB)(i)(s).replace(/,null/g,",").replace(/^null,/g,",");(0,T.LR)(i)(o)};return(0,a.jsxs)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:[(0,a.jsx)(i.Z,{children:(0,a.jsx)(_.UN,{table:t})}),(0,a.jsx)(b.Z,{onClick:()=>s(t,l),startIcon:(0,a.jsx)(A.Z,{}),children:"Export Table"}),(0,a.jsx)(b.Z,{disabled:t.getFilteredRowModel().rows.length===l.length,onClick:()=>n(),startIcon:(0,a.jsx)(D.Z,{}),children:"Plot GSEA"})]})};var Y=function(e){let{gseaData:t,omic:l}=e,s=(0,n.useMemo)(()=>{let e={};return Object.keys(t).map(l=>{t[l].f.map(a=>{e[a]=t[l].rank})}),e},[t]),[o]=(0,d.Z)(l),[r,c]=(0,n.useMemo)(()=>{let e=(0,C.$i)(o),t=Object.keys(e).map(t=>{let l={...e[t],rank:Number.parseFloat(Number.parseFloat(s[t]).toExponential(5))};return l}),l={};return t.map(e=>l[e[o.columns[0]]]=e.rank),[t,l]},[o,s]),u=(0,n.useMemo)(()=>{let e=(e,t,l)=>{let a;try{a=new RegExp(l)}catch(e){return!0}return a.test(e.getValue(t))};return[...o.columns.map((t,l)=>({header:t,accessorKey:t,muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"left"},filterFn:"string"==o.ctypes.values[l]?e:"equals",columnFilterModeOptions:"string"==o.ctypes.values[l]?[]:null,..."string"==o.ctypes.values[l]?{muiFilterTextFieldProps:{placeholder:"Regex"}}:{}})),{header:"Ranking Metric",accessorKey:"rank",muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"center"},filterFn:"greaterThan"}]},[o]),[p,m]=(0,n.useState)(!1),x=(0,n.useCallback)(()=>m(!0),[]),h=(0,M.X0)({columns:u,data:r,layoutMode:"grid",enableColumnResizing:!0,enableColumnActions:!1,enableSelectAll:!1,enableColumnFilterModes:!0,enableColumnFilters:!0,enableColumnOrdering:!0,enableColumnDragging:!1,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableDensityToggle:!1,enableFullScreenToggle:!0,enableGlobalFilter:!1,enableFilterMatchHighlighting:!1,muiTableContainerProps:{sx:{maxHeight:"500px"}},initialState:{density:"compact",showColumnFilters:!0,showGlobalFilter:!1,sorting:[{id:"rank",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiPaginationProps:{rowsPerPageOptions:[10],shape:"rounded",variant:"outlined"},renderTopToolbar:e=>{let{table:t}=e;return(0,a.jsx)(Q,{table:t,myData:r,setPlotGseaFn:x})}}),b=h.getFilteredRowModel().rows.map(e=>e.original[o.columns[0]]);return(0,a.jsxs)(i.Z,{sx:{px:5,pb:3,mt:2},children:[(0,a.jsx)(M.P2,{table:h}),(0,a.jsx)(R.Z,{onClose:()=>m(!1),open:p,maxWidth:"md",fullWidth:!0,children:(0,a.jsx)(i.Z,{sx:{p:4},children:(0,a.jsx)(U,{f2MeanL:c,fSet:b})})})]})},ee=l(80553);let et=e=>{let t=Object.keys(e).map(t=>({GeneName:e[t].egn,EntrezGene:e[t].eid,RankStat:e[t].rank}));t=t.filter(e=>e.GeneName&&e.EntrezGene&&e.RankStat);let l=[];return t.filter(e=>{let t=!0;return l.includes(e.egn)?t=!1:l.push(e.egn),t}),t},el=(e,t,l,a,n)=>{let s=structuredClone(e),i=Object.keys(s).map(e=>Math.abs(s[e].rank));i.sort(function(e,t){return t-e});let o=i[Math.ceil(.1*i.length)];Object.keys(s).map(e=>{s[e].id=e,s[e].rt=t[e][l.id],s[e].mode=t[e][a.id],s[e].pv=s[e].rank<-o||s[e].rank>o?0:1});let r={};Object.keys(n).map(e=>{n[e]&&(r[e]=Object.keys(s).map(e=>s[e]).filter(t=>t.mode==n[e].id))});let c={};return Object.keys(n).map(e=>{n[e]&&(c[e]="m/z	retention_time	p-value	t-score	custom_id\n",r[e].map(t=>{c[e]+="".concat(t.mz,"	").concat(t.rt,"	").concat(t.pv,"	").concat(t.rank,"	").concat(t.id,"\n")}))}),c},ea=e=>{let t={KEGG:[],ChEBI:[]},l={KEGG:Object.keys(e).map(t=>({ID:e[t].KEGG,RankStat:e[t].rank})).filter(e=>{let l=!1;return e.ID&&!t.KEGG.includes(e.ID)&&(l=!0,t.KEGG.push(e.ID)),l}),ChEBI:Object.keys(e).map(t=>({ID:e[t].ChEBI,RankStat:e[t].rank})).filter(e=>{let l=!1;return e.ID&&!t.ChEBI.includes(e.ID)&&(l=!0,t.ChEBI.push(e.ID)),l})};return l};var en=function(e){let{omic:t}=e,l="m"==t,{API_URL:o}=(0,u.S)(),{OS:x}=(0,s.tc)(),{jobID:h}=(0,s.tc)(),b=(0,p.a0)(),g=(0,p.mX)(),y=b.GSEA[t],[f]=(0,d.Z)(t),[Z,E]=(0,n.useState)(y.g2info),M=(0,s.tc)().norm["x".concat(t)],{mdataType:T}=(0,s.tc)(),[A,G]=(0,n.useState)(l?null:y.gidCol),[I,F]=(0,n.useState)(y.mParams),R=(0,n.useMemo)(()=>({msea:l&&!!I.mid&&!!I.midType,mummichog:l&&!!I.mz&&!!I.rt&&!!I.ionCol&&(!!I.ionVal.pos||!!I.ionVal.neg)}),[l,I]),[D,_]=(0,n.useState)(y.rankParams.rankCol),[z,V]=(0,n.useState)(y.rankParams.subRankCol),[K,N]=(0,n.useState)(y.rankParams.groups),[B,q]=(0,n.useState)(y.db),L=(0,n.useCallback)(()=>{let e="".concat(x.scientific_name.replace(" ","_"),"-").concat(D.label,"-").concat(z.id);return e+=["Mean difference","t-test"].includes(D.label)?"".concat(K.g1.id,"vs").concat(K.g2.id):"",l||(e+="-".concat(A.id)),R.msea&&(e+="-".concat(I.mid.id,"-").concat(I.midType.id)),R.mummichog&&(e+="-".concat(I.mz.id,"-").concat(I.rt.id)+(I.ionVal.pos.id?"_"+I.ionVal.pos.id:"")+(I.ionVal.neg.id?"_"+I.ionVal.neg.id:"")),e=e.replace(/[^a-zA-Z0-9]/g,"_")},[A,D,z,K,x,l,I,R]),[H,W]=(0,n.useState)(y.guiParams.gseaID),[J,$]=(0,n.useState)([]),[X,U]=(0,n.useState)(y.gseaData),[Q,en]=(0,n.useState)(y.guiParams.showGsea),[es,ei]=(0,n.useState)(y.guiParams.titleGsea),eo=(0,n.useCallback)(()=>{console.log("Run GSEA");let e={};if(l){if(f.index.map(t=>e[t]={f:[t]}),R.msea){let t=f.column(I.mid.id);t.index.map((l,a)=>{let n=t.values[a],s=ee.g[I.midType.id].indexOf(n);e[l].mid=n,e[l].KEGG=ee.g.KEGG[s],e[l].ChEBI=ee.g.ChEBI[s]})}if(R.mummichog){let t=f.column(I.mz.id);t.index.map((l,a)=>e[l].mz=t.values[a])}}else Object.keys(Z).map(t=>e[t]={...Z[t]});if("PCA"==D.label){let l=b.EDA.PCA[t].data.loadings,a=z.id.replace(/PCA/,"");Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>l[e][a])})}if("MOFA"==D.label){let l=b.MOFA.data.loadings[t][z.id];Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>l[e])})}if(["Mean difference","t-test"].includes(D.label)){let t=(0,C.$i)(M),l=T[z.id].level2id[K.g1.id].filter(e=>M.index.includes(e)),a=T[z.id].level2id[K.g2.id].filter(e=>M.index.includes(e));Object.keys(e).map(n=>{e[n].fRank=e[n].f.map(e=>{let n=l.map(l=>t[l][e]),s=a.map(l=>t[l][e]);return"Mean difference"==D.label?O(n,s):"t-test"==D.label?S(n,s):void 0})})}if("Custom"==D.label){let t=(0,C.$i)(f);Object.keys(e).map(l=>{e[l].fRank=e[l].f.map(e=>t[e][z.id])})}Object.keys(e).map(t=>{e[t].rank=v(e[t].fRank)}),U(e),g({type:"set-gsea-data",gseaData:e,omic:t});let a=L();W(a),$([{id:a}]);let n="Enrichment Analysis: ".concat(D.label," | ").concat(z.label,"\n            ").concat(["Mean difference","t-test"].includes(D.label)?" | "+K.g1.label+" vs "+K.g2.label:"");ei(n),en(!1),l?q(e=>e.map(e=>"Custom"==e.db?e:["KEGG","ChEBI"].includes(e.db)?R.msea?{...e,status:"waiting"}:{...e,status:""}:["pos","neg"].includes(e.db)?R.mummichog?{...e,status:"waiting"}:{...e,status:""}:void 0)):q(e=>e.map(e=>"Custom"==e.db?e:{...e,status:"waiting"})),q(e=>e.map(e=>({...e,show:"Custom"==e.db}))),setTimeout(()=>en(!0),500),g({type:"set-run-gsea",omic:t,guiParams:{gseaID:a,title:n,showGsea:!0}}),console.log("Executed")},[Z,D,z,K,f,L,l,T,R,t,b,M,I,g]),[er,ec]=(0,n.useState)("ready"),ed=(0,n.useRef)(),eu=(0,n.useCallback)(async e=>{console.log("fetchResults: Getting GSEA results for ",e);let a=await fetch("".concat(o,"/get_gsea/").concat(h,"/").concat(t,"/").concat(H,"/").concat(e)),n=await a.json();if("waiting"!=n.status){let a=null;if("ok"==n.status){if(l&&["pos","neg"].includes(e)){a=await (0,w.$)(n.gseaRes,"	",!1);let e=await (0,w.$)(n.usrInput2EC,"	",!1);a=a.map(t=>{if(!t["overlap_EmpiricalCompounds (id)"])return{...t,overlap_fid:""};{let l=t["overlap_EmpiricalCompounds (id)"].split(","),a=[...new Set(e.filter(e=>l.includes(e.EID)).map(e=>e.CompoundID_from_user))];return{...t,overlap_fid:a.join(",")}}})}else a=n.gseaRes}q(t=>t.map(t=>t.db==e?{...t,status:n.status,gseaID:H,gseaRes:a}:t)),g({type:"set-db",db:e,status:n.status,gseaID:H,gseaRes:a,omic:t}),clearInterval(ed.current[e]),console.log("GSEA results were got for ",e)}},[h,t,H,o,ed,l,g]),ep=(0,n.useCallback)(async()=>{let e;console.log("Start fetchRunGsea"),ec("sendJob");let a=x.scientific_name.replace(" ","_");if(l){if(R.msea){let l=ea(X);e=await fetch("".concat(o,"/run_msea/").concat(h,"/").concat(t,"/").concat(H,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});let n=await e.json();console.log("GSEA data (msea) was sent: ",n)}if(R.mummichog){let l=el(X,(0,C.$i)(f),I.rt,I.ionCol,I.ionVal);e=await fetch("".concat(o,"/run_mummichog/").concat(h,"/").concat(t,"/").concat(H,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});let n=await e.json();console.log("GSEA data (mummichog) was sent: ",n)}}else{let l=et(X);e=await fetch("".concat(o,"/run_gsea/").concat(h,"/").concat(t,"/").concat(H,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});let n=await e.json();console.log("GSEA data was sent: ",n)}console.log("fetchRunGsea will set a fetchResults interval to get GSEA results"),ed.current={},l?(R.msea&&(ed.current.KEGG=setInterval(()=>eu("KEGG"),5e3),ed.current.ChEBI=setInterval(()=>eu("ChEBI"),5e3)),R.mummichog&&Object.keys(I.ionVal).map(e=>{I.ionVal[e]&&(ed.current[e]=setInterval(()=>eu(e),5e3))}),console.log("Get for metabolomics")):B.filter(e=>"Custom"!=e.db).map(e=>{ed.current[e.db]=setInterval(()=>eu(e.db),5e3)})},[x,o,h,H,X,eu,ed,B,l,t,f,I,R]);(0,n.useEffect)(()=>{if(console.log("Launcher useEffect - is ready? - ",er,J),1!=J.length||"ready"!=er)return;console.log("Launcher useEffect calls fetchRunGsea");let e=setTimeout(ep,500);return()=>clearTimeout(e)},[J,ep,er]),(0,n.useEffect)(()=>{console.log("Ending useEffect - did finished?",er,B),B.every(e=>"waiting"!=e.status)&&"sendJob"==er&&(console.log("useEffect will handle GSEA finish"),$(e=>e.slice(1)),ec("ready"))},[J,B,er]);let[em,ex]=(0,n.useState)(!0),eh=B.filter(e=>e.show)[0].db;return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(j,{omic:t,g2info:Z,setG2info:E,gidCol:A,setGidCol:G,mParams:I,setMParams:F,mMethod:R,rankCol:D,setRankCol:_,subRankCol:z,setSubRankCol:V,groups:K,setGroups:N,handleRunGSEA:eo,ready:0==J.length}),Q&&(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(r.Z,{sx:{my:4},children:(0,a.jsx)(c.Z,{variant:"body2",children:es})}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(k,{db:B,selDb:eh,setDb:q,setShowEnrichment:ex})}),(0,a.jsx)(i.Z,{sx:{height:620},children:em&&(0,a.jsx)(m.Z,{children:"Custom"==eh?(0,a.jsx)(Y,{gseaData:X,omic:t}):(0,a.jsx)(P,{gseaRes:B.filter(e=>e.db==eh)[0].gseaRes,omic:t,db:eh})})})]})]})]})},es=function(){let{omics:e}=(0,s.tc)(),[t,l]=(0,n.useState)(e[0]),r=(0,n.useRef)();return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(o.Z,{selOmic:t,setSelOmic:l,omicViewRef:r}),(0,a.jsx)(i.Z,{ref:r,sx:{overflow:"hidden"},children:(0,a.jsx)(i.Z,{sx:{display:"flex",width:"".concat(e.length,"00%")},children:e.map(l=>(0,a.jsx)(i.Z,{sx:{width:"".concat(100/e.length,"%"),opacity:l==t?1:0,transition:"all 1s ease"},children:(0,a.jsx)(en,{omic:l})},l))})})]})}}}]);