"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[984],{26398:function(e,t,l){var a=l(26314);t.Z=void 0;var n=a(l(80984)),s=l(57437),i=(0,n.default)((0,s.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.Z=i},59637:function(e,t,l){var a=l(26314);t.Z=void 0;var n=a(l(80984)),s=l(57437),i=(0,n.default)((0,s.jsx)("path",{d:"m3.5 18.49 6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"}),"ShowChart");t.Z=i},73984:function(e,t,l){l.r(t),l.d(t,{default:function(){return eh}});var a=l(57437),n=l(2265),s=l(41637),i=l(96507),o=l(19636),r=l(54986),c=l(85269),d=l(75745),u=l(11093),p=l(64728),m=l(9140),h=l(70812),x=l(67248),g=l(49600),b=l(26398);let f=["ChEBI","KEGG","HMDB","PubChem"],y={"Mean difference":{text1:"Select metadata variable",text2:"Metadata Variable"},"t-test":{text1:"Select metadata variable",text2:"Metadata Variable"},PCA:{text1:"Select Principal Component",text2:"Principal Component"},MOFA:{text1:"Select MOFA Factor",text2:"MOFA Factor"},Custom:{text1:"Select column with ranking metric",text2:"Ranking Metric Column"}};var j=function(e){let{omic:t,g2info:l,setG2info:o,gidCol:r,setGidCol:j,mParams:Z,setMParams:C,rankCol:k,setRankCol:v,subRankCol:S,setSubRankCol:E,groups:w,setGroups:O,handleRunGSEA:M,ready:A,mMethod:I}=e,P="m"==t,{OMIC2NAME:G,API_URL:T}=(0,u.S)(),{OS:D,jobID:R}=(0,s.tc)(),V=(0,p.a0)(),F=(0,p.mX)(),_=V.GSEA[t],{mdataType:B}=(0,s.tc)(),[z]=(0,d.Z)(t),K=(0,n.useMemo)(()=>z.columns.map(e=>({label:e,id:e})),[z]),[N,q]=(0,n.useState)({}),L=async(e,l)=>{if(null==l)return;o(null),j(l);let a={},n=z.column(l.id);if(!P){if(Object.keys(N).includes(l.id))a=N[l.id];else{n.values.map((e,t)=>{Object.keys(a).includes(e)?a[e].f.push(n.index[t]):a[e]={f:[n.index[t]]}}),console.log("Fetch ENTREZ identifiers");let e=await fetch("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:D.id,target:"ENTREZGENE_ACC",query:Object.keys(a)})}),t=await e.json(),s=[];t.result.map(e=>{s.includes(e.incoming)||"None"==e.converted||(s.push(e.incoming),a[e.incoming].gn=e.name,a[e.incoming].egn=e.name.toUpperCase(),a[e.incoming].eid=e.converted)}),q(e=>({...e,[l.id]:a}))}}o(a),F({type:"set-g2info",omic:t,g2info:a,gidCol:l})},J=(0,p.a0)().status,W=(0,n.useMemo)(()=>[{label:"Mean difference",disabled:!Object.keys(B).some(e=>"categorical"==B[e].type)},{label:"t-test",disabled:!Object.keys(B).some(e=>"categorical"==B[e].type)},{label:"PCA",disabled:"ok"!=J.EDA_PCA.status},{label:"MOFA",disabled:"ok"!=J.MOFA.status},{label:"Custom",disabled:!z.ctypes.values.some(e=>e.includes("int")||e.includes("float"))}],[J,z,B]),[H,$]=(0,n.useState)(_.rankParams.subRankColOpts),[U,X]=(0,n.useState)(_.rankParams.showSubSection),[Y,Q]=(0,n.useState)(_.rankParams.groupColOpts),ee=async(e,l)=>{if(!l)return;v(l),E(null),Q([]),O({g1:null,g2:null}),X(!1),setTimeout(e=>X(!0),100);let a=[];if("PCA"==l.label){let e=V.EDA.PCA[t].data.explained_variance;if(null==e){let l=await fetch("".concat(T,"/get_eda_pca/").concat(R,"/").concat(t)),{resStatus:a,dataPCA:n}=await l.json();F({type:"set-eda-pca-data",data:n,omic:t}),F({type:"set-eda-pca-status",status:a,omic:t}),e=n.explained_variance}a=Object.keys(e).map(e=>({label:"PCA".concat(e),id:"PCA".concat(e)}))}if("MOFA"==l.label){let e;if(null==V.MOFA.data){let l=await fetch("".concat(T,"/get_mofa/").concat(R)),a=await l.json();F({type:"set-mofa-data",data:a.dataMOFA}),e=a.dataMOFA.explained_variance[t]}else e=V.MOFA.data.explained_variance[t];a=Object.keys(e).map(e=>({label:e,id:e}))}if(["Mean difference","t-test"].includes(l.label)&&(a=Object.keys(B).filter(e=>"categorical"==B[e].type).map(e=>({label:e,id:e}))),"Custom"==l.label){let e=z.ctypes;a=e.index.filter((t,l)=>e.values[l].includes("int")||e.values[l].includes("float")).map(e=>({label:e,id:e}))}$(a),F({type:"handle-rank-col-opts",omic:t,rankParams:{rankCol:l,subRankCol:null,groups:{g1:null,g2:null},subRankColOpts:a,groupColOpts:[],showSubSection:!0}})},[et,el]=(0,n.useState)(P?_.ionValOpts:[]);return(0,a.jsxs)(i.Z,{sx:{mt:2},children:[(0,a.jsxs)(i.Z,{children:[!P&&(0,a.jsxs)(i.Z,{sx:{textAlign:"center",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select column containing ".concat(G[t]," ID")}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:K,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"".concat(G[t]," ID column")}),isOptionEqualToValue:(e,t)=>e.id===t.id,value:r,onChange:L,renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),P&&(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",textAlign:"center"},children:[(0,a.jsxs)(i.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"MSEA"}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",flexDirection:"column",mt:2},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Metabolite ID"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:K,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Metabolite ID"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.mid,onChange:(e,t)=>{C(e=>({...e,mid:t})),F({type:"set-m-params",attr:"mid",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select ID Type"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:f.map(e=>({id:e,label:e})),sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"ID Type"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.midType,onChange:(e,t)=>{C(e=>({...e,midType:t})),F({type:"set-m-params",attr:"midType",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})]}),(0,a.jsx)(i.Z,{sx:{width:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(i.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"Mummichog"}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",mt:2},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Apex m/z Column"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:K,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Apex m/z"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.mz,onChange:(e,t)=>{C(e=>({...e,mz:t})),F({type:"set-m-params",attr:"mz",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Retention Time Column (min)"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:K,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"RT column (min)"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.rt,onChange:(e,t)=>{C(e=>({...e,rt:t})),F({type:"set-m-params",attr:"rt",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Ion Mode Column"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:K,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Ion Mode Column"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.ionCol,onChange:(e,t)=>{if(C(e=>({...e,ionCol:t})),F({type:"set-m-params",attr:"ionCol",value:t}),C(e=>({...e,ionVal:{pos:null,neg:null}})),F({type:"set-m-params",attr:"ionVal",value:{pos:null,neg:null}}),!t)return;let l=[...new Set(z.column(t.id).values)].map(e=>({label:e,id:e})).slice(0,10);el(l),F({type:"set-ion-val-opts",ionValOpts:l})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:4},children:[(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Positive Ion Value"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:et,sx:{width:150},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Positive Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.ionVal.pos,onChange:(e,t)=>{C(e=>({...e,ionVal:{...e.ionVal,pos:t}})),F({type:"set-ion-val",mode:"pos",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(i.Z,{sx:{width:"5%"}}),(0,a.jsxs)(i.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Negative Ion Value"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:et,sx:{width:150},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Negative Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:Z.ionVal.neg,onChange:(e,t)=>{C(e=>({...e,ionVal:{...e.ionVal,neg:t}})),F({type:"set-ion-val",mode:"neg",value:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})]})]})]})]}),(0,a.jsx)(i.Z,{sx:{height:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center",textAlign:"center",mt:3},children:[(0,a.jsxs)(i.Z,{sx:{width:"30%"},children:[(0,a.jsxs)(c.Z,{type:"body2",children:["Select ",P?"Enrichment":"GSEA"," Ranking Metric"]}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:W,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"GSEA Ranking Metric"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:k,onChange:ee,renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(i.Z,{sx:{width:"30%"},children:[(0,a.jsx)(c.Z,{type:"body2",children:U?y[k.label].text1:"-"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:H,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:U?y[k.label].text2:""}),disabled:!U,isOptionEqualToValue:(e,t)=>e.label===t.label,value:S,onChange:(e,l)=>{if(null!=l&&(E(l),F({type:"set-sub-rank-col",subRankCol:l,omic:t}),["Mean difference","t-test"].includes(k.label))){O({g1:null,g2:null});let e=B[l.id].levels.map(e=>({label:e,id:e}));Q(e),F({type:"set-group-col-opts",groupColOpts:e,omic:t})}},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]}),U&&["Mean difference","t-test"].includes(k.label)&&(0,a.jsx)(m.Z,{children:(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",textAlign:"center",mt:5},children:["Mean difference","t-test"].includes(k.label)&&(0,a.jsxs)(i.Z,{sx:{display:"flex"},children:[(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 1st group"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:Y,sx:{width:200},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"1st Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:w.g1,onChange:(e,l)=>{O(e=>({...e,g1:l})),F({type:"set-group",g:"g1",value:l,omic:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(i.Z,{sx:{width:"20%",mx:2,display:"flex",alignItems:"flex-end"},children:(0,a.jsx)(c.Z,{type:"body1",sx:{py:2},children:"vs"})}),(0,a.jsxs)(i.Z,{sx:{},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 2nd group"}),(0,a.jsx)(i.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(h.Z,{options:Y,sx:{width:200},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"2nd Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:w.g2,onChange:(e,l)=>{O(e=>({...e,g2:l})),F({type:"set-group",g:"g2",value:l,omic:t})},renderOption:(e,t)=>(0,n.createElement)("li",{...e,key:t.label},t.label)})})]})]})})}),(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",mt:5},children:(0,a.jsx)(g.Z,{variant:"outlined",color:"primary",endIcon:(0,a.jsx)(b.Z,{}),disabled:!(A&&k&&S&&(!["Mean difference","t-test"].includes(k.label)||w.g1&&w.g2)&&(!P||I.msea||I.mummichog)&&(P||r&&l)),onClick:M,children:"Run QEA"})})]})]})},Z=l(10537),C=l(47042);let k=e=>{let{selDb:t,setDb:l,dbid:s,status:o,label:r,setShowEnrichment:c}=e,d=t==s,[u,p]=(0,n.useState)(!1),m="#00000015",h="#000000aa";return d?(m="#006633ff",h="#ffffff"):"ok"!=o?(m="#00000033",h="#000000aa"):u&&(m="#00000033",h="#000000aa"),(0,a.jsx)(i.Z,{sx:{px:1,py:.5,mx:.5,fontSize:"1em",color:h,backgroundColor:m,userSelect:"none",cursor:"ok"==o?"pointer":"no-drop",transition:"ease 1s"},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{"ok"==o&&(c(!1),setTimeout(()=>c(!0),500),l(e=>e.map(e=>e.db==s?{...e,show:!0}:{...e,show:!1})))},children:(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:["waiting"==o&&(0,a.jsx)(i.Z,{sx:{mr:1,display:"flex",alignItems:"center"},children:(0,a.jsx)(C.Z,{disableShrink:!0,size:15})}),(0,a.jsx)(i.Z,{children:r})]})})};var v=e=>{let{db:t,selDb:l,setDb:n,setShowEnrichment:s}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex"},children:t.map(e=>(0,a.jsx)(k,{selDb:l,setDb:n,dbid:e.db,status:e.status,label:e.label,setShowEnrichment:s},e.db))})};let S=(e,t)=>{let l=e.length,a=t.length,n=l-1,s=a-1,i=e.reduce((e,t)=>e+t)/l,o=t.reduce((e,t)=>e+t)/a,r=e.map(e=>e-i^2).reduce((e,t)=>e+t)/n,c=t.map(e=>e-o^2).reduce((e,t)=>e+t)/s,d=(i-o)/Math.sqrt((r*n+c*s)/(n+s)*(1/l+1/a));return d},E=e=>{e=[...e].sort((e,t)=>e-t);let t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},w=(e,t)=>{let l=e.reduce((e,t)=>e+t)/e.length,a=t.reduce((e,t)=>e+t)/t.length;return l-a};var O=l(86056),M=l(98864),A=l.n(M),I=l(22079),P=l(93202),G=l(59637),T=l(33457),D=l(38592),R=l(92069);l(16691);var V=l(35048),F=l(38227),_=l(24235),B=l(50039),z=l(16573),K=l(19223),N=l(27978),q=l(90045),L=l(51125),J=l(30188);let W=e=>{let{ES:t,setBool:l,deltaZ:n,score:s,pvalue:o}=e;t.length;let r=t.map((e,t)=>({ES:e,index:t})),d=n.map((e,t)=>({deltaZ:e,index:t}));return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",my:0},children:(0,a.jsxs)(c.Z,{children:["Enrichment Score = ",Math.round(1e3*s)/1e3]})}),(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",my:1},children:(0,a.jsxs)(c.Z,{children:["Empirical p-value ","≤"," ",o]})}),(0,a.jsx)(i.Z,{children:(0,a.jsx)(V.h,{width:"100%",height:250,children:(0,a.jsxs)(F.w,{data:r,margin:{top:5,right:20,left:10,bottom:0},children:[(0,a.jsx)(_.K,{dataKey:"index",tick:!1}),(0,a.jsx)(B.B,{label:{value:"ES",angle:-90,position:"insideLeft"}}),(0,a.jsx)(z.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(K.x,{type:"monotone",dataKey:"ES",stroke:"grey",strokeWidth:1,dot:!1})]})})}),(0,a.jsx)(i.Z,{sx:{position:"relative",top:-28,border:"0px solid red"},children:(0,a.jsx)(V.h,{width:"100%",height:80,children:(0,a.jsxs)(F.w,{margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(z.q,{strokeDasharray:"3 3"}),(0,a.jsx)(_.K,{dataKey:"name",domain:(0,J.Z)(0,l.length,1),tick:!1}),(0,a.jsx)(B.B,{}),l.map((e,t)=>e&&(0,a.jsx)(N.d,{x:t,strokeWidth:.5,stroke:"grey"},t))]})})}),(0,a.jsx)(i.Z,{sx:{position:"relative",top:-58,border:"0px solid red"},children:(0,a.jsx)(V.h,{width:"100%",height:120,children:(0,a.jsxs)(q.T,{data:d,margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(_.K,{dataKey:"index",tick:!1}),(0,a.jsx)(B.B,{label:{value:"ΔZ",angle:-90,position:"insideLeft"}}),(0,a.jsx)(z.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(L.u,{type:"monotone",dataKey:"deltaZ",stroke:"grey",fill:"grey"})]})})})]})},H=(e,t)=>{var l,a;let n=e.map(e=>[...e,t.includes(e[0])]);(n=n.map(e=>[e[0],e[1],e[2],e[2]?Math.abs(e[1]):0,e[2]?0:1])).sort((e,t)=>t[1]-e[1]);let s=n.map(e=>e[3]).reduce((e,t)=>e+t),i=n.map(e=>e[4]).reduce((e,t)=>e+t),o=n.map((l=0,e=>l+=e[3]/s)),r=n.map((a=0,e=>a+=e[4]/i)),c=o.map((e,t)=>e-r[t]),d=n.map(e=>e[2]),u=n.map(e=>e[1]);return{ES:c,setBool:d,deltaZ:u,score:Math.abs(Math.max(...c))>Math.abs(Math.min(...c))?Math.max(...c):Math.min(...c)}};var $=function(e){let{f2MeanL:t,fSet:l}=e;(0,u.S)().BASE_URL;let[s,o]=(0,n.useState)(!1),r=(0,n.useMemo)(()=>Object.keys(t).map(e=>[e,t[e]]),[t]),{ES:d,setBool:p,deltaZ:m,score:h}=(0,n.useMemo)(()=>H(r,l),[r,l]),[x,g]=(0,n.useState)(null),b=(0,n.useCallback)(async()=>{let e=await new Promise(e=>{isNaN(h)&&e(1);let a=[];for(let e=0;e<100;e++){let e=function(e,t){let l=[],a=[...e];t=Math.min(t,e.length);for(let e=0;e<t;e++){let e=Math.floor(Math.random()*a.length),t=a.splice(e,1)[0];l.push(t)}return l}(Object.keys(t),l.length),n=H(r,e).score;a.push(n)}let n=a.filter(e=>Math.abs(e)>Math.abs(h)).length/100;e(n=0==n?.01:n)});g(e)},[h,100,t,l,r]);return(0,n.useEffect)(()=>{b()},[b]),(0,a.jsxs)(i.Z,{sx:{mt:0,height:540},children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(i.Z,{sx:{mr:2},children:(0,a.jsx)(c.Z,{variant:"h5",children:"Set Enrichment Analysis"})})}),(0,a.jsx)(i.Z,{sx:{mt:3,opacity:s?0:1,transition:"all ease 1s"},children:(0,a.jsx)(W,{ES:d,setBool:p,deltaZ:m,score:h,pvalue:x})})]})};let U=e=>{let{table:t,myData:l,setPlotGseaFn:n}=e,s=(e,t)=>{let l=e.getFilteredRowModel().rows.map(e=>e.original);console.log(l),console.log(t);let a=Object.keys(t[0])[0],n=l.map(e=>e[a]),s=t.map(e=>({...e,CustomSet:n.includes(e[a])})),i=(0,R.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"Enrichment_Table"}),o=(0,R.gB)(i)(s).replace(/,null/g,",").replace(/^null,/g,",");(0,R.LR)(i)(o)};return(0,a.jsxs)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:[(0,a.jsx)(i.Z,{children:(0,a.jsx)(D.UN,{table:t})}),(0,a.jsx)(g.Z,{onClick:()=>s(t,l),startIcon:(0,a.jsx)(P.Z,{}),children:"Export Table"}),(0,a.jsx)(g.Z,{disabled:t.getFilteredRowModel().rows.length===l.length,onClick:()=>n(),startIcon:(0,a.jsx)(G.Z,{}),children:"Plot GSEA"})]})};var X=function(e){let{gseaData:t,omic:l}=e,s=(0,n.useMemo)(()=>{let e={};return Object.keys(t).map(l=>{t[l].f.map(a=>{e[a]=t[l].rank})}),e},[t]),[o]=(0,d.Z)(l),[r,c]=(0,n.useMemo)(()=>{let e=(0,Z.$i)(o),t=Object.keys(e).map(t=>{let l={...e[t],rank:Number.parseFloat(Number.parseFloat(s[t]).toExponential(5))};return l}),l={};return t.map(e=>l[e[o.columns[0]]]=e.rank),[t,l]},[o,s]),u=(0,n.useMemo)(()=>{let e=(e,t,l)=>{let a;try{a=new RegExp(l)}catch(e){return!0}return a.test(e.getValue(t))};return[...o.columns.map((t,l)=>({header:t,accessorKey:t,muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"left"},filterFn:"string"==o.ctypes.values[l]?e:"equals",columnFilterModeOptions:"string"==o.ctypes.values[l]?[]:null,..."string"==o.ctypes.values[l]?{muiFilterTextFieldProps:{placeholder:"Regex"}}:{}})),{header:"Ranking Metric",accessorKey:"rank",muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"center"},filterFn:"greaterThan"}]},[o]),[p,m]=(0,n.useState)(!1),h=(0,n.useCallback)(()=>m(!0),[]),x=(0,T.X0)({columns:u,data:r,layoutMode:"grid",enableColumnResizing:!0,enableColumnActions:!1,enableSelectAll:!1,enableColumnFilterModes:!0,enableColumnFilters:!0,enableColumnOrdering:!0,enableColumnDragging:!1,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableDensityToggle:!1,enableFullScreenToggle:!0,enableGlobalFilter:!1,enableFilterMatchHighlighting:!1,muiTableContainerProps:{sx:{maxHeight:"500px"}},initialState:{density:"compact",showColumnFilters:!0,showGlobalFilter:!1,sorting:[{id:"rank",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiPaginationProps:{rowsPerPageOptions:[10],shape:"rounded",variant:"outlined"},renderTopToolbar:e=>{let{table:t}=e;return(0,a.jsx)(U,{table:t,myData:r,setPlotGseaFn:h})}}),g=x.getFilteredRowModel().rows.map(e=>e.original[o.columns[0]]);return(0,a.jsxs)(i.Z,{sx:{px:5,pb:3,mt:2},children:[(0,a.jsx)(T.P2,{table:x}),(0,a.jsx)(I.Z,{onClose:()=>m(!1),open:p,maxWidth:"md",fullWidth:!0,children:(0,a.jsx)(i.Z,{sx:{p:4},children:(0,a.jsx)($,{f2MeanL:c,fSet:g})})})]})},Y=l(35843),Q=l(91797),ee=l(52151),et=l(91928),el=l(46776),ea=l(33533),en=l(666);let es=(0,Y.ZP)(I.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function ei(){let[e,t]=n.useState(!1),l=()=>{t(!1)};return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(el.Z,{"aria-label":"question",size:"large",onClick:()=>{t(!0)},children:(0,a.jsx)(en.Z,{fontSize:"inherit"})}),(0,a.jsxs)(es,{onClose:l,"aria-labelledby":"customized-dialog-title",open:e,maxWidth:"lg",children:[(0,a.jsx)(Q.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:"Enrichment Analysis"}),(0,a.jsx)(el.Z,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,a.jsx)(ea.default,{})}),(0,a.jsxs)(ee.Z,{sx:{textAlign:"justify"},dividers:!0,children:[(0,a.jsx)(c.Z,{gutterBottom:!0,children:"Results of the Enrichment Analysis can be explored, providing insights into the biological pathways, processes, or functions that are significantly associated with the conditions or experimental groups in the study."}),(0,a.jsx)(c.Z,{gutterBottom:!0,children:"The results are displayed using various databases, allowing you to explore enriched categories such as pathways, gene sets, or functional groups relevant to your data."}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["In addition to the enrichment analysis of predefined categories, ",(0,a.jsx)("strong",{children:"custom enrichment analysis"})," can also be performed. For this purpose, begin by filtering the data table to define your ",(0,a.jsx)("strong",{children:"target set"}),". The filtering options allow you to select specific biomolecules based on criteria relevant to your study. The entire set of biomolecules serves as the background for the enrichment analysis. Once you have defined your target set through filtering, click the ",(0,a.jsx)("strong",{children:"Plot GSEA "}),"button at the top of the table to perform the custom enrichment analysis. This will generate results specifically tailored to the filtered biomolecule set"]})]}),(0,a.jsx)(et.Z,{})]})]})}let eo=A()(()=>l.e(112).then(l.bind(l,41112)),{loadableGenerated:{webpack:()=>[41112]}}),er=e=>{let t=Object.keys(e).map(t=>({GeneName:e[t].egn,EntrezGene:e[t].eid,RankStat:e[t].rank}));t=t.filter(e=>e.GeneName&&e.EntrezGene&&e.RankStat);let l=[];return t.filter(e=>{let t=!0;return l.includes(e.egn)?t=!1:l.push(e.egn),t}),t},ec=(e,t,l,a,n)=>{let s=structuredClone(e),i=Object.keys(s).map(e=>Math.abs(s[e].rank));i.sort(function(e,t){return t-e});let o=i[Math.ceil(.1*i.length)];Object.keys(s).map(e=>{s[e].id=e,s[e].rt=t[e][l.id],s[e].mode=t[e][a.id],s[e].pv=s[e].rank<-o||s[e].rank>o?0:1});let r={};Object.keys(n).map(e=>{n[e]&&(r[e]=Object.keys(s).map(e=>s[e]).filter(t=>t.mode==n[e].id))});let c={};return Object.keys(n).map(e=>{n[e]&&(c[e]="m/z	retention_time	p-value	t-score	custom_id\n",r[e].map(t=>{c[e]+="".concat(t.mz,"	").concat(t.rt,"	").concat(t.pv,"	").concat(t.rank,"	").concat(t.id,"\n")}))}),c},ed=e=>{let t={KEGG:[],ChEBI:[]},l={KEGG:Object.keys(e).map(t=>({ID:e[t].KEGG,RankStat:e[t].rank})).filter(e=>{let l=!1;return e.ID&&!t.KEGG.includes(e.ID)&&(l=!0,t.KEGG.push(e.ID)),l}),ChEBI:Object.keys(e).map(t=>({ID:e[t].ChEBI,RankStat:e[t].rank})).filter(e=>{let l=!1;return e.ID&&!t.ChEBI.includes(e.ID)&&(l=!0,t.ChEBI.push(e.ID)),l})};return l};var eu=function(e){let{omic:t}=e,o="m"==t,{API_URL:h}=(0,u.S)(),{OS:x}=(0,s.tc)(),{jobID:g}=(0,s.tc)(),b=(0,p.a0)(),f=(0,p.mX)(),y=b.GSEA[t],[C]=(0,d.Z)(t),[k,M]=(0,n.useState)(y.g2info),A=(0,s.tc)().norm["x".concat(t)],{mdataType:I}=(0,s.tc)(),[P,G]=(0,n.useState)(o?null:y.gidCol),[T,D]=(0,n.useState)(y.mParams),R=(0,n.useMemo)(()=>({msea:o&&!!T.mid&&!!T.midType,mummichog:o&&!!T.mz&&!!T.rt&&!!T.ionCol&&(!!T.ionVal.pos||!!T.ionVal.neg)}),[o,T]),[V,F]=(0,n.useState)(y.rankParams.rankCol),[_,B]=(0,n.useState)(y.rankParams.subRankCol),[z,K]=(0,n.useState)(y.rankParams.groups),[N,q]=(0,n.useState)(y.db),L=(0,n.useCallback)(()=>{let e="".concat(x.scientific_name.replace(" ","_"),"-").concat(V.label,"-").concat(_.id);return e+=["Mean difference","t-test"].includes(V.label)?"".concat(z.g1.id,"vs").concat(z.g2.id):"",o||(e+="-".concat(P.id)),R.msea&&(e+="-".concat(T.mid.id,"-").concat(T.midType.id)),R.mummichog&&(e+="-".concat(T.mz.id,"-").concat(T.rt.id)+(T.ionVal.pos.id?"_"+T.ionVal.pos.id:"")+(T.ionVal.neg.id?"_"+T.ionVal.neg.id:"")),e=e.replace(/[^a-zA-Z0-9]/g,"_")},[P,V,_,z,x,o,T,R]),[J,W]=(0,n.useState)(y.guiParams.gseaID),[H,$]=(0,n.useState)([]),[U,Y]=(0,n.useState)(y.gseaData),[Q,ee]=(0,n.useState)(y.guiParams.showGsea),[et,el]=(0,n.useState)(y.guiParams.titleGsea),ea=(0,n.useCallback)(()=>{console.log("Run GSEA");let e={};if(o){if(C.index.map(t=>e[t]={f:[t]}),R.msea){let t=l(91794),a=C.column(T.mid.id);a.index.map((l,n)=>{let s=a.values[n],i=t[T.midType.id].indexOf(s);e[l].mid=s,e[l].KEGG=t.KEGG[i],e[l].ChEBI=t.ChEBI[i]})}if(R.mummichog){let t=C.column(T.mz.id);t.index.map((l,a)=>e[l].mz=t.values[a])}}else Object.keys(k).map(t=>e[t]={...k[t]});if("PCA"==V.label){let l=b.EDA.PCA[t].data.loadings,a=_.id.replace(/PCA/,"");Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>l[e][a])})}if("MOFA"==V.label){let l=b.MOFA.data.loadings[t][_.id];Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>l[e])})}if(["Mean difference","t-test"].includes(V.label)){let t=(0,Z.$i)(A),l=I[_.id].level2id[z.g1.id].filter(e=>A.index.includes(e)),a=I[_.id].level2id[z.g2.id].filter(e=>A.index.includes(e));Object.keys(e).map(n=>{e[n].fRank=e[n].f.map(e=>{let n=l.map(l=>t[l][e]),s=a.map(l=>t[l][e]);return"Mean difference"==V.label?w(n,s):"t-test"==V.label?S(n,s):void 0})})}if("Custom"==V.label){let t=(0,Z.$i)(C);Object.keys(e).map(l=>{e[l].fRank=e[l].f.map(e=>t[e][_.id])})}Object.keys(e).map(t=>{e[t].rank=E(e[t].fRank)}),Y(e),f({type:"set-gsea-data",gseaData:e,omic:t});let a=L();W(a),$([{id:a}]);let n="Enrichment Analysis: ".concat(V.label," | ").concat(_.label,"\n            ").concat(["Mean difference","t-test"].includes(V.label)?" | "+z.g1.label+" vs "+z.g2.label:"");el(n),ee(!1),o?q(e=>e.map(e=>"Custom"==e.db?e:["KEGG","ChEBI"].includes(e.db)?R.msea?{...e,status:"waiting"}:{...e,status:""}:["pos","neg"].includes(e.db)?R.mummichog?{...e,status:"waiting"}:{...e,status:""}:void 0)):q(e=>e.map(e=>"Custom"==e.db?e:{...e,status:"waiting"})),q(e=>e.map(e=>({...e,show:"Custom"==e.db}))),setTimeout(()=>ee(!0),500),f({type:"set-run-gsea",omic:t,guiParams:{gseaID:a,title:n,showGsea:!0}}),console.log("Executed")},[k,V,_,z,C,L,o,I,R,t,b,A,T,f]),[en,es]=(0,n.useState)("ready"),eu=(0,n.useRef)(),ep=(0,n.useCallback)(async e=>{console.log("fetchResults: Getting GSEA results for ",e);let l=await fetch("".concat(h,"/get_gsea/").concat(g,"/").concat(t,"/").concat(J,"/").concat(e)),a=await l.json();if("waiting"!=a.status){let l=null;if("ok"==a.status){if(o&&["pos","neg"].includes(e)){let e;[l,e]=await (0,O.$)(a.gseaRes,"	",!1);let[t,n]=await (0,O.$)(a.usrInput2EC,"	",!1);l=l.map(e=>{if(!e["overlap_EmpiricalCompounds (id)"])return{...e,overlap_fid:""};{let l=e["overlap_EmpiricalCompounds (id)"].split(","),a=[...new Set(t.filter(e=>l.includes(e.EID)).map(e=>e.CompoundID_from_user))];return{...e,overlap_fid:a.join(",")}}})}else l=a.gseaRes}q(t=>t.map(t=>t.db==e?{...t,status:a.status,gseaID:J,gseaRes:l}:t)),f({type:"set-db",db:e,status:a.status,gseaID:J,gseaRes:l,omic:t}),clearInterval(eu.current[e]),console.log("GSEA results were got for ",e)}},[g,t,J,h,eu,o,f]),em=(0,n.useCallback)(async()=>{let e;console.log("Start fetchRunGsea"),es("sendJob");let l=x.scientific_name.replace(" ","_");if(o){if(R.msea){let a=ed(U);e=await fetch("".concat(h,"/run_msea/").concat(g,"/").concat(t,"/").concat(J,"/").concat(l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let n=await e.json();console.log("GSEA data (msea) was sent: ",n)}if(R.mummichog){let a=ec(U,(0,Z.$i)(C),T.rt,T.ionCol,T.ionVal);e=await fetch("".concat(h,"/run_mummichog/").concat(g,"/").concat(t,"/").concat(J,"/").concat(l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let n=await e.json();console.log("GSEA data (mummichog) was sent: ",n)}}else{let a=er(U);e=await fetch("".concat(h,"/run_gsea/").concat(g,"/").concat(t,"/").concat(J,"/").concat(l),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let n=await e.json();console.log("GSEA data was sent: ",n)}console.log("fetchRunGsea will set a fetchResults interval to get GSEA results"),eu.current={},o?(R.msea&&(eu.current.KEGG=setInterval(()=>ep("KEGG"),5e3),eu.current.ChEBI=setInterval(()=>ep("ChEBI"),5e3)),R.mummichog&&Object.keys(T.ionVal).map(e=>{T.ionVal[e]&&(eu.current[e]=setInterval(()=>ep(e),5e3))}),console.log("Get for metabolomics")):N.filter(e=>"Custom"!=e.db).map(e=>{eu.current[e.db]=setInterval(()=>ep(e.db),5e3)})},[x,h,g,J,U,ep,eu,N,o,t,C,T,R]);(0,n.useEffect)(()=>{if(console.log("Launcher useEffect - is ready? - ",en,H),1!=H.length||"ready"!=en)return;console.log("Launcher useEffect calls fetchRunGsea");let e=setTimeout(em,500);return()=>clearTimeout(e)},[H,em,en]),(0,n.useEffect)(()=>{console.log("Ending useEffect - did finished?",en,N),N.every(e=>"waiting"!=e.status)&&"sendJob"==en&&(console.log("useEffect will handle GSEA finish"),$(e=>e.slice(1)),es("ready"))},[H,N,en]);let[eh,ex]=(0,n.useState)(!0),eg=N.filter(e=>e.show)[0].db;return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(j,{omic:t,g2info:k,setG2info:M,gidCol:P,setGidCol:G,mParams:T,setMParams:D,mMethod:R,rankCol:V,setRankCol:F,subRankCol:_,setSubRankCol:B,groups:z,setGroups:K,handleRunGSEA:ea,ready:0==H.length}),Q&&(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(r.Z,{sx:{my:4},children:(0,a.jsx)(c.Z,{variant:"body2",children:et})}),(0,a.jsx)(i.Z,{sx:{height:0,position:"relative",top:-25},children:(0,a.jsx)(ei,{})}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(v,{db:N,selDb:eg,setDb:q,setShowEnrichment:ex})}),(0,a.jsx)(i.Z,{sx:{height:620},children:eh&&(0,a.jsx)(m.Z,{children:"Custom"==eg?(0,a.jsx)(X,{gseaData:U,omic:t}):(0,a.jsx)(eo,{gseaRes:N.filter(e=>e.db==eg)[0].gseaRes,omic:t,db:eg})})})]})]})]})};let ep=(0,Y.ZP)(I.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function em(){let[e,t]=n.useState(!1),l=()=>{t(!1)};return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(el.Z,{"aria-label":"question",size:"large",onClick:()=>{t(!0)},children:(0,a.jsx)(en.Z,{fontSize:"inherit"})}),(0,a.jsxs)(ep,{onClose:l,"aria-labelledby":"customized-dialog-title",open:e,maxWidth:"lg",children:[(0,a.jsx)(Q.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:"Enrichment Analysis"}),(0,a.jsx)(el.Z,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,a.jsx)(ea.default,{})}),(0,a.jsxs)(ee.Z,{sx:{textAlign:"justify"},dividers:!0,children:[(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["This section enables you to perform Enrichment Analysis using the ",(0,a.jsx)("strong",{children:"Gene Set Enrichment Analysis (GSEA) "})," [1] algorithm on each omic dataset independently. You can switch between omics using the navigator bar at the top of the page to explore results for different data types."]}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["It must be specified the column in your omic metadata table that contains the biomolecule identifiers. If you are working with ",(0,a.jsx)("strong",{children:"untargeted metabolomics"})," data, you can choose to perform enrichment analysis using the ",(0,a.jsx)("strong",{children:"Mummichog"})," [2] algorithm. For this analysis, you need to provide the following additional columns from your omic metadata table: Apex m/z, Retention Time (min), Ion Mode."]}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["It must also be selected the ",(0,a.jsx)("strong",{children:"metric used for the enrichment analysis"}),". You can choose from various metrics calculated by TurboOmics, such as PCA components or MOFA factors. In addition, it must be indicated the column from your experimental metadata table that contains the ",(0,a.jsx)("strong",{children:"groups to be compared"}),"."]})]}),(0,a.jsx)(et.Z,{children:(0,a.jsxs)(i.Z,{sx:{textAlign:"justify",p:2},children:[(0,a.jsx)(c.Z,{gutterBottom:!0,children:"[1] Subramanian A, Tamayo P, Mootha VK, Mukherjee S, Ebert BL, Gillette MA, Paulovich A, Pomeroy SL, Golub TR, Lander ES, Mesirov JP. Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles. Proc Natl Acad Sci U S A. 2005 Oct 25;102(43):15545-50. doi: 10.1073/pnas.0506580102. Epub 2005 Sep 30. PMID: 16199517; PMCID: PMC1239896."}),(0,a.jsx)(c.Z,{gutterBottom:!0,children:"[2] Li S, Park Y, Duraisingham S, Strobel FH, Khan N, Soltow QA, Jones DP, Pulendran B. Predicting network activity from high throughput metabolomics. PLoS Comput Biol. 2013;9(7):e1003123. doi: 10.1371/journal.pcbi.1003123. Epub 2013 Jul 4. PMID: 23861661; PMCID: PMC3701697."})]})})]})]})}var eh=function(){let{omics:e}=(0,s.tc)(),[t,l]=(0,n.useState)(e[0]),r=(0,n.useRef)();return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.Z,{sx:{height:0},children:(0,a.jsx)(em,{})}),(0,a.jsx)(o.Z,{selOmic:t,setSelOmic:l,omicViewRef:r}),(0,a.jsx)(i.Z,{ref:r,sx:{overflow:"hidden"},children:(0,a.jsx)(i.Z,{sx:{display:"flex",width:"".concat(e.length,"00%")},children:e.map(l=>(0,a.jsx)(i.Z,{sx:{width:"".concat(100/e.length,"%"),opacity:l==t?1:0,transition:"all 1s ease"},children:(0,a.jsx)(eu,{omic:l})},l))})})]})}}}]);