"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{19416:function(e,t,l){var n=l(26314);t.Z=void 0;var i=n(l(80984)),a=l(57437),s=(0,i.default)((0,a.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"ReportProblem");t.Z=s},26398:function(e,t,l){var n=l(26314);t.Z=void 0;var i=n(l(80984)),a=l(57437),s=(0,i.default)((0,a.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.Z=s},96985:function(e,t,l){l.r(t),l.d(t,{default:function(){return D}});var n=l(57437),i=l(96507),a=l(54986),s=l(54755),r=l(85269),o=l(2265);let c=e=>{let{title:t,view:l,setView:a,resetJobStatus:s={resetJobStatus:s}}=e,r=t==l,[c,d]=(0,o.useState)(!1),u="#00000015",p="#000000aa";return r?(u="#1976D2ff",p="#ffffff"):c&&(u="#00000033",p="#000000aa"),(0,n.jsx)(i.Z,{sx:{px:2,py:1,mx:.1,width:"50%",fontSize:"1.1em",textAlign:"center",cursor:"pointer",transition:"all 1s ease",backgroundColor:u,color:p},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onClick:()=>{s(),a(t)},children:t})};var d=e=>{let{view:t,setView:l,resetJobStatus:a}=e;return(0,n.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,n.jsxs)(i.Z,{sx:{display:"flex",width:350},children:[(0,n.jsx)(c,{title:"Single-View",view:t,setView:l,resetJobStatus:a}),(0,n.jsx)(c,{title:"Multi-View",view:t,setView:l,resetJobStatus:a})]})})},u=l(41637),p=l(64728),x=l(11093),m=l(49600),h=l(70812),b=l(67248),f=l(5096),g=l(35009),j=l(46349),y=l(64494),I=l(26398);let v={m:[{label:"ChEBI",id:"ChEBI"},{label:"KEGG",id:"KEGG"},{label:"PubChem (CID)",id:"PubChem"},{label:"HMDB",id:"HMDB"}],q:[{label:"Uniprot Protein ID",id:"Uniprot Protein ID"},{label:"Entrez ID",id:"Entrez ID"},{label:"Ensembl Gene ID",id:"Ensembl Gene ID"},{label:"Ensembl Transcript ID ",id:"Ensembl Transcript ID"},{label:"Official Gene Symbol",id:"Official Gene Symbol"}],t:[{label:"Uniprot Protein ID",id:"Uniprot Protein ID"},{label:"Entrez ID",id:"Entrez ID"},{label:"Ensembl Gene ID",id:"Ensembl Gene ID"},{label:"Ensembl Transcript ID ",id:"Ensembl Transcript ID"},{label:"Official Gene Symbol",id:"Official Gene Symbol"}]},w=e=>{let{o:t,omicIdCol_i:l,setOmicIdCol_i:a,omicIdType_i:s,setOmicIdType_i:r,handleOmicIdChange:c}=e,{OMIC2NAME:d}=(0,x.S)(),p=(0,u.tc)().user["".concat(t,"2i")].columns.map(e=>({label:e,id:e}));return(0,n.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,n.jsx)(i.Z,{children:(0,n.jsx)(h.Z,{value:l,onChange:(e,l)=>{a(l),c(t,l,s)},isOptionEqualToValue:(e,t)=>e.id===t.id,id:"omic-id-column",options:p,sx:{width:250},renderInput:e=>(0,n.jsx)(b.Z,{...e,label:"".concat(d[t]," ID Column")}),renderOption:(e,t)=>(0,o.createElement)("li",{...e,key:t.label},t.label)})}),(0,n.jsx)(i.Z,{sx:{mt:4},children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(g.Z,{id:"demo-simple-select-label",children:"ID Type"}),(0,n.jsx)(j.Z,{sx:{minWidth:"180px"},labelId:"demo-controlled-open-select-label",id:"demo-controlled-open-select",value:s,label:"ID Type",onChange:e=>{r(e.target.value),c(t,l,e.target.value)},children:v[t].map(e=>(0,n.jsx)(y.Z,{value:e,children:e.label},e.id))})]})})]},t)};var C=function(e){let{setRId2info:t,fetchJobRun:a}=e,{omics:s,mdataType:c,OS:d,f2x:x}=(0,u.tc)(),f=(0,u.tc)().user,g=(0,p.mX)();(0,p.a0)().PWA;let j=f.mdata,[y,C]=(0,o.useState)(null),[Z,S]=(0,o.useState)({isCategorical:!1,colOpts:[],g1:null,g2:null}),[O,E]=(0,o.useState)(s.reduce((e,t)=>({...e,[t]:null}),{})),[D,T]=(0,o.useState)(s.reduce((e,t)=>({...e,[t]:v[t][0]}),{})),[_,k]=(0,o.useState)(s.reduce((e,t)=>({...e,[t]:null}),{})),P=async(e,n,i)=>{if(console.log(e,n,i),!n){k(t=>({...t,[e]:null})),t(t=>({...t,[e]:{}}));return}let a=f["".concat(e,"2i")].column(n.id),s=x[e],r=a.index.filter((e,t)=>s[t]),o=a.values.filter((e,t)=>s[t]),c=[],u={},p={};if("m"==e){i.id;{let e=l(91794),t=o.map(t=>e[i.id].indexOf(t));(c=t.map(t=>e.ChEBI[t])).map((l,n)=>{l&&(p[l]={xId:r[n],uId:o[n],Name:e.Name[t[n]]})})}}else if("q"==e||"t"==e){i.id;{let e=[],t=await fetch("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:d.id,query:o,target:"UNIPROTSWISSPROT_ACC"})}),l=await t.json();e=l.result.filter(e=>"None"!=e.converted&&1==e.n_converted);let n=e.map(e=>e.incoming),i=await fetch("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:d.id,query:o.filter(e=>!n.includes(e)),target:"UNIPROTSPTREMBL_ACC"})}),a=await i.json();e.concat(a.result.filter(e=>"None"!=e.converted&&1==e.n_converted));let s={};r.map((e,t)=>s[e]=o[t]);let u={};e.map(e=>u[e.incoming]=e.converted),c=r.map(e=>u[s[e]]);let x={};o.map((e,t)=>x[e]=r[t]),e.map(e=>{p[e.converted]={uId:e.incoming,xId:x[e.incoming],name:e.name,description:e.description}})}}r.map((e,t)=>{c[t]&&(u[e]=c[t])}),k(t=>({...t,[e]:u})),t(t=>({...t,[e]:p}))};return(0,n.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-evenly",mt:4},children:[(0,n.jsxs)(i.Z,{sx:{width:"25%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,n.jsx)(i.Z,{sx:{textAlign:"center",mt:7,position:"absolute",top:145},children:(0,n.jsx)(m.Z,{variant:"outlined",color:"primary",endIcon:(0,n.jsx)(I.Z,{}),disabled:!(y&&(!Z.isCategorical||Z.g1&&Z.g2)&&Object.values(O).some(e=>e)),onClick:()=>a(y,Z,_),children:"Run Analysis"})}),(0,n.jsx)(i.Z,{sx:{display:"flex"},children:(0,n.jsx)(h.Z,{value:y,onChange:(e,t)=>{t&&(C(t),g({type:"set-pwa-attr",attr:"mdataCol",value:t}),"categorical"==c[t.id].type?S(e=>({isCategorical:!0,colOpts:c[t.id].levels.map(e=>({label:e,id:e})),g1:null,g2:null})):S(e=>({isCategorical:!1,colOpts:[],g1:null,g2:null})))},isOptionEqualToValue:(e,t)=>e.id===t.id,id:"metadata-column",options:j.columns.map(e=>({label:e,id:e})),sx:{width:300},renderInput:e=>(0,n.jsx)(b.Z,{...e,label:"Metadata Column"}),renderOption:(e,t)=>(0,o.createElement)("li",{...e,key:t.label},t.label)})}),(0,n.jsxs)(i.Z,{sx:{display:"flex",mt:4,alignItems:"center",opacity:Z.isCategorical?1:0,transition:"all 0.5s ease"},children:[(0,n.jsx)(i.Z,{children:(0,n.jsx)(h.Z,{value:Z.g1,onChange:(e,t)=>S(e=>({...e,g1:t})),isOptionEqualToValue:(e,t)=>e.id===t.id,id:"metadata-column",options:Z.colOpts,sx:{width:150},renderInput:e=>(0,n.jsx)(b.Z,{...e,label:"First Group"}),renderOption:(e,t)=>(0,o.createElement)("li",{...e,key:t.label},t.label)})}),(0,n.jsx)(i.Z,{sx:{px:2},children:(0,n.jsx)(r.Z,{children:"vs"})}),(0,n.jsx)(i.Z,{children:(0,n.jsx)(h.Z,{value:Z.g2,onChange:(e,t)=>S(e=>({...e,g2:t})),isOptionEqualToValue:(e,t)=>e.id===t.id,id:"metadata-column",options:Z.colOpts,sx:{width:150},renderInput:e=>(0,n.jsx)(b.Z,{...e,label:"Second Group"}),renderOption:(e,t)=>(0,o.createElement)("li",{...e,key:t.label},t.label)})})]})]}),(0,n.jsx)(i.Z,{sx:{width:"2%",borderWidth:"0px 1.5px 0px 0px",borderStyle:"dashed",borderColor:"#aaaaaa"}}),(0,n.jsx)(i.Z,{sx:{width:"55%",display:"flex",justifyContent:"space-evenly"},children:s.map(e=>(0,n.jsx)(w,{o:e,omicIdCol_i:O[e],setOmicIdCol_i:t=>E(l=>({...l,[e]:t})),omicIdType_i:D[e],setOmicIdType_i:t=>T(l=>({...l,[e]:t})),handleOmicIdChange:P},e))})]})},Z=l(19416),S=l(98864),O=l.n(S);let E=O()(()=>Promise.all([l.e(48),l.e(125),l.e(607)]).then(l.bind(l,81607)),{loadableGenerated:{webpack:()=>[81607]}});var D=function(){let[e,t]=(0,o.useState)("Single-View"),{API_URL:l}=(0,x.S)(),{omics:c,jobID:p,OS:m}=(0,u.tc)(),[h,b]=(0,o.useState)(c.reduce((e,t)=>({...e,[t]:{}}),{})),f=(0,o.useRef)(),[g,j]=(0,o.useState)({status:"",res:null,runId:null}),[y,I]=(0,o.useState)([]),[v,w]=(0,o.useState)(),S=(0,o.useCallback)(async t=>{let n=await fetch("".concat(l,"/get_pathway_analysis/").concat(p,"/").concat(e,"/").concat(t)),i=await n.json();"waiting"!=i.status&&(console.log("Pathway analysis finished: ",i),j(i),clearInterval(f.current))},[f,e,l,p]),O=(0,o.useCallback)(async(t,n,i)=>{console.log("Send job to back-end");let a=new Date().getTime(),s=await fetch("".concat(l,"/run_pathway_analysis/").concat(p,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({col:t.id,type:n.isCategorical?"categorical":"numeric",val1:n.g1.id,val2:n.g2.id,f2id:i,view:e,OS:m.scientific_name.replace(" ","_")})}),r=await s.json();console.log(r),j({status:"waiting",res:null,runId:r.runId}),f.current=setInterval(()=>S(r.runId),5e3),I(Object.keys(i).filter(e=>i[e])),w({...n,mdataCol:t.id})},[e,I,j,w,l,m,S,p]);return(0,n.jsxs)(i.Z,{children:[(0,n.jsx)(i.Z,{sx:{pt:3},children:(0,n.jsx)(d,{view:e,setView:t,resetJobStatus:()=>j({status:"",res:null,runId:null})})}),(0,n.jsx)(C,{setRId2info:b,fetchJobRun:O}),(0,n.jsx)(a.Z,{sx:{py:4,color:"black"},children:" "}),"waiting"==g.status&&(0,n.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,n.jsx)(i.Z,{sx:{width:"50%",pt:10},children:(0,n.jsx)(s.Z,{sx:{height:"2px"}})})}),"ok"==g.status&&(0,n.jsx)(E,{pwa_res:g.pwa_res,runId:g.runId,rId2info:h,view:e,workingOmics:y,mdataCategorical:v}),"error"==g.status&&(0,n.jsx)(i.Z,{children:(0,n.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",pt:10},children:[(0,n.jsx)(Z.Z,{sx:{fontSize:25}}),(0,n.jsx)(r.Z,{variant:"h6",sx:{px:2},children:"An error occurred when executing Pathway Analysis."})]})})]})}}}]);