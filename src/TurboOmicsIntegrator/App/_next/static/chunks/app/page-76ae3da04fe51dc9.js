(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{30151:function(e,t,a){Promise.resolve().then(a.bind(a,28325)),Promise.resolve().then(a.bind(a,11093)),Promise.resolve().then(a.bind(a,24311))},28325:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var l=a(57437),n=a(42824),s=a(57380),r=a(87550),i=a(57175),o=a(11093),c=a(16691),d=a.n(c);function u(){let e=(0,o.useVars)().BASE_URL;return(0,l.jsxs)(r.Z,{bg:"dark","data-bs-theme":"dark",className:"bg-body-tertiary",style:{fontSize:"1.2em"},children:[(0,l.jsxs)(n.Z,{className:"mx-0",children:[(0,l.jsx)(r.Z.Brand,{href:"#home",children:(0,l.jsx)(d(),{src:"".concat(e,"/icon.ico"),width:"30",height:"30",className:"d-inline-block align-top",alt:"TurboPutative"})}),(0,l.jsx)(r.Z.Toggle,{"aria-controls":"basic-navbar-nav"}),(0,l.jsx)(r.Z.Collapse,{id:"basic-navbar-nav",children:(0,l.jsxs)(s.Z,{className:"me-auto",children:[(0,l.jsx)(s.Z.Link,{href:"home",className:"mx-2",children:"Home"}),(0,l.jsx)(s.Z.Link,{href:"TurboOmicsApp.html",active:!0,className:"mx-2",children:"TurboOmics"}),(0,l.jsx)(s.Z.Link,{href:"webserver",className:"mx-2",children:"Web Server"}),(0,l.jsx)(s.Z.Link,{href:"webservices",className:"mx-2",children:"Web Services"}),(0,l.jsxs)(i.Z,{title:"Help",id:"basic-nav-dropdown",children:[(0,l.jsx)(i.Z.Item,{href:"webserverhelp",children:"Web Server"}),(0,l.jsx)(i.Z.Item,{href:"webserviceshelp",children:"Web Services"}),(0,l.jsx)(i.Z.Divider,{}),(0,l.jsx)(i.Z.Item,{href:"moduleshelp",children:"Modules"})]}),(0,l.jsx)(s.Z.Link,{href:"contactUs",className:"mx-2",children:"Contact us"})]})})]}),(0,l.jsx)(r.Z.Collapse,{className:"justify-content-end",children:(0,l.jsx)(r.Z.Brand,{href:"home",style:{fontSize:"1.2em"},children:"TurboPutative"})})]})}},11093:function(e,t,a){"use strict";a.r(t),a.d(t,{VarsProvider:function(){return r},useVars:function(){return i}});var l=a(57437),n=a(2265);let s=(0,n.createContext)({DEV_MODE:!1,BASE_URL:"/TurboPutative",API_URL:"https://proteomics.cnic.es/TurboPutative/api/tbomics"});function r(e){let{children:t}=e,a=i();return(0,l.jsx)(s.Provider,{value:a,children:t})}function i(){return(0,n.useContext)(s)}},24311:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return tg}});var l=a(57437),n=a(2265),s=a(24983),r=a(59844);function i(e){let{children:t}=e;return(0,l.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.5},children:t})}var o=a(49904),c=a(58991),d=a(62455),u=a(96507),x=a(43226),h=a(15133),m=a(35843);let p=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{width:110,height:70,textAlign:"center",backgroundColor:e,cursor:t?"not-allowed":"pointer",userSelect:"none",margin:"0px 15px"}},j=(0,m.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(204, 229, 255, 0.8)"}}});function b(e){let t,{children:a,text:n,id:r,setPage:i,page:o}=e,c=(0,s.tc)().jobID,d="results"==r&&null==c;t=d?"rgba(210,210,210,0.8)":o==r?"rgba(204, 229, 255, 0.8)":"rgba(255,255,255,1)";let m=p(t,d);return(0,l.jsx)(l.Fragment,{children:d?(0,l.jsxs)(h.Z,{sx:m,children:[(0,l.jsx)(u.Z,{sx:{py:1},children:a}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:n})})]}):(0,l.jsxs)(j,{sx:m,onClick:()=>i(r),children:[(0,l.jsx)(u.Z,{sx:{py:1},children:a}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:n})})]})})}var g=a(62970),f=a(11093);let v=(0,m.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(255, 0, 0, 0.3)"}}});function y(e){let{setCreatingJob:t}=e,a=(0,s.Lq)(),n=(0,s.tc)(),{DEV_MODE:r,API_URL:i}=(0,f.useVars)(),o=async()=>{t("waiting");let e=r?"123456":function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="";for(let l=0;l<e;l++){let e=Math.floor(Math.random()*t.length);a+=t.charAt(e)}return a}(10);console.log("Creating job: ".concat(e)),a({type:"set-job-id",jobID:e});let l=await fetch("".concat(i,"/create_job"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...{...n,user:{xq:dfd.toJSON(n.user.xq),xm:dfd.toJSON(n.user.xm),mdata:dfd.toJSON(n.user.mdata),q2i:dfd.toJSON(n.user.q2i),m2i:dfd.toJSON(n.user.m2i)},norm:{xq:null,xm:null}},jobID:e})}),s=await l.json(),o={...s,user:{xq:new dfd.DataFrame(s.user.xq,{index:s.index.xq}),xm:new dfd.DataFrame(s.user.xm,{index:s.index.xm}),mdata:new dfd.DataFrame(s.user.mdata,{index:s.index.mdata}),q2i:new dfd.DataFrame(s.user.q2i,{index:s.index.q2i}),m2i:new dfd.DataFrame(s.user.m2i,{index:s.index.m2i})},norm:{xq:new dfd.DataFrame(s.norm.xq,{index:s.index.xq}),xm:new dfd.DataFrame(s.norm.xm,{index:s.index.xm})}};a({type:"set-job-context",jobContext:o}),t("ask-annotations")};return(0,l.jsxs)(v,{sx:{...p("rgba(255, 0, 0, 0.2)"),position:"absolute",right:"12%"},onClick:o,children:[(0,l.jsx)(u.Z,{sx:{py:1},children:(0,l.jsx)(g.Z,{})}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:"Create Job"})})]})}var Z=a(35551),C=a(49381);function A(){let{API_URL:e}=(0,f.useVars)(),t=(0,s.Lq)(),a=async a=>{console.log("Loading sample data");let l=await fetch("".concat(e,"/load_sample_data")),n=await l.json();Object.keys(n).forEach(e=>{t({type:"user-upload",fileType:e,userFileName:"".concat(e,".tsv"),dfJson:n[e]})})};return(0,l.jsx)(u.Z,{sx:{alignSelf:"center",position:"absolute",left:"10%"},children:(0,l.jsx)(Z.Z,{variant:"outlined",startIcon:(0,l.jsx)(C.Z,{}),onClick:a,children:"Load Sample Data"})})}function w(e){let{page:t,setPage:a,setCreatingJob:n}=e,{user:r}=(0,s.tc)();return(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:["new-job"==t&&(0,l.jsx)(A,{page:t}),(0,l.jsx)(b,{text:"New Job",id:"new-job",setPage:a,page:t,children:(0,l.jsx)(o.Z,{})}),(0,l.jsx)(b,{text:"Find Job",id:"find-job",setPage:a,page:t,children:(0,l.jsx)(c.Z,{})}),(0,l.jsx)(b,{text:"Results",id:"results",setPage:a,page:t,children:(0,l.jsx)(d.Z,{})}),"new-job"==t&&r.mdata&&r.xm&&r.m2i&&r.xq&&r.q2i&&(0,l.jsx)(i,{children:(0,l.jsx)(y,{setCreatingJob:n})})]})}var P=a(11922),T=a(89394),k=a(91797),D=a(26337),N=a(52653),S=a(6252),E=a(33533);a(16691);let F=(0,m.ZP)(T.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function I(e){let{title:t}=e,[a,s]=(0,n.useState)(!1),r=()=>s(!1),i=(0,f.useVars)().BASE_URL;return(0,l.jsxs)("div",{className:"mt-0 pt-0",children:[(0,l.jsx)(N.Z,{onClick:()=>s(!0),children:(0,l.jsx)(S.Z,{})}),(0,l.jsxs)(F,{onClose:r,"aria-labelledby":"customized-dialog-title",open:a,maxWidth:"md",children:[(0,l.jsxs)(k.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:[t," Table"]}),(0,l.jsx)(N.Z,{"aria-label":"close",onClick:r,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,l.jsx)(E.Z,{})}),(0,l.jsxs)(D.Z,{dividers:!0,children:[(0,l.jsx)(x.Z,{gutterBottom:!0,children:"Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1"}),(0,l.jsx)(x.Z,{gutterBottom:!0,children:"Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2"}),(0,l.jsx)("div",{className:"text-center mt-3",children:(0,l.jsx)("img",{src:"".concat(i,"/table.png"),alt:"Table"})})]})]})]})}let R=["","#N/A","#N/A","N/A","#NA","-1.#IND","-1.#QNAN","-NaN","-nan","1.#IND","1.#QNAN","<NA>","N/A","NA","NULL","NaN","None","n/a","nan","null"],M=["TSV"];function q(e){let{title:t,fileType:a}=e,n=(0,s.tc)().userFileNames[a],r=(0,s.Lq)();async function i(e){let t=await e.text(),l=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"	";return new Promise(a=>{let l=e.split(/[\r\n]+/);if(l.length<2)throw Error("String text does not have expected DataFrame format");let n=l[0].split(t).map(e=>e.trim()),s=[];for(let e=1;e<l.length;e++){let a=l[e].split(t).map(e=>e.trim());if(a.length===n.length){let e={};for(let t=0;t<n.length;t++)e[n[t]]=R.includes(a[t])?null:a[t];s.push(e)}else console.log(a),console.log("Row number ".concat(e," could not be read"))}a(s)})}(t);r({type:"user-upload",fileType:a,userFileName:e.name,dfJson:l})}return(0,l.jsx)("div",{className:"DragFile mx-2 text-center",style:{width:"30%"},children:(0,l.jsxs)(h.Z,{sx:{transition:"all 1s ease",backgroundColor:n?"rgba(220,220,220,0.5)":"rgba(250,250,250,0.5)"},children:[(0,l.jsx)(x.Z,{variant:"h6",className:"pt-2",children:t}),(0,l.jsx)(I,{title:t}),(0,l.jsx)(u.Z,{sx:{width:400,margin:"auto"},children:(0,l.jsx)(P.b,{multiple:!1,handleChange:i,name:a,types:M})}),(0,l.jsx)("p",{className:"mt-3",children:n?"File name: ".concat(n):"no files uploaded yet"})]})})}var O=a(73701),L=a(39279),V=a(30666),z=a(15795),_=a(98489),B=a(29872),J=a(39190);let K=(0,J.Z)(V.Z)(e=>{let{theme:t}=e;return{textAlign:"center"}});function U(){let e=(0,s.tc)().results.PRE.MVThr.xq,t=(0,s.tc)().results.PRE.MVThr.xm,a=(0,s.tc)().user;return(0,l.jsx)(z.Z,{component:B.Z,sx:{width:300},children:(0,l.jsx)(O.Z,{size:"small","aria-label":"a dense table",children:(0,l.jsxs)(L.Z,{children:[null!=a.mdata&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(_.Z,{children:[(0,l.jsx)(K,{children:"n"}),(0,l.jsx)(K,{children:a.mdata.shape[0]})]}),(0,l.jsxs)(_.Z,{children:[(0,l.jsx)(K,{children:"Meta-variables"}),(0,l.jsx)(K,{children:a.mdata.shape[1]})]})]}),null!=a.xq&&(0,l.jsxs)(_.Z,{children:[(0,l.jsx)(K,{children:"Proteomic features"}),(0,l.jsxs)(K,{children:[a.xq.isNa().sum({axis:0}).div(a.xq.shape[0]).le(e).sum()," / ",a.xq.shape[1]]})]}),null!=a.xm&&(0,l.jsxs)(_.Z,{children:[(0,l.jsx)(K,{children:"Metabolomic features"}),(0,l.jsxs)(K,{children:[a.xm.isNa().sum({axis:0}).div(a.xm.shape[0]).le(t).sum()," / ",a.xm.shape[1]]})]})]})})})}var G=a(98864),Y=a.n(G);let H=Y()(()=>a.e(362).then(a.bind(a,84362)),{loadableGenerated:{webpack:()=>[84362]},ssr:!1});function X(){return(0,l.jsxs)(u.Z,{sx:{width:"100%"},className:"p-2",children:[(0,l.jsxs)("div",{className:"py-2 d-flex justify-content-between",children:[(0,l.jsx)(q,{title:"Proteomic Metadata",fileType:"q2i"}),(0,l.jsx)(q,{title:"Metadata",fileType:"mdata"}),(0,l.jsx)(q,{title:"Metabolomic Metadata",fileType:"m2i"})]}),(0,l.jsxs)("div",{className:"py-2 d-flex justify-content-between align-items-center",children:[(0,l.jsx)(q,{title:"Proteomic Quantifications",fileType:"xq"}),(0,l.jsx)(U,{}),(0,l.jsx)(q,{title:"Metabolomic Quantifications",fileType:"xm"})]}),(0,l.jsxs)(u.Z,{sx:{py:1,display:"flex",justifyContent:"space-around"},children:[(0,l.jsx)(H,{fileType:"xq",omic:"Proteomic"}),(0,l.jsx)(u.Z,{sx:{width:"33%"}}),(0,l.jsx)(H,{fileType:"xm",omic:"Metabolomic"})]})]})}var W=a(99960);function Q(e){let{setPage:t}=e,[a,r]=(0,n.useState)(""),[i,o]=(0,n.useState)(!0),d=(0,s.Lq)(),u=(0,f.useVars)().API_URL;async function x(e){console.log("Search Job ID: ".concat(e));let a=await fetch("".concat(u,"/search/").concat(e)),l=await a.json();console.log("Server response received:"),l.exist?(d({type:"find-job",results:l.results}),t("results")):o(!1)}return(0,l.jsx)("div",{className:"mx-auto mt-4 text-center",children:(0,l.jsx)(W.Z,{id:"outlined-basic",label:"Search Job",variant:"outlined",onChange:e=>{r(e.target.value),o(!0)},value:a,InputProps:{endAdornment:(0,l.jsx)(()=>(0,l.jsx)(N.Z,{onClick:()=>x(a),children:(0,l.jsx)(c.Z,{})}),{})},sx:{width:"70%",marginTop:"20%"},autoFocus:!0,error:!i,helperText:!i&&"Job not found"})})}var $=a(74275),ee=a.n($),et=a(19045),ea=a(92277),el=a(6882),en=a(28874);function es(e,t){let a=e.slice().sort((e,t)=>e-t),l=Math.floor(a.length*t),n=a[l];return n}var er=a(90045),ei=a(16573),eo=a(24235),ec=a(50039),ed=a(2047),eu=a(51125);let ex=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function eh(e){let{dataHist:t,gValues:a,xrange:n,yrange:s,xTicks:r,histRef:i}=e;return(0,l.jsxs)(er.T,{ref:i,style:{margin:"auto"},width:500,height:210,data:t,margin:{top:10,right:30,left:0,bottom:0},children:[(0,l.jsx)(ei.q,{strokeDasharray:"3 3"}),(0,l.jsx)(eo.K,{dataKey:"binCenter",type:"number",ticks:r,domain:n}),(0,l.jsx)(ec.B,{domain:s}),(0,l.jsx)(ed.u,{}),a.map((e,t)=>(0,l.jsx)(eu.u,{connectNulls:!0,type:"monotone",dataKey:e,fillOpacity:.3,stroke:ex[t%ex.length],fill:ex[t%ex.length]},e))]})}let em=Y()(()=>Promise.all([a.e(934),a.e(901)]).then(a.bind(a,87022)),{loadableGenerated:{webpack:()=>[87022]},ssr:!1});function ep(e){let{data:t,xrange:a,xTicks:n,boxRef:s}=e;return(0,l.jsx)(u.Z,{ref:s,children:(0,l.jsx)(em,{style:{position:"relative",left:-20},data:t,layout:{width:570,height:280,showlegend:!0,legend:{orientation:"h"},xaxis:{zeroline:!1,range:a,tickvals:n},yaxis:{type:"category",showticklabels:!1},margin:{t:0}},config:{staticPlot:!0,displayModeBar:!1},onChange:e=>console.log(e)})})}function ej(e){let{fileType:t,filteredID:a,groupby:r,showNorm:o,histRef:c,boxRef:d}=e,x=(0,s.tc)().user.mdata,h={norm:(0,s.tc)().norm[t],user:(0,s.tc)().user[t]},m=o?h.norm:h.user,{myData:p,dataAnova:j,gValues:b,idx2g:g}=(0,n.useMemo)(()=>{let e;let t={};for(let e=0;e<x.shape[0];e++)x.columns.includes(r)?null!=x.column(r).values[e]&&(t[x.index[e]]=x.column(r).values[e]):t[x.index[e]]="All values";let l=Object.keys(t).map(e=>t[e]).filter((e,t,a)=>a.indexOf(e)===t),n=[],s={};l.map(e=>s[e]=[]);let i=(e={},dfd.toJSON(m).map((t,a)=>{e[m.index[a]]=t}),e);return Object.keys(i).map(e=>{Object.keys(t).includes(e)&&Object.keys(i[e]).map(l=>{null!=i[e][l]&&a.includes(l)&&(s[t[e]].push(i[e][l]),n.push({ID:e,feature:l,g:t[e],x:i[e][l]}))})}),{myData:s,dataAnova:n,gValues:l,idx2g:t}},[r,x,m,a]),{xrange:f,xTicks:v,minimum:y,maximum:Z}=(0,n.useMemo)(e=>{let t=Object.keys(p).map(e=>p[e]).flat(),a=es(t,1e-4),l=es(t,.9999),n=[a-Math.abs(.05*a),l+Math.abs(.05*l)],s=function(e,t,a){let l=(t-e)/(a-1),n=[];for(let t=0;t<a;t++){let a=e+t*l;n.push(a)}return n.filter(e=>e<0).length>0&&n.filter(e=>e>0).length>0&&n.push(0),n.sort((e,t)=>e-t),n=n.map(e=>Math.floor(100*e)/100)}(a,l,6);return{xrange:n,xTicks:s,minimum:a,maximum:l}},[p]),{dataHist:C,yrange:A}=(0,n.useMemo)(()=>{let e={};Object.keys(p).map(t=>{e[t]=p[t].filter(e=>y<=e&&e<=Z)}),Object.keys(e).map(t=>{try{e[t].length>0?e[t]=function(e,t){let a=Math.min(...e),l=(Math.max(...e)-a)/t,n=Array(t).fill(0);e.forEach(e=>{let s=Math.floor((e-a)/l);s>=0&&s<t&&n[s]++});let s=n.map(t=>t/(e.length*l)),r=Array(t).fill(0).map((e,t)=>a+(t+.5)*l),i=[];for(let e=0;e<t;e++)i.push({binCenter:r[e],density:s[e]});return i}(e[t],1+Math.ceil(Math.log2(e[t].length))):delete e[t]}catch(e){console.error(e)}}),(e=(e=Object.keys(e).map(t=>e[t].map(e=>{let{binCenter:a,density:l}=e;return{binCenter:Math.round(100*a)/100,[t]:Number.parseFloat(l).toExponential(3),d:l}}))).flat()).sort((e,t)=>e.binCenter-t.binCenter);let t=Math.max(...e.map(e=>e.d)),a=[0,Number.parseFloat((1.05*t).toPrecision(2))];return{dataHist:e,yrange:a}},[p,y,Z]),w=(0,n.useMemo)(()=>Object.keys(p).map((e,t)=>p[e].length>0?{x:p[e],type:"box",name:"".concat(e),marker:{color:ex[t%ex.length]}}:null).filter(e=>null!=e),[p]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{sx:{height:210},children:(0,l.jsx)(eh,{dataHist:C,gValues:b,xrange:f,xTicks:v,yrange:A,histRef:c})}),(0,l.jsx)(u.Z,{sx:{height:280,width:500,margin:"auto",overflowX:"hidden",overflowY:"hidden"},children:(0,l.jsx)(i,{children:(0,l.jsx)(ep,{data:w,xrange:f,xTicks:v,boxRef:d})})})]})}var eb=a(36970);let eg=(0,n.createContext)(),ef=(0,n.createContext)();function ev(){return(0,n.useContext)(eg)}function ey(){return(0,n.useContext)(ef)}function eZ(e){let{children:t}=e,[a,n]=(0,eb.C)(eC,eA);return(0,l.jsx)(eg.Provider,{value:a,children:(0,l.jsx)(ef.Provider,{value:n,children:t})})}function eC(e,t){switch(console.log("Results object updated: ".concat(t.type)),console.log(t),t.type){case"set-eda-dd-norm":e.EDA.DD.showNorm=t.showNorm;break;case"set-eda-dd-groupby":e.EDA.DD.groupby=t.groupby;break;case"set-eda-dd-filter":e.EDA.DD.filterCol[t.fileType]=t.filterCol;break;case"set-eda-dd-filter-text":e.EDA.DD.filterText[t.fileType]=t.filterText;break;case"set-eda-pca-data":e.EDA.PCA[t.omic].data=t.data;break;case"set-eda-pca-status":e.EDA.PCA[t.omic].status=t.status}}let eA={EDA:{DD:{showNorm:!0,groupby:{label:"All values",value:"All values"},filterCol:{q2i:"All features",m2i:"All features"},filterText:{q2i:"",m2i:""}},PCA:{q:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"}},m:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"}}}}};var ew=a(40182),eP=a(45421),eT=a(97472);function ek(e){let{handleSwitch:t,label:a}=e,s=ev().EDA.DD.showNorm,r=ey(),[i,o]=(0,n.useState)(s);return(0,n.useEffect)(()=>{r({type:"set-eda-dd-norm",showNorm:i})},[i,r]),(0,l.jsx)(ew.Z,{control:(0,l.jsx)(eP.Z,{checked:i,onChange:e=>{o(e.target.checked),setTimeout(()=>{t(e)},100)}}),label:a})}function eD(e){let{options:t,handleSelect:a,label:s}=e,r=ev().EDA.DD.groupby,i=ey(),[o,c]=(0,n.useState)(r);return(0,n.useEffect)(()=>{i({type:"set-eda-dd-groupby",groupby:o})},[o,i]),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:s}),(0,l.jsx)(eT.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:o,onChange:e=>{c({label:e.value,value:e.value}),setTimeout(()=>a(e),100)}})]})}function eN(e){let{options:t,value:a,onChange:n,label:s}=e;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:s}),(0,l.jsx)(eT.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:a,onChange:n})]})}var eS=a(43560);function eE(e){let{columns:t,data:a}=e,s=(0,n.useRef)(null),[r,o]=(0,n.useState)(!0),[c,d]=(0,n.useState)([]);return(0,n.useEffect)(()=>{o(!1)},[]),(0,n.useEffect)(()=>{try{var e,t;null===(t=s.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,l.jsx)(i,{children:(0,l.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,l.jsx)(eS.P2,{columns:t,data:a,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:s,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}function eF(e){let{omic:t,fileType:a,setFilteredID:r,updatePlot:o}=e,c=ev().EDA.DD.filterText[a],d=ev().EDA.DD.filterCol[a],x=ey(),[h,m]=(0,n.useState)(c),[p,j]=(0,n.useState)(d),b=(0,s.tc)().user[a],{filteredFeatures:g,columns:f}=(0,n.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:50}];return b.columns.includes(p)?(e=(e=(e=b.column(p)).values.map((t,a)=>({ID:e.index[a],[p]:t}))).filter(e=>null!=e[p]&&"".concat(e[p]).toLowerCase().includes(h.toLowerCase())),t.push({accessorKey:p,header:p,size:170})):e=(e=b.index).map((e,t)=>({ID:e})),{filteredFeatures:e,columns:t}},[h,p,b]);return(0,n.useEffect)(()=>{console.log("useEffect: Recalculating features");let e=setTimeout(()=>{r(e=>({...e,[a]:g.map(e=>e.ID)})),o([t]),console.log("Features recalculated")},500);return()=>clearTimeout(e)},[g,a,r,o,t]),(0,n.useEffect)(()=>{x({type:"set-eda-dd-filter",filterCol:p,fileType:a}),x({type:"set-eda-dd-filter-text",filterText:h,fileType:a})},[p,h,a,x]),(0,l.jsxs)(u.Z,{sx:{width:"95%",margin:"auto"},children:[(0,l.jsxs)(u.Z,{sx:{display:"flex",height:"10vh"},children:[(0,l.jsx)(u.Z,{sx:{width:"40%",pt:1},children:(0,l.jsx)(eN,{options:[{label:"All features",value:"All features"},...b.columns.map(e=>({label:e,value:e}))],onChange:e=>j(e.value),value:{label:p,value:p}})}),b.columns.includes(p)&&(0,l.jsx)(i,{children:(0,l.jsx)(u.Z,{sx:{mt:3,ml:3},children:(0,l.jsx)(W.Z,{id:"standard-name",placeholder:"Filter text",value:h,onChange:e=>m(e.target.value)})})})]}),(0,l.jsx)(u.Z,{sx:{mt:0},children:(0,l.jsx)(eE,{data:g,columns:f})})]})}var eI=a(89554),eR=a(93097),eM=a.n(eR);function eq(){let e=(0,n.useRef)(),t=(0,n.useRef)(),a=(0,n.useRef)(),r=(0,n.useRef)(),i=ev().EDA.DD.showNorm,o=ev().EDA.DD.groupby,[c,d]=(0,n.useState)({q:!1,m:!1}),[h,m]=(0,n.useState)({q2i:[],m2i:[]}),[p,j]=(0,n.useState)(i),[b,g]=(0,n.useState)(o),{mdataType:f}=(0,s.tc)(),v=(0,s.tc)().user.mdata.columns.map(e=>({label:e,value:e}));v=[{label:"All values",value:"All values"},...v=v.filter(e=>"categorical"==f[e.value].type)];let y=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["q","m"];e.map(e=>{d(t=>({...t,[e]:!1}))}),e.map(e=>setTimeout(()=>d(t=>({...t,[e]:!0})),300))},[]),Z=(0,n.useCallback)(e=>{g({label:e.value,value:e.value}),y(["q","m"])},[y]),C=(0,n.useCallback)(e=>{j(e.target.checked),y(["q","m"])},[y]);return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(en.ZP,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",sx:{mb:8,mt:0},children:[(0,l.jsx)(en.ZP,{item:!0,xs:3,sx:{pt:3},children:(0,l.jsx)(ek,{handleSwitch:C,label:"Centered & Scaled"})}),(0,l.jsx)(en.ZP,{item:!0,xs:3,children:(0,l.jsx)(eD,{options:v,handleSelect:Z,label:"Group by"})})]}),(0,l.jsx)(u.Z,{sx:{flexGrow:1,p:0,mt:0},children:(0,l.jsxs)(en.ZP,{container:!0,direction:"row",justifyContent:"center",spacing:2,sx:{p:0},children:[(0,l.jsxs)(en.ZP,{item:!0,sx:{borderRight:"1px solid #cccccc"},xs:6,children:[(0,l.jsxs)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Proteomics",(0,l.jsx)(N.Z,{"aria-label":"download",size:"small",onClick:a=>eM()(e.current,t.current,"Proteomics"),sx:{opacity:.5,visibility:c.q?"visible":"hidden",paddingBottom:1},children:(0,l.jsx)(eI.Z,{})})]}),c.q?(0,l.jsx)(u.Z,{sx:{height:550,overflowX:"auto"},children:(0,l.jsx)(ej,{fileType:"xq",filteredID:h.q2i,groupby:b.value,showNorm:p,histRef:e,boxRef:t})}):(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,l.jsx)(el.Z,{size:100,thickness:2})}),(0,l.jsx)(eF,{omic:"q",fileType:"q2i",setFilteredID:m,updatePlot:y})]}),(0,l.jsxs)(en.ZP,{item:!0,xs:6,sx:{borderLeft:"1px solid #cccccc"},children:[(0,l.jsxs)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Metabolomics",(0,l.jsx)(N.Z,{"aria-label":"download",size:"small",onClick:e=>eM()(a.current,r.current,"Metabolomics"),sx:{opacity:.5,visibility:c.m?"visible":"hidden",paddingBottom:1},children:(0,l.jsx)(eI.Z,{})})]}),c.m?(0,l.jsx)(u.Z,{sx:{height:550,overflowX:"auto"},children:(0,l.jsx)(ej,{fileType:"xm",filteredID:h.m2i,groupby:b.value,showNorm:p,histRef:a,boxRef:r})}):(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,l.jsx)(el.Z,{size:100,thickness:2})}),(0,l.jsx)(eF,{omic:"m",fileType:"m2i",setFilteredID:m,updatePlot:y})]})]})})]})}var eO=a(50817),eL=a(48389),eV=a(66988),ez=a(62254),e_=a(55183);let eB="rgba(200,200,200,0.5)",eJ=()=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(eB),cursor:"pointer",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1px solid rgba(50,50,50,1)"}},selectedCell:{border:"1px solid rgba(20,20,20,1)","&:hover":{border:"1px solid rgba(20,20,20,1)"}}}),eK={textAlign:"center",padding:.5,border:"1px solid ".concat(eB),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},eU=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),eG=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function eY(e){let{data:t,rowNames:a,colNames:s,expVar:r,setSelectedPlot:i}=e,o=eJ(),[c,d]=(0,n.useState)(null),x=(e,t)=>{d({rowIndex:e,colIndex:t}),i({mdataCol:a[e],PCA:s[t]}),console.log("Plot scatter: PCA ".concat(s[t]," vs ").concat(a[e]))},h=(0,n.useMemo)(()=>{let e=[];e.push(["PCA / Cond.",...s]),e.push(["%Variance",...r]);let l=t.map((e,t)=>[a[t],...e]);return[...e,...l]},[s,r,t,a]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,l.jsx)(N.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,l.jsx)(e_.CSVLink,{data:h,filename:"PCA_Anova_pvalues.csv",separator:",",children:(0,l.jsx)(ez.Z,{})})})}),(0,l.jsxs)(en.ZP,{container:!0,children:[(0,l.jsx)(en.ZP,{item:!0,xs:2,children:(0,l.jsx)(z.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(O.Z,{children:[(0,l.jsx)(eV.Z,{children:(0,l.jsx)(_.Z,{children:(0,l.jsx)(V.Z,{sx:{padding:0,textAlign:"center"},children:"PCA / Cond."})})}),(0,l.jsxs)(L.Z,{children:[(0,l.jsx)(_.Z,{children:(0,l.jsx)(V.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:{...eK,borderBottom:"1px solid rgba(10,10,10,1)"},children:"%Variance"})})},"expVar"),a.map((e,t)=>(0,l.jsx)(_.Z,{children:(0,l.jsx)(V.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:eK,children:e})})},t))]})]})})}),(0,l.jsx)(en.ZP,{item:!0,xs:10,children:(0,l.jsx)(z.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(O.Z,{children:[(0,l.jsx)(eV.Z,{children:(0,l.jsx)(_.Z,{children:t[0].map((e,t)=>(0,l.jsx)(V.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:t+1},t))})}),(0,l.jsxs)(L.Z,{children:[(0,l.jsx)(_.Z,{children:r.map((e,t)=>(0,l.jsx)(V.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:{padding:.5,border:"1px solid ".concat(eB),borderBottom:"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:eG(e),userSelect:"none"},children:e})},t))},"expVar"),t.map((e,t)=>(0,l.jsx)(_.Z,{children:e.map((e,a)=>(0,l.jsx)(V.Z,{sx:{padding:0,border:0},onClick:()=>x(t,a),children:(0,l.jsx)(u.Z,{sx:c&&c.rowIndex===t&&c.colIndex===a?{...o.cell,...o.selectedCell,...eU(e)}:{...o.cell,...eU(e)},children:e.toFixed(3)})},a))},t))]})]})})})]})]})}var eH=a(35048),eX=a(41125),eW=a(33343),eQ=a(89366),e$=a(79857),e0=a(31863);let e1=e=>{let{active:t,payload:a}=e;return t&&a&&a.length?(0,l.jsxs)(u.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(x.Z,{variant:"h8",sx:{display:"block"},children:"".concat(a[0].payload.element)}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[0].name,": ").concat("string"==typeof a[0].value?a[0].value:a[0].value.toFixed(3))}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[1].name,": ").concat(a[1].value.toFixed(3))})]}):null},e2=e=>{let{scatterRef:t}=e;return(0,l.jsx)(u.Z,{sx:{height:0},children:(0,l.jsx)(u.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,l.jsx)(N.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),a=window.document.createElement("div");a.appendChild(e),(0,e0.default)(a,"PCA_Scatter")},sx:{opacity:.5},children:(0,l.jsx)(eI.Z,{})})})})};function e5(e){let t,{scatterData:a,mdataCol:r,PCA:i}=e,o=(0,n.useRef)(),c=(0,s.tc)().mdataType[r].type;return"categorical"==c&&(t="category"),"numeric"==c&&(t="number"),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(e2,{scatterRef:o}),(0,l.jsx)(eH.h,{width:"100%",height:400,children:(0,l.jsxs)(eX.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(ei.q,{}),(0,l.jsx)(eo.K,{type:t,dataKey:"mdataValue",name:r,allowDuplicatedCategory:!1,children:(0,l.jsx)(eW._,{value:r,offset:-10,position:"insideBottom"})}),(0,l.jsx)(ec.B,{type:"number",dataKey:"projection",name:"PCA ".concat(i),children:(0,l.jsx)(eW._,{value:"PCA ".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(ed.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(e1,{})}),(0,l.jsx)(eQ.b,{data:a,fill:"#8884d8"})]})})]})}function e3(e){let{scatterData:t,selectedPlot2D:a}=e,s=(0,n.useRef)();return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(e2,{scatterRef:s}),(0,l.jsx)(eH.h,{width:"100%",height:400,children:(0,l.jsxs)(eX.G,{ref:s,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(ei.q,{}),(0,l.jsx)(eo.K,{type:"number",dataKey:"x",name:"PCA ".concat(a.x),children:(0,l.jsx)(eW._,{value:"PCA ".concat(a.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(ec.B,{type:"number",dataKey:"y",name:"PCA ".concat(a.y),children:(0,l.jsx)(eW._,{value:"PCA ".concat(a.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(ed.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(e1,{})}),Object.keys(t).length>1&&(0,l.jsx)(e$.D,{verticalAlign:"top"}),Object.keys(t).map((e,a)=>(0,l.jsx)(eQ.b,{data:t[e],fill:ex[a%ex.length],name:e},e))]})})]})}var e9=a(92069);function e8(e){let{omic:t,selectedLoadings:a,selectedPCA:r}=e,[o,c]=(0,n.useState)(""),[d,x]=(0,n.useState)("All features"),h=(0,s.tc)().user["".concat(t,"2i")],{filteredFeatures:m,columns:p}=(0,n.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:60},{accessorKey:"mdataValue",header:"",size:10},...r.map((e,t)=>({accessorKey:"PCA".concat(t),header:"Loadings PCA".concat(e),size:100}))];return h.columns.includes(d)?(e=(e=(e=h.column(d)).values.map((t,l)=>void 0==a[e.index[l]]?null:{ID:e.index[l],mdataValue:t,...a[e.index[l]].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e.index[l]][0]})}).filter(e=>null!=e)).filter(e=>null!=e.mdataValue&&"".concat(e.mdataValue).toLowerCase().includes(o.toLowerCase())),t[1].header=d,t[1].size=100):e=Object.keys(a).map((e,t)=>({ID:e,mdataValue:"",...a[e].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e][0]})})),{filteredFeatures:e,columns:t}},[a,o,d,h,r]);return(0,l.jsxs)(u.Z,{sx:{width:"95%",margin:"auto"},children:[(0,l.jsxs)(u.Z,{sx:{display:"flex",height:"10vh"},children:[(0,l.jsx)(u.Z,{sx:{mt:4,ml:0},children:(0,l.jsx)(N.Z,{"aria-label":"download",size:"small",onClick:e=>e4(m,p),sx:{opacity:.5,color:"rgb(13,110,253)"},variant:"danger",children:(0,l.jsx)(ez.Z,{})})}),(0,l.jsx)(u.Z,{sx:{width:"40%",pt:1,ml:3},children:(0,l.jsx)(eN,{options:[{label:"All features",value:"All features"},...h.columns.map(e=>({label:e,value:e}))],onChange:e=>x(e.value),value:{label:d,value:d}})}),h.columns.includes(d)&&(0,l.jsx)(i,{children:(0,l.jsx)(u.Z,{sx:{mt:3,ml:3},children:(0,l.jsx)(W.Z,{id:"standard-name",placeholder:"Filter text",value:o,onChange:e=>c(e.target.value)})})})]}),(0,l.jsx)(u.Z,{sx:{mt:0},children:(0,l.jsx)(e6,{data:m,columns:p})})]})}let e4=(e,t)=>{let a=(0,e9.iL)({useKeysAsHeaders:!0,filename:"PCA_Loading_Table"}),l=e.map(e=>{let a={};return t.map(t=>{""!=t.header&&(a[t.header]=e[t.accessorKey])}),a}),n=(0,e9.gB)(a)(l);(0,e9.LR)(a)(n)};function e6(e){let{columns:t,data:a}=e,s=(0,n.useRef)(null),[r,o]=(0,n.useState)(!0),[c,d]=(0,n.useState)([]);return(0,n.useEffect)(()=>{o(!1)},[]),(0,n.useEffect)(()=>{try{var e,t;null===(t=s.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,l.jsx)(i,{children:(0,l.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,l.jsx)(eS.P2,{columns:t,data:a,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:s,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}function e7(e){let{title:t,omic:a}=e,r=(0,n.useRef)(null),{API_URL:i}=(0,f.useVars)(),o=ey(),c=ev().EDA.PCA[a].status,d=ev().EDA.PCA[a].data,[h,m]=(0,n.useState)(c),[p,j]=(0,n.useState)(d),{projections:b,loadings:g,explained_variance:v,anova:y}=p,{mdata:Z}=(0,s.tc)().user,{mdataType:C}=(0,s.tc)(),{jobID:A}=(0,s.tc)(),[w,P]=(0,n.useState)("1D"),[T,k]=(0,n.useState)(null),[D,N]=(0,n.useState)({x:1,y:2,g:"No color"}),S=(0,n.useCallback)(async()=>{console.log("Fetching data");let e=await fetch("".concat(i,"/get_eda_pca/").concat(A,"/").concat(a)),{resStatus:t,dataPCA:l}=await e.json();console.log(t),"waiting"!=t.status&&(console.log("Status changed: ".concat(JSON.stringify(t))),j(l),m(t),o({type:"set-eda-pca-data",data:l,omic:a}),o({type:"set-eda-pca-status",status:t,omic:a}),clearInterval(r.current))},[i,A,a,o,r]);(0,n.useEffect)(()=>{if(console.log("useEffect to get data"),"waiting"==h.status)return console.log("Get data from server"),r.current=setInterval(S,2e3),()=>clearInterval(r.current)},[r,S,h.status]);let{pvTable:E,pvRowNames:F,pvColNames:I,pvExpVar:R}=(0,n.useMemo)(()=>te(y,v,Z,h),[y,v,Z,h]),M=(0,n.useMemo)(()=>tt(b,Z,C,T,D,h,w),[b,Z,C,T,D,h,w]),q=(0,n.useMemo)(()=>ta(g,T,D,h,w),[g,T,D,h,w]);return(0,l.jsxs)(u.Z,{sx:{borderRight:"q"==a?"1px solid #cccccc":"0px"},children:[(0,l.jsx)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:t}),"ok"==h.status?(0,l.jsxs)(u.Z,{sx:{padding:1},children:[(0,l.jsx)(eY,{data:E,rowNames:F,colNames:I,expVar:R,setSelectedPlot:k}),(0,l.jsx)(u.Z,{sx:{textAlign:"center",mt:2},children:(0,l.jsx)(u.Z,{sx:{mb:2},children:(0,l.jsxs)(eO.Z,{color:"primary",value:w,exclusive:!0,onChange:(e,t)=>P(e.target.value),"aria-label":"Platform",children:[(0,l.jsx)(eL.Z,{value:"1D",children:"1D"}),(0,l.jsx)(eL.Z,{value:"2D",children:"2D"})]})})}),(0,l.jsx)(u.Z,{sx:{textAlign:"center"},children:"1D"==w?(0,l.jsx)(u.Z,{children:"Select a pvalue cell to plot PCA"}):(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eN,{options:I.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>N(t=>({...t,x:e.value})),value:{label:"PCA ".concat(D.x),value:D.x},label:"X axis"})}),(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eN,{options:I.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>N(t=>({...t,y:e.value})),value:{label:"PCA ".concat(D.y),value:D.y},label:"Y axis"})}),(0,l.jsx)(u.Z,{sx:{width:"40%"},children:(0,l.jsx)(eN,{options:[{label:"No color",value:"No color"},...F.filter(e=>"categorical"==C[e].type).map(e=>({label:e,value:e}))],onChange:e=>N(t=>({...t,g:e.value})),value:{label:D.g,value:D.g},label:"Color by"})})]})}),M&&(0,l.jsx)(u.Z,{children:"1D"==w?(0,l.jsx)(e5,{scatterData:M,mdataCol:T.mdataCol,PCA:T.PCA}):(0,l.jsx)(e3,{scatterData:M,selectedPlot2D:D})}),q&&(0,l.jsx)(u.Z,{sx:{marginTop:5,textAlign:"center"},children:(0,l.jsx)(e8,{omic:a,selectedLoadings:q,selectedPCA:"1D"==w?[T.PCA]:[D.x,D.y]})})]}):"waiting"==h.status?(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:(0,l.jsx)(el.Z,{size:100,thickness:2})}):"error"==h.status?(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:"An error occurred"}):void 0]})}let te=(e,t,a,l)=>{let n,s,r,i,o;if("ok"==l.status){n=a.columns.map(t=>Object.keys(e).map(a=>[t,parseInt(a),e[a][t]]));for(let e=0;e<n.length;e++)n[e].sort((e,t)=>e[1]-t[1]);r=(n=n.filter(e=>!e.map(e=>0==Object.keys(e[2]).length).every(e=>e))).map(e=>e[0][0]),i=n[0].map(e=>e[1]),s=n.map(e=>e.map(e=>e[2].pvalue)),o=Object.keys(t).map(e=>(100*t[e].Explained_Variance).toFixed(1))}return{pvTable:s,pvRowNames:r,pvColNames:i,pvExpVar:o}},tt=(e,t,a,l,n,s,r)=>{let i=null;if("ok"==s.status&&"1D"==r&&l){let a=t.column(l.mdataCol);i=Object.keys(e).map(t=>({element:t,projection:e[t][l.PCA],mdataValue:a.values[a.index.indexOf(t)]}))}else"ok"==s.status&&"2D"==r&&n&&(Object.keys(a).includes(n.g)?(i={},a[n.g].levels.map(t=>{i[t]=[],a[n.g].level2id[t].map(a=>{Object.keys(e).includes(a)&&i[t].push({element:a,x:e[a][n.x],y:e[a][n.y]})})})):i={[n.g]:Object.keys(e).map(t=>({element:t,x:e[t][n.x],y:e[t][n.y]}))});return i},ta=(e,t,a,l,n)=>{let s=null;return"ok"==l.status&&"1D"==n&&t?(s={},Object.keys(e).map(a=>{s[a]=[parseFloat(e[a][t.PCA].toFixed(5))]})):"ok"==l.status&&"2D"==n&&(s={},Object.keys(e).map(t=>{s[t]=[parseFloat(e[t][a.x].toFixed(5)),parseFloat(e[t][a.y].toFixed(5))]})),s};function tl(){return(0,l.jsx)(u.Z,{children:(0,l.jsxs)(en.ZP,{container:!0,children:[(0,l.jsx)(en.ZP,{item:!0,xs:6,children:(0,l.jsx)(e7,{title:"Proteomics",omic:"q"})}),(0,l.jsx)(en.ZP,{item:!0,xs:6,children:(0,l.jsx)(e7,{title:"Metabolomics",omic:"m"})})]})})}function tn(e){let{children:t,value:a,index:n,...s}=e;return(0,l.jsx)("div",{role:"tabpanel",hidden:a!==n,id:"vertical-tabpanel-".concat(n),"aria-labelledby":"vertical-tab-".concat(n),...s,children:a===n&&(0,l.jsx)(u.Z,{sx:{p:3},children:(0,l.jsx)(x.Z,{children:t})})})}function ts(e){return{id:"vertical-tab-".concat(e),"aria-controls":"vertical-tabpanel-".concat(e)}}function tr(){let[e,t]=(0,n.useState)(.1),{jobID:a}=(0,s.tc)();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(x.Z,{variant:"body2",sx:{textAlign:"right",pr:4},children:["Job ID: ",a]}),(0,l.jsxs)(u.Z,{sx:{display:"flex",flexGrow:1,bgcolor:"background.paper",height:"80vh"},children:[(0,l.jsxs)(et.Z,{orientation:"vertical",value:e,onChange:(e,a)=>{t(a)},"aria-label":"Results Sections Tabs",sx:{borderRight:1,borderColor:"divider",width:"15%"},children:[(0,l.jsx)(ea.Z,{label:"EXPLORATORY DATA ANALYSIS",value:.1,...ts(0),sx:{mt:2,p:0,color:0==Math.floor(e)?"#1976d2":"#00000099"}}),(0,l.jsx)(ea.Z,{label:"DATA DISTRIBUTION",value:.1,...ts(1),sx:{fontSize:12,m:0,p:0,borderTop:"1px solid #cccccc"}}),(0,l.jsx)(ea.Z,{label:"PCA",value:.2,...ts(2),sx:{fontSize:12,m:0,p:0,borderBottom:"1px solid #cccccc"}}),(0,l.jsx)(ea.Z,{label:"MULTIOMICS FACTOR ANALYSIS",value:1.1,...ts(1),sx:{mt:2}}),(0,l.jsx)(ea.Z,{label:"COMMUNITY ANALYSIS",value:2.1,...ts(3),sx:{mt:2}}),(0,l.jsx)(ea.Z,{label:"REGULARIZED CANONICAL CORRELATION ANALYSIS",value:3.1,...ts(4),sx:{mt:2}}),(0,l.jsx)(ea.Z,{label:"DIFFERENTIAL CORRELATION ANALYSIS",value:4.1,...ts(5),sx:{mt:2}}),(0,l.jsx)(ea.Z,{label:"ELASTIC NET",value:5.1,...ts(6),sx:{mt:2}})]}),(0,l.jsxs)(u.Z,{sx:{width:"85%",borderTop:"1px solid #cccccc"},children:[.1==e&&(0,l.jsx)(u.Z,{sx:{p:1},children:(0,l.jsx)(eq,{})}),.2==e&&(0,l.jsx)(u.Z,{sx:{p:1},children:(0,l.jsx)(tl,{})}),(0,l.jsx)(tn,{value:e,index:1.1,children:"MOFA"}),(0,l.jsx)(tn,{value:e,index:2.1,children:"Community Analysis"}),(0,l.jsx)(tn,{value:e,index:3.1,children:"rCCA"}),(0,l.jsx)(tn,{value:e,index:4.1,children:"Differential Correlation Analysis"}),(0,l.jsx)(tn,{value:e,index:5.1,children:"Elastic Net"})]})]})]})}tn.propTypes={children:ee().node,index:ee().number.isRequired,value:ee().number.isRequired};var ti=a(42834),to=a(64173),tc=function(e){let{creatingJob:t,setCreatingJob:a,setPage:n}=e;return(0,l.jsx)(u.Z,{children:(0,l.jsxs)(T.Z,{open:"ask-annotations"==t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(k.Z,{id:"alert-dialog-title",children:"Obtain Putative Annotations from CMM & TurboPutative?"}),(0,l.jsx)(D.Z,{children:(0,l.jsxs)(to.Z,{id:"alert-dialog-description",children:["Metabolomic features will be annotated using ",(0,l.jsx)("a",{target:"_blank",href:"http://ceumass.eps.uspceu.es/",children:"Ceu Mass Mediator"})," and simplified using ",(0,l.jsx)("a",{target:"_blank",href:"https://proteomics.cnic.es/TurboPutative/webserver",children:"TurboPutative"})," (not available yet)."]})}),(0,l.jsxs)(ti.Z,{sx:{border:"0px solid red"},children:[(0,l.jsx)(Z.Z,{sx:{border:"0px solid blue",margin:"auto"},onClick:()=>{a(""),n("results")},children:"No"}),(0,l.jsx)(u.Z,{style:{margin:"auto",cursor:"not-allowed"},children:(0,l.jsx)(Z.Z,{style:{color:"rgb(150,150,150)"},onClick:()=>{a("annotations-params")},children:"Yes"})})]})]})})},td=a(39350);function tu(e){let{creatingJob:t}=e,[a,r]=(0,n.useState)([{msg:"Sending data to server"}]),i=(0,n.useRef)(),{API_URL:o}=(0,f.useVars)(),{jobID:c}=(0,s.tc)();return(0,n.useEffect)(()=>(i.current=setInterval(async()=>{let e=await fetch("".concat(o,"/get_create_job_log/").concat(c)),t=await e.json();r(t)},2e3),()=>clearInterval(i.current)),[i,c,o]),(0,l.jsx)(u.Z,{children:(0,l.jsx)(td.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:"waiting"==t,children:(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(u.Z,{sx:{textAlign:"center"},children:(0,l.jsx)(el.Z,{color:"inherit"})}),(0,l.jsx)(u.Z,{sx:{mt:2,textAlign:"center"},children:"This may take a while. Please be patient..."}),(0,l.jsx)(u.Z,{sx:{mt:0,textAlign:"center"},children:a[a.length-1].msg})]})})})}var tx=a(76500),th=a(34989),tm=a(8088);let tp=n.forwardRef(function(e,t){return(0,l.jsx)(tm.Z,{direction:"up",ref:t,...e})});function tj(e){let{creatingJob:t,setCreatingJob:a}=e;return(0,l.jsx)("div",{children:(0,l.jsxs)(T.Z,{fullScreen:!0,open:"annotations-params"==t,TransitionComponent:tp,children:[(0,l.jsx)(tx.Z,{sx:{position:"relative",backgroundColor:"rgba(160, 0, 0, 1)"},children:(0,l.jsxs)(th.Z,{children:[(0,l.jsx)(N.Z,{edge:"start",color:"inherit",onClick:()=>a("ask-annotations"),"aria-label":"close",children:(0,l.jsx)(E.Z,{})}),(0,l.jsx)(x.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Metabolomic Putative Annotations"})]})}),(0,l.jsx)(u.Z,{className:"m-2",children:(0,l.jsx)(tb,{})})]})})}let tb=()=>(0,l.jsx)(u.Z,{sx:{width:"100%"},children:"Annotations Params..."});function tg(){let[e,t]=(0,n.useState)("new-job"),[a,r]=(0,n.useState)("");return(0,l.jsx)("div",{children:(0,l.jsx)(s.JV,{children:(0,l.jsxs)(eZ,{children:[(0,l.jsx)(w,{page:e,setPage:t,setCreatingJob:r}),"new-job"==e&&(0,l.jsxs)(i,{children:[(0,l.jsx)(X,{}),"waiting"==a&&(0,l.jsx)(tu,{creatingJob:a}),"ask-annotations"==a&&(0,l.jsx)(tc,{creatingJob:a,setCreatingJob:r,setPage:t}),"annotations-params"==a&&(0,l.jsx)(tj,{creatingJob:a,setCreatingJob:r})]}),"find-job"==e&&(0,l.jsx)(i,{children:(0,l.jsx)(Q,{setPage:t})}),"results"==e&&(0,l.jsx)(i,{children:(0,l.jsx)(tr,{})})]})})})}},24983:function(e,t,a){"use strict";a.d(t,{JV:function(){return d},Lq:function(){return c},tc:function(){return o}});var l=a(57437),n=a(2265),s=a(36970);let r=(0,n.createContext)(null),i=(0,n.createContext)(null);function o(){return(0,n.useContext)(r)}function c(){return(0,n.useContext)(i)}function d(e){let{children:t}=e,[a,n]=(0,s.C)(u,x);return(0,l.jsx)(r.Provider,{value:a,children:(0,l.jsx)(i.Provider,{value:n,children:t})})}function u(e,t){switch(console.log("jobReducer called: ".concat(t.type)),console.log(t),t.type){case"find-job":return console.log("findJob"),t.results;case"user-upload":{let a=new dfd.DataFrame(t.dfJson);if(a.setIndex({column:a.columns[0],inplace:!0}),"xq"==t.fileType||"xm"==t.fileType){a.drop({columns:[a.columns[0]],inplace:!0});let l=a.isNa().sum({axis:0}).div(a.shape[0]),n=function(e,t,a){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof a)throw Error("All arguments must be numbers");if(e>t&&a>0)throw Error('The "step" value must be negative if "start" is greater than "end"');if(e<t&&a<0)throw Error('The "step" value must be positive if "start" is less than "end"');let l=[],n=e;for(;e<=t&&n<=t||e>=t&&n>=t;)l.push(n),n+=a;return l}(0,1.05,.05);n=n.map(e=>({MVThr:Math.round(100*e)/100,Features:l.le(e).sum()})),e.results.PRE.MV[t.fileType]=n}if("mdata"==t.fileType){let t=a.ctypes;t.values.map((l,n)=>{let s=t.index[n];if(l.includes("string"))e.mdataType[s]={type:"categorical"};else if(s.toLowerCase().includes("[categorical]")){let t=s.replace(/\[categorical\]/i,"");e.mdataType[t]={type:"categorical"},a.rename({[s]:t},{inplace:!0}),s=t}else l.includes("int")||l.includes("float")?e.mdataType[s]={type:"numeric"}:e.mdataType[s]={type:null};if("categorical"==e.mdataType[s].type){let t=new Set(a.column(s).values);t=(t=[...t]).filter(e=>null!=e),e.mdataType[s].nlevels=t.length,e.mdataType[s].levels=t,e.mdataType[s].level2id={},t.map(t=>{e.mdataType[s].level2id[t]=[]});let l=a.column(s);l.index.map((a,n)=>{t.includes(l.values[n])&&e.mdataType[s].level2id[l.values[n]].push(a)})}})}e.user[t.fileType]=a,e.userFileNames[t.fileType]=t.userFileName,e.index[t.fileType]=a.index;break}case"set-log":e.user[t.fileType].min().min()>0?e.results.PRE.log[t.fileType]=t.checked:alert("Logarithm cannot be calculated due to the presence of invalid values (<=0)");break;case"set-scale":e.results.PRE.scale[t.fileType]=t.checked;break;case"set-mv-thr":e.results.PRE.MVThr[t.fileType]=t.thr;break;case"set-mv-type":e.results.PRE.MVType[t.fileType]=t.MVType;break;case"set-annotations-mode":e.annotations.mode=t.mode;break;case"set-annotations-column":e.annotations.column=t.column;break;case"set-job-id":e.jobID=t.jobID;break;case"set-job-context":return t.jobContext}}let x={jobID:null,userFileNames:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},user:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},index:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},norm:{xq:null,xm:null},mdataType:{},annotations:{mode:0,column:null},results:{PRE:{log:{xq:!1,xm:!1},scale:{xq:!0,xm:!0},MV:{xq:null,xm:null},MVThr:{xq:.2,xm:.2},MVType:{xq:"KNN",xm:"KNN"}},EDA:null,MOFA:null,CORR:null,ML:null}}},93097:function(e,t,a){"use strict";let{default:l}=a(31863),n=async(e,t,a)=>{let n=e.container.firstChild.cloneNode(!0),s=t.firstChild.firstChild.firstChild,r=s.children[0].cloneNode(!0),i=s.children[2].cloneNode(!0),o=window.document.createElement("div");o.style.position="relative";let c=window.document.createElement("div");c.appendChild(n),c.style.paddingLeft="20px";let d=window.document.createElement("div");d.appendChild(r);let u=window.document.createElement("div");u.style.position="absolute",u.style.top="230px",u.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(u),l(o,"DataDistribution_".concat(a))};e.exports=n},31863:function(e,t,a){"use strict";function l(e,t){let a=new XMLSerializer().serializeToString(e),l=new Blob([a],{type:"image/svg+xml;charset=utf-8"});var n=URL.createObjectURL(l);let s=window.document.createElement("a");s.style="display:none",s.download="".concat(t),s.href=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),s.remove()}a.r(t),a.d(t,{default:function(){return l}})}},function(e){e.O(0,[683,1,971,596,744],function(){return e(e.s=30151)}),_N_E=e.O()}]);