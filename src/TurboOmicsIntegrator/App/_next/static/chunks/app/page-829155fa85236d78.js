(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{19026:function(e,t,a){Promise.resolve().then(a.bind(a,28325)),Promise.resolve().then(a.bind(a,17473)),Promise.resolve().then(a.bind(a,11093))},28325:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var l=a(57437),s=a(42824),n=a(57380),r=a(87550),i=a(57175),o=a(11093),c=a(16691),d=a.n(c);function u(){let e=(0,o.useVars)().BASE_URL;return(0,l.jsxs)(r.Z,{bg:"dark","data-bs-theme":"dark",className:"bg-body-tertiary",style:{fontSize:"1.2em"},children:[(0,l.jsxs)(s.Z,{className:"mx-0",children:[(0,l.jsx)(r.Z.Brand,{href:"#home",children:(0,l.jsx)(d(),{src:"".concat(e,"/icon.ico"),width:"30",height:"30",className:"d-inline-block align-top",alt:"TurboPutative"})}),(0,l.jsx)(r.Z.Toggle,{"aria-controls":"basic-navbar-nav"}),(0,l.jsx)(r.Z.Collapse,{id:"basic-navbar-nav",children:(0,l.jsxs)(n.Z,{className:"me-auto",children:[(0,l.jsx)(n.Z.Link,{href:"home",className:"mx-2",children:"Home"}),(0,l.jsx)(n.Z.Link,{href:"TurboOmicsApp.html",active:!0,className:"mx-2",children:"TurboOmics"}),(0,l.jsx)(n.Z.Link,{href:"webserver",className:"mx-2",children:"Web Server"}),(0,l.jsx)(n.Z.Link,{href:"webservices",className:"mx-2",children:"Web Services"}),(0,l.jsxs)(i.Z,{title:"Help",id:"basic-nav-dropdown",children:[(0,l.jsx)(i.Z.Item,{href:"webserverhelp",children:"Web Server"}),(0,l.jsx)(i.Z.Item,{href:"webserviceshelp",children:"Web Services"}),(0,l.jsx)(i.Z.Divider,{}),(0,l.jsx)(i.Z.Item,{href:"moduleshelp",children:"Modules"})]}),(0,l.jsx)(n.Z.Link,{href:"contactUs",className:"mx-2",children:"Contact us"})]})})]}),(0,l.jsx)(r.Z.Collapse,{className:"justify-content-end",children:(0,l.jsx)(r.Z.Brand,{href:"home",style:{fontSize:"1.2em"},children:"TurboPutative"})})]})}},11093:function(e,t,a){"use strict";a.r(t),a.d(t,{VarsProvider:function(){return r},useVars:function(){return i}});var l=a(57437),s=a(2265);let n=(0,s.createContext)({DEV_MODE:!1,BASE_URL:"/TurboPutative",API_URL:"https://proteomics.cnic.es/TurboPutative/api/tbomics"});function r(e){let{children:t}=e,a=i();return(0,l.jsx)(n.Provider,{value:a,children:t})}function i(){return(0,s.useContext)(n)}},17473:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return tQ}});var l=a(57437),s=a(2265),n=a(24983),r=a(59844);function i(e){let{children:t}=e;return(0,l.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.5},children:t})}var o=a(49904),c=a(58991),d=a(62455),u=a(96507),x=a(43226),h=a(15133),m=a(35843);let p=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{width:110,height:70,textAlign:"center",backgroundColor:e,cursor:t?"not-allowed":"pointer",userSelect:"none",margin:"0px 15px"}},j=(0,m.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(204, 229, 255, 0.8)"}}});function g(e){let t,{children:a,text:s,id:r,setPage:i,page:o}=e,c=(0,n.tc)().jobID,d="results"==r&&null==c;t=d?"rgba(210,210,210,0.8)":o==r?"rgba(204, 229, 255, 0.8)":"rgba(255,255,255,1)";let m=p(t,d);return(0,l.jsx)(l.Fragment,{children:d?(0,l.jsxs)(h.Z,{sx:m,children:[(0,l.jsx)(u.Z,{sx:{py:1},children:a}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:s})})]}):(0,l.jsxs)(j,{sx:m,onClick:()=>i(r),children:[(0,l.jsx)(u.Z,{sx:{py:1},children:a}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:s})})]})})}var f=a(62970),b=a(11093),v=a(36970);let y=(0,s.createContext)(),Z=(0,s.createContext)();function C(){return(0,s.useContext)(y)}function w(){return(0,s.useContext)(Z)}function A(e){let{children:t}=e,[a,s]=(0,v.C)(P,k);return(0,l.jsx)(y.Provider,{value:a,children:(0,l.jsx)(Z.Provider,{value:s,children:t})})}function P(e,t){switch(console.log("Results object updated: ".concat(t.type)),console.log(t),t.type){case"reset-results":return k;case"set-status":e.status=t.status;break;case"set-tab-value":e.value=t.value;break;case"set-eda-dd-norm":e.EDA.DD.showNorm=t.showNorm;break;case"set-eda-dd-groupby":e.EDA.DD.groupby=t.groupby;break;case"set-eda-dd-filter":e.EDA.DD.filterCol[t.fileType]=t.filterCol;break;case"set-eda-dd-filter-text":e.EDA.DD.filterText[t.fileType]=t.filterText;break;case"set-eda-pca-data":e.EDA.PCA[t.omic].data=t.data;break;case"set-eda-pca-status":e.EDA.PCA[t.omic].status=t.status;break;case"set-scatter-mode":e.EDA.PCA[t.omic].displayOpts.scatterMode=t.mode;break;case"set-selected-plot-cell":e.EDA.PCA[t.omic].displayOpts.selectedCell={rowIndex:t.rowIndex,colIndex:t.colIndex},e.EDA.PCA[t.omic].displayOpts.selectedPlot={mdataCol:t.mdataCol,PCA:t.PCA};break;case"set-selected-plot-2d":e.EDA.PCA[t.omic].displayOpts.selectedPlot2D[t.option]=t.value;break;case"set-filter-col":e.EDA.PCA[t.omic].displayOpts.filterCol=t.value;break;case"set-mofa-data":e.MOFA.data=t.data;break;case"set-selected-plot-cell-mofa":e.MOFA.displayOpts.selectedCell={rowIndex:t.rowIndex,colIndex:t.colIndex},e.MOFA.displayOpts.selectedPlot={mdataCol:t.mdataCol,Factor:t.Factor};break;case"set-scatter-mode-mofa":e.MOFA.displayOpts.scatterMode=t.mode;break;case"set-selected-plot-2d-mofa":e.MOFA.displayOpts.selectedPlot2D[t.option]=t.value}}let k={value:.1,status:{EDA_PCA:{status:"waiting"},MOFA:{status:"waiting"}},EDA:{DD:{showNorm:!0,groupby:{label:"All values",value:"All values"},filterCol:{q2i:"All features",m2i:"All features"},filterText:{q2i:"",m2i:""}},PCA:{q:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"},displayOpts:{scatterMode:"1D",selectedPlot:null,selectedCell:null,selectedPlot2D:{x:1,y:2,g:"No color"},filterCol:"All features"}},m:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"},displayOpts:{scatterMode:"1D",selectedPlot:null,selectedCell:null,selectedPlot2D:{x:1,y:2,g:"No color"},filterCol:"All features"}}}},MOFA:{data:null,displayOpts:{selectedCell:null,selectedPlot:null,scatterMode:"1D",selectedPlot2D:{x:"Factor1",y:"Factor2",g:"No color"}}}},D=(0,m.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(255, 0, 0, 0.3)"}}});function M(e){let{setCreatingJob:t}=e,a=(0,n.Lq)(),s=w(),r=(0,n.tc)(),{DEV_MODE:i,API_URL:o}=(0,b.useVars)(),c=async()=>{t("waiting");let e=i?"123456":function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="";for(let l=0;l<e;l++){let e=Math.floor(Math.random()*t.length);a+=t.charAt(e)}return a}(10);console.log("Creating job: ".concat(e)),a({type:"set-job-id",jobID:e});let l=await fetch("".concat(o,"/create_job"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...{...r,user:{xq:dfd.toJSON(r.user.xq),xm:dfd.toJSON(r.user.xm),mdata:dfd.toJSON(r.user.mdata),q2i:dfd.toJSON(r.user.q2i),m2i:dfd.toJSON(r.user.m2i)},norm:{xq:null,xm:null}},jobID:e})}),n=await l.json(),c={...n,user:{xq:new dfd.DataFrame(n.user.xq,{index:n.index.xq}),xm:new dfd.DataFrame(n.user.xm,{index:n.index.xm}),mdata:new dfd.DataFrame(n.user.mdata,{index:n.index.mdata}),q2i:new dfd.DataFrame(n.user.q2i,{index:n.index.q2i}),m2i:new dfd.DataFrame(n.user.m2i,{index:n.index.m2i})},norm:{xq:new dfd.DataFrame(n.norm.xq,{index:n.index.xq}),xm:new dfd.DataFrame(n.norm.xm,{index:n.index.xm})}};a({type:"set-job-context",jobContext:c}),s({type:"reset-results"}),t("ask-annotations")};return(0,l.jsxs)(D,{sx:{...p("rgba(255, 0, 0, 0.2)"),position:"absolute",right:"12%"},onClick:c,children:[(0,l.jsx)(u.Z,{sx:{py:1},children:(0,l.jsx)(f.Z,{})}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{gutterBottom:!0,variant:"h7",component:"div",children:"Create Job"})})]})}var S=a(35551),T=a(49381);function N(){let{API_URL:e}=(0,b.useVars)(),t=(0,n.Lq)(),a=async a=>{console.log("Loading sample data");let l=await fetch("".concat(e,"/load_sample_data")),s=await l.json();Object.keys(s).forEach(e=>{t({type:"user-upload",fileType:e,userFileName:"".concat(e,".tsv"),dfJson:s[e]})})};return(0,l.jsx)(u.Z,{sx:{alignSelf:"center",position:"absolute",left:"10%"},children:(0,l.jsx)(S.Z,{variant:"outlined",startIcon:(0,l.jsx)(T.Z,{}),onClick:a,children:"Load Sample Data"})})}function F(e){let{page:t,setPage:a,setCreatingJob:s}=e,{user:r}=(0,n.tc)();return(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:["new-job"==t&&(0,l.jsx)(N,{page:t}),(0,l.jsx)(g,{text:"New Job",id:"new-job",setPage:a,page:t,children:(0,l.jsx)(o.Z,{})}),(0,l.jsx)(g,{text:"Find Job",id:"find-job",setPage:a,page:t,children:(0,l.jsx)(c.Z,{})}),(0,l.jsx)(g,{text:"Results",id:"results",setPage:a,page:t,children:(0,l.jsx)(d.Z,{})}),"new-job"==t&&r.mdata&&r.xm&&r.m2i&&r.xq&&r.q2i&&(0,l.jsx)(i,{children:(0,l.jsx)(M,{setCreatingJob:s})})]})}var O=a(11922),I=a(89394),E=a(91797),q=a(26337),R=a(52653),L=a(6252),z=a(33533);a(16691);let V=(0,m.ZP)(I.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function _(e){let{title:t}=e,[a,n]=(0,s.useState)(!1),r=()=>n(!1),i=(0,b.useVars)().BASE_URL;return(0,l.jsxs)("div",{className:"mt-0 pt-0",children:[(0,l.jsx)(R.Z,{onClick:()=>n(!0),children:(0,l.jsx)(L.Z,{})}),(0,l.jsxs)(V,{onClose:r,"aria-labelledby":"customized-dialog-title",open:a,maxWidth:"md",children:[(0,l.jsxs)(E.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:[t," Table"]}),(0,l.jsx)(R.Z,{"aria-label":"close",onClick:r,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,l.jsx)(z.Z,{})}),(0,l.jsxs)(q.Z,{dividers:!0,children:[(0,l.jsx)(x.Z,{gutterBottom:!0,children:"Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1"}),(0,l.jsx)(x.Z,{gutterBottom:!0,children:"Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2"}),(0,l.jsx)("div",{className:"text-center mt-3",children:(0,l.jsx)("img",{src:"".concat(i,"/table.png"),alt:"Table"})})]})]})]})}let B=["","#N/A","#N/A","N/A","#NA","-1.#IND","-1.#QNAN","-NaN","-nan","1.#IND","1.#QNAN","<NA>","N/A","NA","NULL","NaN","None","n/a","nan","null"],J=["TSV"];function K(e){let{title:t,fileType:a}=e,s=(0,n.tc)().userFileNames[a],r=(0,n.Lq)();async function i(e){let t=await e.text(),l=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"	";return new Promise(a=>{let l=e.split(/[\r\n]+/);if(l.length<2)throw Error("String text does not have expected DataFrame format");let s=l[0].split(t).map(e=>e.trim()),n=[];for(let e=1;e<l.length;e++){let a=l[e].split(t).map(e=>e.trim());if(a.length===s.length){let e={};for(let t=0;t<s.length;t++)e[s[t]]=B.includes(a[t])?null:a[t];n.push(e)}else console.log(a),console.log("Row number ".concat(e," could not be read"))}a(n)})}(t);r({type:"user-upload",fileType:a,userFileName:e.name,dfJson:l})}return(0,l.jsx)("div",{className:"DragFile mx-2 text-center",style:{width:"30%"},children:(0,l.jsxs)(h.Z,{sx:{transition:"all 1s ease",backgroundColor:s?"rgba(220,220,220,0.5)":"rgba(250,250,250,0.5)"},children:[(0,l.jsx)(x.Z,{variant:"h6",className:"pt-2",children:t}),(0,l.jsx)(_,{title:t}),(0,l.jsx)(u.Z,{sx:{width:400,margin:"auto"},children:(0,l.jsx)(O.b,{multiple:!1,handleChange:i,name:a,types:J})}),(0,l.jsx)("p",{className:"mt-3",children:s?"File name: ".concat(s):"no files uploaded yet"})]})})}var G=a(73701),U=a(39279),Y=a(30666),H=a(15795),W=a(98489),X=a(29872),Q=a(39190);let $=(0,Q.Z)(Y.Z)(e=>{let{theme:t}=e;return{textAlign:"center"}});function ee(){let e=(0,n.tc)().results.PRE.MVThr.xq,t=(0,n.tc)().results.PRE.MVThr.xm,a=(0,n.tc)().user;return(0,l.jsx)(H.Z,{component:X.Z,sx:{width:300},children:(0,l.jsx)(G.Z,{size:"small","aria-label":"a dense table",children:(0,l.jsxs)(U.Z,{children:[null!=a.mdata&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(W.Z,{children:[(0,l.jsx)($,{children:"n"}),(0,l.jsx)($,{children:a.mdata.shape[0]})]}),(0,l.jsxs)(W.Z,{children:[(0,l.jsx)($,{children:"Meta-variables"}),(0,l.jsx)($,{children:a.mdata.shape[1]})]})]}),null!=a.xq&&(0,l.jsxs)(W.Z,{children:[(0,l.jsx)($,{children:"Proteomic features"}),(0,l.jsxs)($,{children:[a.xq.isNa().sum({axis:0}).div(a.xq.shape[0]).le(e).sum()," / ",a.xq.shape[1]]})]}),null!=a.xm&&(0,l.jsxs)(W.Z,{children:[(0,l.jsx)($,{children:"Metabolomic features"}),(0,l.jsxs)($,{children:[a.xm.isNa().sum({axis:0}).div(a.xm.shape[0]).le(t).sum()," / ",a.xm.shape[1]]})]})]})})})}var et=a(98864),ea=a.n(et);let el=ea()(()=>a.e(508).then(a.bind(a,38508)),{loadableGenerated:{webpack:()=>[38508]},ssr:!1});function es(){return(0,l.jsxs)(u.Z,{sx:{width:"100%"},className:"p-2",children:[(0,l.jsxs)("div",{className:"py-2 d-flex justify-content-between",children:[(0,l.jsx)(K,{title:"Proteomic Metadata",fileType:"q2i"}),(0,l.jsx)(K,{title:"Metadata",fileType:"mdata"}),(0,l.jsx)(K,{title:"Metabolomic Metadata",fileType:"m2i"})]}),(0,l.jsxs)("div",{className:"py-2 d-flex justify-content-between align-items-center",children:[(0,l.jsx)(K,{title:"Proteomic Quantifications",fileType:"xq"}),(0,l.jsx)(ee,{}),(0,l.jsx)(K,{title:"Metabolomic Quantifications",fileType:"xm"})]}),(0,l.jsxs)(u.Z,{sx:{py:1,display:"flex",justifyContent:"space-around"},children:[(0,l.jsx)(el,{fileType:"xq",omic:"Proteomic"}),(0,l.jsx)(u.Z,{sx:{width:"33%"}}),(0,l.jsx)(el,{fileType:"xm",omic:"Metabolomic"})]})]})}var en=a(99960);function er(e){let{setPage:t}=e,[a,r]=(0,s.useState)(""),[i,o]=(0,s.useState)(!0),d=(0,n.Lq)(),u=(0,b.useVars)().API_URL;async function x(e){console.log("Search Job ID: ".concat(e));let a=await fetch("".concat(u,"/search/").concat(e)),l=await a.json();console.log("Server response received:"),l.exist?(d({type:"find-job",results:l.results}),t("results")):o(!1)}return(0,l.jsx)("div",{className:"mx-auto mt-4 text-center",children:(0,l.jsx)(en.Z,{id:"outlined-basic",label:"Search Job",variant:"outlined",onChange:e=>{r(e.target.value),o(!0)},value:a,InputProps:{endAdornment:(0,l.jsx)(()=>(0,l.jsx)(R.Z,{onClick:()=>x(a),children:(0,l.jsx)(c.Z,{})}),{})},sx:{width:"70%",marginTop:"20%"},autoFocus:!0,error:!i,helperText:!i&&"Job not found"})})}var ei=a(19045),eo=a(92277),ec=a(6882),ed=a(28874);function eu(e,t){let a=e.slice().sort((e,t)=>e-t),l=Math.floor(a.length*t),s=a[l];return s}function ex(e,t,a){let l=(t-e)/(a-1),s=[];for(let t=0;t<a;t++){let a=e+t*l;s.push(a)}return s.filter(e=>e<0).length>0&&s.filter(e=>e>0).length>0&&s.push(0),s.sort((e,t)=>e-t),s=s.map(e=>Math.floor(100*e)/100)}var eh=a(90045),em=a(16573),ep=a(24235),ej=a(50039),eg=a(2047),ef=a(51125);let eb=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function ev(e){let{dataHist:t,gValues:a,xrange:s,yrange:n,xTicks:r,histRef:i}=e;return(0,l.jsxs)(eh.T,{ref:i,style:{margin:"auto"},width:500,height:210,data:t,margin:{top:10,right:30,left:0,bottom:0},children:[(0,l.jsx)(em.q,{strokeDasharray:"3 3"}),(0,l.jsx)(ep.K,{dataKey:"binCenter",type:"number",ticks:r,domain:s}),(0,l.jsx)(ej.B,{domain:n}),(0,l.jsx)(eg.u,{}),a.map((e,t)=>(0,l.jsx)(ef.u,{connectNulls:!0,type:"monotone",dataKey:e,fillOpacity:.3,stroke:eb[t%eb.length],fill:eb[t%eb.length]},e))]})}let ey=ea()(()=>Promise.all([a.e(934),a.e(901)]).then(a.bind(a,87022)),{loadableGenerated:{webpack:()=>[87022]},ssr:!1});function eZ(e){let{data:t,xrange:a,xTicks:s,boxRef:n}=e;return(0,l.jsx)(u.Z,{ref:n,children:(0,l.jsx)(ey,{style:{position:"relative",left:-20},data:t,layout:{width:570,height:280,showlegend:!0,legend:{orientation:"h"},xaxis:{zeroline:!1,range:a,tickvals:s},yaxis:{type:"category",showticklabels:!1},margin:{t:0}},config:{staticPlot:!0,displayModeBar:!1},onChange:e=>console.log(e)})})}function eC(e){let{fileType:t,filteredID:a,groupby:r,showNorm:o,histRef:c,boxRef:d}=e,x=(0,n.tc)().user.mdata,h={norm:(0,n.tc)().norm[t],user:(0,n.tc)().user[t]},m=o?h.norm:h.user,{myData:p,dataAnova:j,gValues:g,idx2g:f}=(0,s.useMemo)(()=>{let e;let t={};for(let e=0;e<x.shape[0];e++)x.columns.includes(r)?null!=x.column(r).values[e]&&(t[x.index[e]]=x.column(r).values[e]):t[x.index[e]]="All values";let l=Object.keys(t).map(e=>t[e]).filter((e,t,a)=>a.indexOf(e)===t),s=[],n={};l.map(e=>n[e]=[]);let i=(e={},dfd.toJSON(m).map((t,a)=>{e[m.index[a]]=t}),e);return Object.keys(i).map(e=>{Object.keys(t).includes(e)&&Object.keys(i[e]).map(l=>{null!=i[e][l]&&a.includes(l)&&(n[t[e]].push(i[e][l]),s.push({ID:e,feature:l,g:t[e],x:i[e][l]}))})}),{myData:n,dataAnova:s,gValues:l,idx2g:t}},[r,x,m,a]),{xrange:b,xTicks:v,minimum:y,maximum:Z}=(0,s.useMemo)(e=>{let t=Object.keys(p).map(e=>p[e]).flat(),a=eu(t,1e-4),l=eu(t,.9999),s=[a-Math.abs(.05*a),l+Math.abs(.05*l)],n=ex(a,l,6);return{xrange:s,xTicks:n,minimum:a,maximum:l}},[p]),{dataHist:C,yrange:w}=(0,s.useMemo)(()=>{let e={};Object.keys(p).map(t=>{e[t]=p[t].filter(e=>y<=e&&e<=Z)}),Object.keys(e).map(t=>{try{e[t].length>0?e[t]=function(e,t){let a=Math.min(...e),l=(Math.max(...e)-a)/t,s=Array(t).fill(0);e.forEach(e=>{let n=Math.floor((e-a)/l);n>=0&&n<t&&s[n]++});let n=s.map(t=>t/(e.length*l)),r=Array(t).fill(0).map((e,t)=>a+(t+.5)*l),i=[];for(let e=0;e<t;e++)i.push({binCenter:r[e],density:n[e]});return i}(e[t],1+Math.ceil(Math.log2(e[t].length))):delete e[t]}catch(e){console.error(e)}}),(e=(e=Object.keys(e).map(t=>e[t].map(e=>{let{binCenter:a,density:l}=e;return{binCenter:Math.round(100*a)/100,[t]:Number.parseFloat(l).toExponential(3),d:l}}))).flat()).sort((e,t)=>e.binCenter-t.binCenter);let t=Math.max(...e.map(e=>e.d)),a=[0,Number.parseFloat((1.05*t).toPrecision(2))];return{dataHist:e,yrange:a}},[p,y,Z]),A=(0,s.useMemo)(()=>Object.keys(p).map((e,t)=>p[e].length>0?{x:p[e],type:"box",name:"".concat(e),marker:{color:eb[t%eb.length]}}:null).filter(e=>null!=e),[p]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{sx:{height:210},children:(0,l.jsx)(ev,{dataHist:C,gValues:g,xrange:b,xTicks:v,yrange:w,histRef:c})}),(0,l.jsx)(u.Z,{sx:{height:280,width:500,margin:"auto",overflowX:"hidden",overflowY:"hidden"},children:(0,l.jsx)(i,{children:(0,l.jsx)(eZ,{data:A,xrange:b,xTicks:v,boxRef:d})})})]})}var ew=a(97472);function eA(e){let{options:t,handleSelect:a,label:n}=e,r=C().EDA.DD.groupby,i=w(),[o,c]=(0,s.useState)(r);return(0,s.useEffect)(()=>{i({type:"set-eda-dd-groupby",groupby:o})},[o,i]),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:n}),(0,l.jsx)(ew.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:o,onChange:e=>{c({label:e.value,value:e.value}),setTimeout(()=>a(e),100)}})]})}function eP(e){let{options:t,value:a,onChange:s,label:n}=e;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:n}),(0,l.jsx)(ew.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:a,onChange:s})]})}var ek=a(43560);function eD(e){let{columns:t,data:a}=e,n=(0,s.useRef)(null),[r,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]);return(0,s.useEffect)(()=>{o(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=n.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,l.jsx)(i,{children:(0,l.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,l.jsx)(ek.P2,{columns:t,data:a,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:n,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}function eM(e){let{omic:t,fileType:a,setFilteredID:r,updatePlot:o}=e,c=C().EDA.DD.filterText[a],d=C().EDA.DD.filterCol[a],x=w(),[h,m]=(0,s.useState)(c),[p,j]=(0,s.useState)(d),g=(0,n.tc)().user[a],{filteredFeatures:f,columns:b}=(0,s.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:50}];return g.columns.includes(p)?(e=(e=(e=g.column(p)).values.map((t,a)=>({ID:e.index[a],[p]:t}))).filter(e=>null!=e[p]&&"".concat(e[p]).toLowerCase().includes(h.toLowerCase())),t.push({accessorKey:p,header:p,size:170})):e=(e=g.index).map((e,t)=>({ID:e})),{filteredFeatures:e,columns:t}},[h,p,g]);return(0,s.useEffect)(()=>{console.log("useEffect: Recalculating features");let e=setTimeout(()=>{r(e=>({...e,[a]:f.map(e=>e.ID)})),o([t]),console.log("Features recalculated")},500);return()=>clearTimeout(e)},[f,a,r,o,t]),(0,s.useEffect)(()=>{x({type:"set-eda-dd-filter",filterCol:p,fileType:a}),x({type:"set-eda-dd-filter-text",filterText:h,fileType:a})},[p,h,a,x]),(0,l.jsxs)(u.Z,{sx:{width:"95%",margin:"auto"},children:[(0,l.jsxs)(u.Z,{sx:{display:"flex",height:"10vh"},children:[(0,l.jsx)(u.Z,{sx:{width:"40%",pt:1},children:(0,l.jsx)(eP,{options:[{label:"All features",value:"All features"},...g.columns.map(e=>({label:e,value:e}))],onChange:e=>j(e.value),value:{label:p,value:p}})}),g.columns.includes(p)&&(0,l.jsx)(i,{children:(0,l.jsx)(u.Z,{sx:{mt:3,ml:3},children:(0,l.jsx)(en.Z,{id:"standard-name",placeholder:"Filter text",value:h,onChange:e=>m(e.target.value)})})})]}),(0,l.jsx)(u.Z,{sx:{mt:0},children:(0,l.jsx)(eD,{data:f,columns:b})})]})}var eS=a(89554),eT=a(93097),eN=a.n(eT);function eF(e){let{children:t,sx:a}=e;return(0,l.jsx)(u.Z,{sx:{...a},style:{scrollSnapAlign:"center",border:"0px solid yellow"},children:t})}function eO(e){let{children:t,height:a}=e;return(0,l.jsx)(u.Z,{sx:{height:{height:a},scrollSnapType:"y mandatory",overflow:"auto",border:"0px solid red"},children:t})}function eI(){let e=(0,s.useRef)(),t=(0,s.useRef)(),a=(0,s.useRef)(),r=(0,s.useRef)(),i=C().EDA.DD.showNorm,o=C().EDA.DD.groupby,[c,d]=(0,s.useState)({q:!1,m:!1}),[h,m]=(0,s.useState)({q2i:[],m2i:[]}),[p,j]=(0,s.useState)(i),[g,f]=(0,s.useState)(o),{mdataType:b}=(0,n.tc)(),v=(0,n.tc)().user.mdata.columns.map(e=>({label:e,value:e}));v=[{label:"All values",value:"All values"},...v=v.filter(e=>"categorical"==b[e.value].type)];let y=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["q","m"];e.map(e=>{d(t=>({...t,[e]:!1}))}),e.map(e=>setTimeout(()=>d(t=>({...t,[e]:!0})),300))},[]),Z=(0,s.useCallback)(e=>{f({label:e.value,value:e.value}),y(["q","m"])},[y]);return(0,s.useCallback)(e=>{j(e.target.checked),y(["q","m"])},[y]),(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(ed.ZP,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",sx:{mb:3,mt:0},children:[!1,(0,l.jsx)(ed.ZP,{item:!0,xs:3,children:(0,l.jsx)(eA,{options:v,handleSelect:Z,label:"Group by"})})]}),(0,l.jsx)(eO,{height:"70vh",children:(0,l.jsx)(u.Z,{sx:{flexGrow:1,p:0,mt:0},children:(0,l.jsxs)(ed.ZP,{container:!0,direction:"row",justifyContent:"center",spacing:2,sx:{p:0},children:[(0,l.jsxs)(ed.ZP,{item:!0,sx:{borderRight:"1px solid #cccccc"},xs:6,children:[(0,l.jsxs)(eF,{children:[(0,l.jsxs)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Proteomics",(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:a=>eN()(e.current,t.current,"Proteomics"),sx:{opacity:.5,visibility:c.q?"visible":"hidden",paddingBottom:1},children:(0,l.jsx)(eS.Z,{})})]}),c.q?(0,l.jsx)(u.Z,{sx:{height:550,overflowX:"auto"},children:(0,l.jsx)(eC,{fileType:"xq",filteredID:h.q2i,groupby:g.value,showNorm:p,histRef:e,boxRef:t})}):(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,l.jsx)(ec.Z,{size:100,thickness:2})})]}),(0,l.jsx)(eF,{children:(0,l.jsx)(eM,{omic:"q",fileType:"q2i",setFilteredID:m,updatePlot:y})})]}),(0,l.jsxs)(ed.ZP,{item:!0,xs:6,sx:{borderLeft:"1px solid #cccccc"},children:[(0,l.jsxs)(eF,{children:[(0,l.jsxs)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Metabolomics",(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:e=>eN()(a.current,r.current,"Metabolomics"),sx:{opacity:.5,visibility:c.m?"visible":"hidden",paddingBottom:1},children:(0,l.jsx)(eS.Z,{})})]}),c.m?(0,l.jsx)(u.Z,{sx:{height:550,overflowX:"auto"},children:(0,l.jsx)(eC,{fileType:"xm",filteredID:h.m2i,groupby:g.value,showNorm:p,histRef:a,boxRef:r})}):(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,l.jsx)(ec.Z,{size:100,thickness:2})})]}),(0,l.jsx)(eF,{children:(0,l.jsx)(eM,{omic:"m",fileType:"m2i",setFilteredID:m,updatePlot:y})})]})]})})})]})}var eE=a(50817),eq=a(48389),eR=a(66988),eL=a(62254),ez=a(55183);let eV="rgba(200,200,200,0.5)",e_=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(eV),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV),"&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV)}}}),eB={textAlign:"center",padding:.5,border:"1px solid ".concat(eV),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},eJ=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),eK=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function eG(e){let{omic:t,data:a,rowNames:n,colNames:r,expVar:i,setSelectedPlot:o,scatterMode:c}=e,d=C().EDA.PCA[t].displayOpts.selectedCell,x=w(),h=e_(c),[m,p]=(0,s.useState)(d),j=(e,a)=>{"2D"!=c&&(p({rowIndex:e,colIndex:a}),o({mdataCol:n[e],PCA:r[a]}),x({omic:t,type:"set-selected-plot-cell",rowIndex:e,colIndex:a,mdataCol:n[e],PCA:r[a]}),console.log("Plot scatter: PCA ".concat(r[a]," vs ").concat(n[e])))},g=(0,s.useMemo)(()=>{let e=[];e.push(["PCA / Cond.",...r]),e.push(["%Variance",...i]);let t=a.map((e,t)=>[n[t],...e]);return[...e,...t]},[r,i,a,n]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,l.jsx)(ez.CSVLink,{data:g,filename:"PCA_Anova_pvalues.csv",separator:",",children:(0,l.jsx)(eL.Z,{})})})}),(0,l.jsxs)(ed.ZP,{container:!0,children:[(0,l.jsx)(ed.ZP,{item:!0,xs:2,children:(0,l.jsx)(H.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(G.Z,{children:[(0,l.jsx)(eR.Z,{children:(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,textAlign:"center"},children:"PCA / Cond."})})}),(0,l.jsxs)(U.Z,{children:[(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:{...eB,borderBottom:"1px solid rgba(10,10,10,1)"},children:"%Variance"})})},"expVar"),n.map((e,t)=>(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:eB,children:e})})},t))]})]})})}),(0,l.jsx)(ed.ZP,{item:!0,xs:10,children:(0,l.jsx)(H.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(G.Z,{children:[(0,l.jsx)(eR.Z,{children:(0,l.jsx)(W.Z,{children:a[0].map((e,t)=>(0,l.jsx)(Y.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:t+1},t))})}),(0,l.jsxs)(U.Z,{children:[(0,l.jsx)(W.Z,{children:i.map((e,t)=>(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:{padding:.5,border:"1px solid ".concat(eV),borderBottom:"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:eK(e),userSelect:"none"},children:e})},t))},"expVar"),a.map((e,t)=>(0,l.jsx)(W.Z,{children:e.map((e,a)=>(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},onClick:()=>j(t,a),children:(0,l.jsx)(u.Z,{sx:m&&m.rowIndex===t&&m.colIndex===a?{...h.cell,...h.selectedCell,...eJ(e)}:{...h.cell,...eJ(e)},children:e.toFixed(3)})},a))},t))]})]})})})]})]})}var eU=a(35048),eY=a(41125),eH=a(33343),eW=a(89366),eX=a(79857),eQ=a(31863);let e$=e=>{let{active:t,payload:a}=e;return t&&a&&a.length?(0,l.jsxs)(u.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(x.Z,{variant:"h8",sx:{display:"block"},children:"".concat(a[0].payload.element)}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[0].name,": ").concat("string"==typeof a[0].value?a[0].value:a[0].value.toFixed(3))}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[1].name,": ").concat(a[1].value.toFixed(3))})]}):null},e0=e=>{let{scatterRef:t}=e;return(0,l.jsx)(u.Z,{sx:{height:0},children:(0,l.jsx)(u.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),a=window.document.createElement("div");a.appendChild(e),(0,eQ.default)(a,"PCA_Scatter")},sx:{opacity:.5},children:(0,l.jsx)(eS.Z,{})})})})};function e1(e){let t,{scatterData:a,mdataCol:r,PCA:i}=e,o=(0,s.useRef)(),c=(0,n.tc)().mdataType[r].type;return"categorical"==c&&(t="category"),"numeric"==c&&(t="number"),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(e0,{scatterRef:o}),(0,l.jsx)(eU.h,{width:"100%",height:400,children:(0,l.jsxs)(eY.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(em.q,{}),(0,l.jsx)(ep.K,{type:t,dataKey:"mdataValue",name:r,allowDuplicatedCategory:!1,children:(0,l.jsx)(eH._,{value:r,offset:-10,position:"insideBottom"})}),(0,l.jsx)(ej.B,{type:"number",dataKey:"projection",name:"PCA ".concat(i),children:(0,l.jsx)(eH._,{value:"PCA ".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(e$,{})}),(0,l.jsx)(eW.b,{data:a,fill:"#8884d8"})]})})]})}function e2(e){let{scatterData:t,selectedPlot2D:a}=e,n=(0,s.useRef)();return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(e0,{scatterRef:n}),(0,l.jsx)(eU.h,{width:"100%",height:400,children:(0,l.jsxs)(eY.G,{ref:n,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(em.q,{}),(0,l.jsx)(ep.K,{type:"number",dataKey:"x",name:"PCA ".concat(a.x),children:(0,l.jsx)(eH._,{value:"PCA ".concat(a.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(ej.B,{type:"number",dataKey:"y",name:"PCA ".concat(a.y),children:(0,l.jsx)(eH._,{value:"PCA ".concat(a.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(e$,{})}),Object.keys(t).length>1&&(0,l.jsx)(eX.D,{verticalAlign:"top"}),Object.keys(t).map((e,a)=>(0,l.jsx)(eW.b,{data:t[e],fill:eb[a%eb.length],name:e},e))]})})]})}var e5=a(92069);function e3(e){let{omic:t,selectedLoadings:a,selectedPCA:r}=e,o=w(),{displayOpts:c}=C().EDA.PCA[t],[d,x]=(0,s.useState)(""),[h,m]=(0,s.useState)(c.filterCol),p=(0,n.tc)().user["".concat(t,"2i")],{filteredFeatures:j,columns:g}=(0,s.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:60},{accessorKey:"mdataValue",header:"",size:10},...r.map((e,t)=>({accessorKey:"PCA".concat(t),header:"Loadings PCA".concat(e),size:100}))];return p.columns.includes(h)?(e=(e=(e=p.column(h)).values.map((t,l)=>void 0==a[e.index[l]]?null:{ID:e.index[l],mdataValue:t,...a[e.index[l]].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e.index[l]][0]})}).filter(e=>null!=e)).filter(e=>null!=e.mdataValue&&"".concat(e.mdataValue).toLowerCase().includes(d.toLowerCase())),t[1].header=h,t[1].size=100):e=Object.keys(a).map((e,t)=>({ID:e,mdataValue:"",...a[e].reduce((e,t,a)=>({...e,["PCA".concat(a)]:t}),{PCA0:a[e][0]})})),{filteredFeatures:e,columns:t}},[a,d,h,p,r]);return(0,l.jsxs)(u.Z,{sx:{width:"95%",margin:"auto"},children:[(0,l.jsxs)(u.Z,{sx:{display:"flex",height:"10vh"},children:[(0,l.jsx)(u.Z,{sx:{mt:4,ml:0},children:(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:e=>e9(j,g),sx:{opacity:.5,color:"rgb(13,110,253)"},variant:"danger",children:(0,l.jsx)(eL.Z,{})})}),(0,l.jsx)(u.Z,{sx:{width:"40%",pt:1,ml:3},children:(0,l.jsx)(eP,{options:[{label:"All features",value:"All features"},...p.columns.map(e=>({label:e,value:e}))],onChange:e=>{m(e.value),o({type:"set-filter-col",value:e.value,omic:t})},value:{label:h,value:h}})}),p.columns.includes(h)&&(0,l.jsx)(i,{children:(0,l.jsx)(u.Z,{sx:{mt:3,ml:3},children:(0,l.jsx)(en.Z,{id:"standard-name",placeholder:"Filter text",value:d,onChange:e=>{x(e.target.value)}})})})]}),(0,l.jsx)(u.Z,{sx:{mt:0},children:(0,l.jsx)(e8,{data:j,columns:g})})]})}let e9=(e,t)=>{let a=(0,e5.iL)({useKeysAsHeaders:!0,filename:"PCA_Loading_Table"}),l=e.map(e=>{let a={};return t.map(t=>{""!=t.header&&(a[t.header]=e[t.accessorKey])}),a}),s=(0,e5.gB)(a)(l);(0,e5.LR)(a)(s)};function e8(e){let{columns:t,data:a}=e,n=(0,s.useRef)(null),[r,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]);return(0,s.useEffect)(()=>{o(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=n.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,l.jsx)(i,{children:(0,l.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,l.jsx)(ek.P2,{columns:t,data:a,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:n,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}var e6=function(e){let{pvColNames:t,pvRowNames:a,selectedPlot2D:s,setSelectedPlot2D:r,omic:i}=e,o=w(),{mdataType:c}=(0,n.tc)();return(0,l.jsxs)(u.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eP,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,x:e.value})),o({type:"set-selected-plot-2d",option:"x",value:e.value,omic:i})},value:{label:"PCA ".concat(s.x),value:s.x},label:"X axis"})}),(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eP,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,y:e.value})),o({type:"set-selected-plot-2d",option:"y",value:e.value,omic:i})},value:{label:"PCA ".concat(s.y),value:s.y},label:"Y axis"})}),(0,l.jsx)(u.Z,{sx:{width:"40%"},children:(0,l.jsx)(eP,{options:[{label:"No color",value:"No color"},...a.filter(e=>"categorical"==c[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),o({type:"set-selected-plot-2d",option:"g",value:e.value,omic:i})},value:{label:s.g,value:s.g},label:"Color by"})})]})};function e4(e){let{title:t,omic:a}=e,r=(0,s.useRef)(null),{API_URL:i}=(0,b.useVars)(),o=w(),c=C().EDA.PCA[a].status,d=C().EDA.PCA[a].data,[h,m]=(0,s.useState)(c),[p,j]=(0,s.useState)(d),{projections:g,loadings:f,explained_variance:v,anova:y}=p,{mdata:Z}=(0,n.tc)().user,{mdataType:A}=(0,n.tc)(),{jobID:P}=(0,n.tc)(),{displayOpts:k}=C().EDA.PCA[a],[D,M]=(0,s.useState)(k.scatterMode),[S,T]=(0,s.useState)(k.selectedPlot),[N,F]=(0,s.useState)(k.selectedPlot2D),O=(0,s.useCallback)(async()=>{console.log("Fetching data");let e=await fetch("".concat(i,"/get_eda_pca/").concat(P,"/").concat(a)),{resStatus:t,dataPCA:l}=await e.json();console.log(t),"waiting"!=t.status&&(console.log("Status changed: ".concat(JSON.stringify(t))),j(l),m(t),o({type:"set-eda-pca-data",data:l,omic:a}),o({type:"set-eda-pca-status",status:t,omic:a}),clearInterval(r.current))},[i,P,a,o,r]);(0,s.useEffect)(()=>{if(console.log("useEffect to get data"),"waiting"==h.status)return console.log("Get data from server"),r.current=setInterval(O,2e3),()=>clearInterval(r.current)},[r,O,h.status]);let{pvTable:I,pvRowNames:E,pvColNames:q,pvExpVar:R}=(0,s.useMemo)(()=>e7(y,v,Z,h),[y,v,Z,h]),L=(0,s.useMemo)(()=>te(g,Z,A,S,N,h,D),[g,Z,A,S,N,h,D]),z=(0,s.useMemo)(()=>tt(f,S,N,h,D),[f,S,N,h,D]);return(0,l.jsx)(u.Z,{sx:{borderRight:"q"==a?"1px solid #cccccc":"0px"},children:"ok"==h.status?(0,l.jsxs)(u.Z,{sx:{padding:1},children:[(0,l.jsx)(eF,{children:(0,l.jsx)(u.Z,{sx:{pt:3},children:(0,l.jsx)(eG,{omic:a,data:I,rowNames:E,colNames:q,expVar:R,setSelectedPlot:T,scatterMode:D})})}),(0,l.jsxs)(eF,{children:[(0,l.jsx)(u.Z,{sx:{textAlign:"center",mt:2},children:(0,l.jsx)(u.Z,{sx:{mb:2},children:(0,l.jsxs)(eE.Z,{color:"primary",value:D,exclusive:!0,onChange:(e,t)=>{M(e.target.value),o({type:"set-scatter-mode",mode:e.target.value,omic:a})},"aria-label":"Platform",children:[(0,l.jsx)(eq.Z,{value:"1D",children:"1D"}),(0,l.jsx)(eq.Z,{value:"2D",children:"2D"})]})})}),(0,l.jsx)(u.Z,{sx:{textAlign:"center"},children:"1D"==D?(0,l.jsx)(u.Z,{sx:{height:75,pt:3},children:(0,l.jsx)(x.Z,{variant:"body1",children:"Select a pvalue cell to plot PCA"})}):(0,l.jsx)(e6,{pvColNames:q,pvRowNames:E,selectedPlot2D:N,setSelectedPlot2D:F,omic:a})}),L&&(0,l.jsx)(u.Z,{children:"1D"==D?(0,l.jsx)(e1,{scatterData:L,mdataCol:S.mdataCol,PCA:S.PCA}):(0,l.jsx)(e2,{scatterData:L,selectedPlot2D:N})})]}),z&&(0,l.jsx)(eF,{children:(0,l.jsx)(u.Z,{sx:{marginTop:5,textAlign:"center"},children:(0,l.jsx)(e3,{omic:a,selectedLoadings:z,selectedPCA:"1D"==D?[S.PCA]:[N.x,N.y]})})})]}):"waiting"==h.status?(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:(0,l.jsx)(ec.Z,{size:100,thickness:2})}):"error"==h.status?(0,l.jsx)(u.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:"An error occurred"}):void 0})}let e7=(e,t,a,l)=>{let s,n,r,i,o;if("ok"==l.status){s=a.columns.map(t=>Object.keys(e).map(a=>[t,parseInt(a),e[a][t]]));for(let e=0;e<s.length;e++)s[e].sort((e,t)=>e[1]-t[1]);r=(s=s.filter(e=>!e.map(e=>0==Object.keys(e[2]).length).every(e=>e))).map(e=>e[0][0]),i=s[0].map(e=>e[1]),n=s.map(e=>e.map(e=>e[2].pvalue)),o=Object.keys(t).map(e=>(100*t[e].Explained_Variance).toFixed(1))}return{pvTable:n,pvRowNames:r,pvColNames:i,pvExpVar:o}},te=(e,t,a,l,s,n,r)=>{let i=null;if("ok"==n.status&&"1D"==r&&l){let a=t.column(l.mdataCol);i=Object.keys(e).map(t=>({element:t,projection:e[t][l.PCA],mdataValue:a.values[a.index.indexOf(t)]}))}else"ok"==n.status&&"2D"==r&&s&&(Object.keys(a).includes(s.g)?(i={},a[s.g].levels.map(t=>{i[t]=[],a[s.g].level2id[t].map(a=>{Object.keys(e).includes(a)&&i[t].push({element:a,x:e[a][s.x],y:e[a][s.y]})})})):i={[s.g]:Object.keys(e).map(t=>({element:t,x:e[t][s.x],y:e[t][s.y]}))});return i},tt=(e,t,a,l,s)=>{let n=null;return"ok"==l.status&&"1D"==s&&t?(n={},Object.keys(e).map(a=>{n[a]=[parseFloat(e[a][t.PCA].toFixed(5))]})):"ok"==l.status&&"2D"==s&&(n={},Object.keys(e).map(t=>{n[t]=[parseFloat(e[t][a.x].toFixed(5)),parseFloat(e[t][a.y].toFixed(5))]})),n};function ta(){return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(ed.ZP,{container:!0,children:[(0,l.jsx)(ed.ZP,{item:!0,xs:6,children:(0,l.jsx)(tl,{children:"Proteomics"})}),(0,l.jsx)(ed.ZP,{item:!0,xs:6,children:(0,l.jsx)(tl,{children:"Metabolomics"})})]}),(0,l.jsx)(eO,{height:"75vh",children:(0,l.jsxs)(ed.ZP,{container:!0,children:[(0,l.jsx)(ed.ZP,{item:!0,xs:6,children:(0,l.jsx)(e4,{title:"Proteomics",omic:"q"})}),(0,l.jsx)(ed.ZP,{item:!0,xs:6,children:(0,l.jsx)(e4,{title:"Metabolomics",omic:"m"})})]})})]})}let tl=e=>{let{children:t}=e;return(0,l.jsx)(x.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:t})};var ts=a(54986);let tn="rgba(200,200,200,0.5)",tr=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(tn),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn),"&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn)}}}),ti={textAlign:"center",padding:.5,border:"1px solid ".concat(tn),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},to=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),tc=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function td(e){let{anova:t,explained_variance:a,setSelectedPlot:n,scatterMode:r,factorNames:i,colNames:o,rowNames:c}=e,d=w(),x=tr(r),h=C().MOFA.displayOpts.selectedCell,[m,p]=(0,s.useState)(h),j=(0,s.useMemo)(()=>c.map(e=>i.map(a=>t[a][e].pvalue)),[t,c,i]),[g,f]=(0,s.useMemo)(()=>[i.map(e=>a.q[e].Explained_Variance),i.map(e=>a.m[e].Explained_Variance)],[a,i]),b=(e,t)=>{"2D"!=r&&(p({rowIndex:e,colIndex:t}),n({mdataCol:c[e],Factor:i[t]}),d({type:"set-selected-plot-cell-mofa",rowIndex:e,colIndex:t,mdataCol:c[e],Factor:i[t]}),console.log("Plot scatter: MOFA ".concat(i[t]," vs ").concat(c[e])))},v=(0,s.useMemo)(()=>{let e=[];e.push(["Factor / Cond.",...o]),e.push(["%Var (P)",...g]),e.push(["%Var (M)",...f]);let t=j.map((e,t)=>[c[t],...e]);return[...e,...t]},[o,g,f,j,c]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,l.jsx)(ez.CSVLink,{data:v,filename:"MOFA_Anova_pvalues.csv",separator:",",children:(0,l.jsx)(eL.Z,{})})})}),(0,l.jsxs)(ed.ZP,{container:!0,children:[(0,l.jsx)(ed.ZP,{item:!0,xs:2,children:(0,l.jsx)(H.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(G.Z,{children:[(0,l.jsx)(eR.Z,{children:(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,textAlign:"center"},children:"Factor / Cond."})})}),(0,l.jsxs)(U.Z,{children:[["P","M"].map(e=>(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsxs)(u.Z,{sx:{...ti,borderBottom:"M"==e&&"1px solid rgba(10,10,10,1)"},children:["%Var (",e,")"]})})},e)),c.map((e,t)=>(0,l.jsx)(W.Z,{children:(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:ti,children:e})})},t))]})]})})}),(0,l.jsx)(ed.ZP,{item:!0,xs:10,children:(0,l.jsx)(H.Z,{sx:{margin:"auto"},children:(0,l.jsxs)(G.Z,{children:[(0,l.jsx)(eR.Z,{children:(0,l.jsx)(W.Z,{children:o.map((e,t)=>(0,l.jsx)(Y.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:e},t))})}),(0,l.jsxs)(U.Z,{children:[[g,f].map((e,t)=>(0,l.jsx)(W.Z,{children:e.map((e,a)=>(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,l.jsx)(u.Z,{sx:{padding:.5,border:"1px solid ".concat(tn),borderBottom:1==t&&"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:tc(e),userSelect:"none"},children:e.toFixed(2)})},a))},t)),j.map((e,t)=>(0,l.jsx)(W.Z,{children:e.map((e,a)=>(0,l.jsx)(Y.Z,{sx:{padding:0,border:0},onClick:()=>b(t,a),children:(0,l.jsx)(u.Z,{sx:m&&m.rowIndex===t&&m.colIndex===a?{...x.cell,...x.selectedCell,...to(e)}:{...x.cell,...to(e)},children:e.toFixed(3)})},a))},t))]})]})})})]})]})}var tu=function(e){let{factorNames:t,rowNames:a,selectedPlot2D:s,setSelectedPlot2D:r}=e,i=w(),{mdataType:o}=(0,n.tc)();return(0,l.jsxs)(u.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eP,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,x:e.value})),i({type:"set-selected-plot-2d-mofa",option:"x",value:e.value})},value:{label:"".concat(s.x),value:s.x},label:"X axis"})}),(0,l.jsx)(u.Z,{sx:{width:"25%"},children:(0,l.jsx)(eP,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,y:e.value})),i({type:"set-selected-plot-2d-mofa",option:"y",value:e.value})},value:{label:"".concat(s.y),value:s.y},label:"Y axis"})}),(0,l.jsx)(u.Z,{sx:{width:"40%"},children:(0,l.jsx)(eP,{options:[{label:"No color",value:"No color"},...a.filter(e=>"categorical"==o[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),i({type:"set-selected-plot-2d-mofa",option:"g",value:e.value})},value:{label:s.g,value:s.g},label:"Color by"})})]})},tx=function(e){let{scatterMode:t,setScatterMode:a,disable2D:s}=e,n=w();return(0,l.jsx)(u.Z,{sx:{textAlign:"center"},children:(0,l.jsx)(u.Z,{sx:{mb:2},children:(0,l.jsxs)(eE.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{a(e.target.value),n({type:"set-scatter-mode-mofa",mode:e.target.value})},"aria-label":"Platform",children:[(0,l.jsx)(eq.Z,{value:"1D",children:"1D"}),(0,l.jsx)(eq.Z,{value:"2D",disabled:s,children:"2D"})]})})})};let th=e=>{let{active:t,payload:a}=e;return t&&a&&a.length?(0,l.jsxs)(u.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,l.jsx)(x.Z,{variant:"h8",sx:{display:"block"},children:"".concat(a[0].payload.element)}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[0].name,": ").concat("string"==typeof a[0].value?a[0].value:a[0].value.toFixed(3))}),(0,l.jsx)(x.Z,{variant:"h9",sx:{display:"block"},children:"".concat(a[1].name,": ").concat(a[1].value.toFixed(3))})]}):null},tm=e=>{let{scatterRef:t}=e;return(0,l.jsx)(u.Z,{sx:{height:0},children:(0,l.jsx)(u.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,l.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),a=window.document.createElement("div");a.appendChild(e),(0,eQ.default)(a,"MOFA_Scatter")},sx:{opacity:.5},children:(0,l.jsx)(eS.Z,{})})})})};function tp(e){let t,{scatterData:a,mdataCol:r,Factor:i}=e,o=(0,s.useRef)(),c=(0,n.tc)().mdataType[r].type;return"categorical"==c&&(t="category"),"numeric"==c&&(t="number"),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(tm,{scatterRef:o}),(0,l.jsx)(eU.h,{width:"100%",height:400,children:(0,l.jsxs)(eY.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(em.q,{}),(0,l.jsx)(ep.K,{type:t,dataKey:"mdataValue",name:r,allowDuplicatedCategory:!1,children:(0,l.jsx)(eH._,{value:r,offset:-10,position:"insideBottom"})}),(0,l.jsx)(ej.B,{type:"number",dataKey:"projection",name:"".concat(i),children:(0,l.jsx)(eH._,{value:"".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(th,{})}),(0,l.jsx)(eW.b,{data:a,fill:"#8884d8"})]})})]})}function tj(e){let{scatterData:t,selectedPlot2D:a}=e,n=(0,s.useRef)();return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(tm,{scatterRef:n}),(0,l.jsx)(eU.h,{width:"100%",height:400,children:(0,l.jsxs)(eY.G,{ref:n,margin:{top:20,right:20,bottom:20,left:20},children:[(0,l.jsx)(em.q,{}),(0,l.jsx)(ep.K,{type:"number",dataKey:"x",name:"".concat(a.x),children:(0,l.jsx)(eH._,{value:"".concat(a.x),offset:-10,position:"insideBottom"})}),(0,l.jsx)(ej.B,{type:"number",dataKey:"y",name:"".concat(a.y),children:(0,l.jsx)(eH._,{value:"".concat(a.y),offset:20,position:"insideLeft",angle:-90})}),(0,l.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,l.jsx)(th,{})}),Object.keys(t).length>1&&(0,l.jsx)(eX.D,{verticalAlign:"top"}),Object.keys(t).map((e,a)=>(0,l.jsx)(eW.b,{data:t[e],fill:eb[a%eb.length],name:e},e))]})})]})}let tg=(e,t,a,l,s,n)=>{let r=null;if(a&&"1D"==t){r=[];let t=s.column(a.mdataCol),l={};t.index.map((e,a)=>{l[e]=t.values[a]}),Object.keys(e).map(t=>{r.push({element:t,mdataValue:l[t],projection:e[t][a.Factor]})})}else"2D"==t&&(r={},Object.keys(n).includes(l.g)?n[l.g].levels.map(t=>{r[t]=[...n[l.g].level2id[t].map(t=>Object.keys(e).includes(t)?{element:t,x:e[t][l.x],y:e[t][l.y]}:null).filter(e=>null!=e)]}):r[l.g]=Object.keys(e).map(t=>({element:t,x:e[t][l.x],y:e[t][l.y]})));return r};var tf=function(e){let{scatterMode:t,setScatterMode:a,selectedPlot:r,selectedPlot2D:i,setSelectedPlot2D:o,factorNames:c,rowNames:d,projections:h}=e,{mdata:m}=(0,n.tc)().user,{mdataType:p}=(0,n.tc)(),j=(0,s.useMemo)(()=>tg(h,t,r,i,m,p),[h,t,r,i,m,p]);return(0,l.jsxs)(ed.ZP,{container:!0,children:[(0,l.jsxs)(ed.ZP,{sx:{pt:2},item:!0,xs:6,children:[(0,l.jsx)(tx,{scatterMode:t,setScatterMode:a,disable2D:Object.keys(Object.values(h)[0]).length<2}),(0,l.jsx)(u.Z,{sx:{px:3,pt:7,textAlign:"center"},children:"1D"==t?(0,l.jsx)(u.Z,{sx:{height:75,pt:3},children:(0,l.jsx)(x.Z,{variant:"body1",children:"Select a pvalue cell to plot Factor"})}):(0,l.jsx)(tu,{factorNames:c,rowNames:d,selectedPlot2D:i,setSelectedPlot2D:o})})]}),(0,l.jsx)(ed.ZP,{item:!0,xs:6,children:j&&(0,l.jsx)(u.Z,{sx:{height:400},children:"1D"==t?(0,l.jsx)(tp,{scatterData:j,mdataCol:r.mdataCol,Factor:r.Factor}):(0,l.jsx)(tj,{scatterData:j,selectedPlot2D:i})})})]})},tb=a(33),tv=a(38227),ty=a(20003),tZ=a(27978),tC=a(19223);function tw(e){return"".concat(e)}var tA=function(e){let{omic:t,fLVec:a,nFeatRef:n,plotHeatMap:r}=e,[i,o]=(0,s.useState)({down:0,up:0}),[c,d]=(0,s.useState)({down:0,up:0});(0,s.useEffect)(()=>{let e={down:Math.floor(.01*a.length),up:Math.floor(.01*a.length)};d(e),n.current[t]=e,o({down:a[e.down][1],up:a[a.length-e.up-1][1]})},[a,n,t]),(0,s.useEffect)(()=>{let e=setTimeout(r,100);return()=>clearInterval(e)},[c,r]);let h=(0,s.useMemo)(()=>{let e=Math.min(200,a.length),t=Math.floor(a.length/e);return a.map(e=>({f:e[0],loading:Math.floor(1e4*e[1])/1e4,quantile:e[2]})).filter((e,l)=>l%t==0||l==a.length-1).map(e=>e.loading>i.down&&e.loading<i.up?{...e,qNS:e.quantile}:{...e,qS:e.quantile})},[a,i]),m=e=>{let[l,s]=e,r={down:Math.min(l,0),up:Math.max(s,0)};o(r);let i={down:a.filter(e=>e[1]<r.down).length,up:a.filter(e=>e[1]>r.up).length};d(i),n.current[t]=i},p=e=>{if(e<0){o(t=>({...t,down:e}));let l=a.filter(t=>t[1]<e).length;d(e=>({...e,down:l})),n.current[t].down=l}else{o(t=>({...t,up:e}));let l=a.filter(t=>t[1]>e).length;d(e=>({...e,up:l})),n.current[t].up=l}},j=(e,l)=>{let s=parseInt(e);if(isNaN(s)){d(e=>({...e,[l]:0}));return}if("down"==l){let e=a.filter(e=>e[1]<0);s>=0&&s<e.length?(n.current[t].down=s,d(e=>({...e,down:s})),o(t=>({...t,down:e[s][1]}))):s<0?(n.current[t].down=0,d(e=>({...e,down:0})),o(t=>({...t,down:e[0][1]}))):s>=e.length&&(n.current[t].down=e.length,d(t=>({...t,down:e.length})),o(e=>({...e,down:0})))}if("up"==l){let e=a.filter(e=>e[1]>0);s>0&&s<e.length?(n.current[t].up=s,d(e=>({...e,up:s})),o(t=>({...t,up:e[e.length-s][1]}))):s<=0?(n.current[t].up=0,d(e=>({...e,up:0})),o(t=>({...t,up:e[e.length-1][1]}))):s>=e.length&&(n.current[t].up=e.length,d(t=>({...t,up:e.length})),o(e=>({...e,up:0})))}},g=Math.ceil(1e3*Math.max(Math.abs(a[0][1]),Math.abs(a[a.length-1][1])))/1e3;return(0,l.jsx)(u.Z,{sx:{overflow:"auto"},children:(0,l.jsxs)(u.Z,{sx:{mt:1,display:"block",m:"auto",width:600},children:[(0,l.jsx)(u.Z,{sx:{width:600,position:"relative"},children:(0,l.jsxs)(tv.w,{data:h,margin:{top:5,right:30,left:20,bottom:20},width:600,height:200,onClick:e=>null!=e&&p(e.activeLabel),children:[(0,l.jsx)(em.q,{strokeDasharray:"3 3"}),(0,l.jsx)(ep.K,{dataKey:"loading",type:"number",name:"Loadings",domain:[-g,g],label:{value:"Loading",position:"insideBottom",offset:-10},ticks:ex(-g,g,6)}),(0,l.jsx)(ej.B,{type:"number",label:{value:"Quantile",position:"insideLeft",angle:-90,dy:30,offset:-5}}),(0,l.jsx)(ty.z,{x1:i.down,x2:i.up,y1:0,y2:1}),(0,l.jsx)(tZ.d,{x:0,stroke:"#333333",strokeDasharray:"3 3"}),(0,l.jsx)(tC.x,{type:"monotone",dataKey:"quantile",stroke:"#aaaaaa",dot:!1,strokeWidth:1}),(0,l.jsx)(tC.x,{type:"monotone",dataKey:"qS",stroke:"#8884d8",dot:!1,strokeWidth:3})]})}),(0,l.jsx)(u.Z,{sx:{width:490,position:"relative",left:80},children:(0,l.jsx)(tb.ZP,{track:"inverted",value:[i.down,i.up],getAriaValueText:tw,valueLabelDisplay:"auto",step:.001,min:-g,max:g,onChange:e=>m(e.target.value)})}),(0,l.jsxs)(u.Z,{sx:{width:490,position:"relative",left:80,display:"flex",textAlign:"center",justifyContent:"space-around"},children:[(0,l.jsxs)(u.Z,{sx:{width:"33%"},children:[(0,l.jsx)(x.Z,{variant:"body1",children:"Negatively Associated Features"}),(0,l.jsx)(en.Z,{size:"small",value:c.down,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>j(e.target.value,"down")})]}),(0,l.jsxs)(u.Z,{sx:{width:"33%"},children:[(0,l.jsx)(x.Z,{variant:"body1",children:"Positively Associated Features"}),(0,l.jsx)(en.Z,{size:"small",value:c.up,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>j(e.target.value,"up")})]})]})]})})},tP=function(e){let{fLVec:t,nFeatRef:a,plotHeatMap:s}=e;return(0,l.jsx)(ed.ZP,{sx:{mt:2},container:!0,children:["q","m"].map(e=>(0,l.jsxs)(ed.ZP,{item:!0,xs:6,children:[(0,l.jsx)(x.Z,{variant:"h6",sx:{textAlign:"center"},children:"q"==e?"Proteomics":"Metabolomics"}),(0,l.jsx)(tA,{omic:e,fLVec:t[e],nFeatRef:a,plotHeatMap:s})]},e))})},tk=a(63870);function tD(e){let{omic:t,myIndex:a,myFeat:r,mdataCol:i,updateZLegend:o,zLegend:c}=e,d=(0,n.tc)().norm["x".concat(t)],x=(0,n.tc)().mdataType[i],h=(0,s.useMemo)(()=>tS(a,r,d,x),[a,r,d,x]);return(0,s.useEffect)(()=>{let e=Object.keys(h).map(e=>h[e].data.map(e=>e.y)).flat();e.sort((e,t)=>e-t),o(a=>{a[t].min=Math.floor(Math.min(a[t].min,e[Math.floor(.1*e.length)])),a[t].max=Math.ceil(Math.max(a[t].max,e[Math.floor(.9*e.length)]))})},[h,t,o]),(0,l.jsx)(u.Z,{sx:{height:500,mx:.5,width:260},children:(0,l.jsx)(tk.Tu,{data:h,margin:{top:0,right:0,bottom:0,left:0},axisTop:{tickSize:0,tickPadding:0,tickRotation:0,legend:"",legendOffset:0},colors:{type:"diverging",scheme:"red_blue",minValue:c.min,maxValue:c.max},emptyColor:"#555555",isInteractive:!1,animate:!1,enableLabels:!1})})}let tM=e=>{let{myIndex:t,mdataCol:a}=e,r=(0,n.tc)().mdataType[a],i=(0,s.useMemo)(()=>tS(t,[],null,r),[t,r]);return(0,l.jsx)(u.Z,{sx:{height:500,mx:.5,width:"100%"},children:(0,l.jsx)(tk.Tu,{data:i,margin:{top:0,right:0,bottom:0,left:100},height:500,axisLeft:{tickSize:0,tickPadding:0,tickRotation:0,legend:"Samples",legendPosition:"middle",legendOffset:-80},isInteractive:!1,animate:!1,enableLabels:!1})})},tS=(e,t,a,l)=>{let s={};return e.map(e=>{s[e]=[]}),t.map(t=>{let l=a.column(t);l.index.map((e,t)=>[e,l.values[t]]).filter(t=>e.includes(t[0])).map(e=>{s[e[0]].push({x:t,y:-e[1]})})}),"categorical"==l.type?s=l.levels.map(t=>l.level2id[t].filter(t=>e.includes(t)).map(e=>({id:"".concat(e," | ").concat(t),data:s[e]}))).flat():"numeric"==l.type&&(s=e.map(e=>({id:e,data:s[e]}))),s};var tT=function(e){let{nFeatRef:t}=e;return(0,l.jsxs)(u.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,l.jsx)(u.Z,{sx:{width:"10%"}}),(0,l.jsx)(u.Z,{children:(t.current.q.up>0||t.current.q.down>0)&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{variant:"h6",children:"Proteomics"})}),(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.q.down>0&&(0,l.jsx)(u.Z,{sx:{width:260},children:"Negatively Associated"}),t.current.q.up>0&&(0,l.jsx)(u.Z,{sx:{width:260},children:"Positively Associated"})]})]})}),(0,l.jsx)(u.Z,{children:(t.current.m.up>0||t.current.m.down>0)&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{variant:"h6",children:"Metabolomics"})}),(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.m.down>0&&(0,l.jsx)(u.Z,{sx:{width:260},children:"Negatively Associated"}),t.current.m.up>0&&(0,l.jsx)(u.Z,{sx:{width:260},children:"Positively Associated"})]})]})})]})};let tN=e=>{let{a:t,b:a}=e,s=(t+a)/2,n={display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:"10px",background:"linear-gradient(to right, ".concat("#1f4e79",", ").concat("rgb(255, 255, 255)"," ").concat((s-t)/(a-t)*100,"%, ").concat("#9e2a2b",")"),color:"#fff",height:"15px"};return(0,l.jsxs)("div",{style:n,children:[(0,l.jsx)("div",{children:t}),(0,l.jsx)("div",{style:{color:"black"},children:s.toFixed(0)}),(0,l.jsx)("div",{children:a})]})};var tF=e=>{let{nFeatRef:t,zLegend:a}=e;return(0,l.jsxs)(u.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,l.jsx)(u.Z,{sx:{width:"10%"}}),(0,l.jsx)(u.Z,{sx:{mx:1},children:(t.current.q.up>0||t.current.q.down>0)&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(tN,{a:a.q.min,b:a.q.max}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{variant:"h6"})}),(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.q.down>0&&(0,l.jsx)(u.Z,{sx:{width:260}}),t.current.q.up>0&&(0,l.jsx)(u.Z,{sx:{width:260}})]})]})}),(0,l.jsx)(u.Z,{sx:{mx:1},children:(t.current.m.up>0||t.current.m.down>0)&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(tN,{a:a.m.min,b:a.m.max}),(0,l.jsx)(u.Z,{children:(0,l.jsx)(x.Z,{variant:"h6"})}),(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.m.down>0&&(0,l.jsx)(u.Z,{sx:{width:260}}),t.current.m.up>0&&(0,l.jsx)(u.Z,{sx:{width:260}})]})]})})]})},tO=function(e){let{nFeatRef:t,fLVec:a,mdataCol:r,plotHM:i}=e,[o,c]=(0,v.x)({q:{min:0,max:0},m:{min:0,max:0}});(0,s.useEffect)(()=>{c({q:{min:0,max:0},m:{min:0,max:0}})},[i,c]),console.log(o.q),console.log(o.m);let{xq:d,xm:x}=(0,n.tc)().user,h=d.index.filter(e=>x.index.includes(e));return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(tT,{nFeatRef:t}),(0,l.jsxs)(u.Z,{sx:{mt:1,display:"flex",justifyContent:"center"},children:[(0,l.jsx)(u.Z,{sx:{width:"10%"},children:(0,l.jsx)(tM,{myIndex:h,mdataCol:r})}),["q","m"].map(e=>(0,l.jsxs)(u.Z,{sx:{display:"flex",justifyContent:"center"},children:[t.current[e].down>0&&(0,l.jsx)(tD,{omic:e,myIndex:h,myFeat:a[e].filter((a,l)=>l<[t.current[e].down]).map(e=>e[0]),mdataCol:r,updateZLegend:c,zLegend:o[e]}),t.current[e].up>0&&(0,l.jsx)(tD,{omic:e,myIndex:h,myFeat:a[e].filter((l,s)=>s>=a[e].length-[t.current[e].up]).map(e=>e[0]),mdataCol:r,updateZLegend:c,zLegend:o[e]})]},e))]}),(0,l.jsx)(tF,{nFeatRef:t,zLegend:o})]})};let tI=e=>{if(null==e)return[void 0,void 0];let t=Object.keys(e.anova),a=t.map((e,t)=>t+1);return[a,t]},tE=(e,t)=>{if(null!=e)return Object.keys(e.anova[t[0]]).map(a=>[a,t.map(t=>0==Object.keys(e.anova[t][a]).length).every(e=>e)]).filter(e=>!e[1]).map(e=>e[0])},tq=(e,t)=>{if(null==e||null==t)return null;let a={q:[],m:[]};return Object.keys(a).map(l=>{a[l]=Object.keys(e.loadings[l][t.Factor]).map(a=>[a,e.loadings[l][t.Factor][a]]),a[l].sort((e,t)=>e[1]-t[1]),a[l]=a[l].map((e,t)=>[...e,(t+1)/a[l].length])}),a};var tR=function(){let e=w(),{API_URL:t}=(0,b.useVars)(),{jobID:a}=(0,n.tc)(),r=C().MOFA.data,[i,o]=(0,s.useState)(r),c=C().MOFA.displayOpts.scatterMode,[d,x]=(0,s.useState)(c),h=C().MOFA.displayOpts.selectedPlot,[m,p]=(0,s.useState)(h),j=C().MOFA.displayOpts.selectedPlot2D,[g,f]=(0,s.useState)(j),v=(0,s.useCallback)(async()=>{if(console.log("Fetching MOFA data"),null==r){let l=await fetch("".concat(t,"/get_mofa/").concat(a)),s=await l.json();o(s.dataMOFA),e({type:"set-mofa-data",data:s.dataMOFA})}},[r,t,e,a]);(0,s.useEffect)(()=>{v()},[v]);let[y,Z]=(0,s.useMemo)(()=>tI(i),[i]),A=(0,s.useMemo)(()=>tE(i,Z),[i,Z]),[P,k]=(0,s.useState)(!1),D=(0,s.useCallback)(()=>k(e=>!e),[]);(0,s.useEffect)(()=>{let e=setTimeout(D,100);return()=>clearInterval(e)},[m,D]);let M=(0,s.useRef)({q:{down:0,up:0},m:{down:0,up:0}}),S=(0,s.useMemo)(()=>tq(i,m),[i,m]);return(0,l.jsx)(u.Z,{children:(0,l.jsx)(eO,{height:"80vh",children:null!=i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eF,{children:(0,l.jsx)(u.Z,{sx:{p:5},children:(0,l.jsx)(td,{anova:i.anova,explained_variance:i.explained_variance,setSelectedPlot:p,scatterMode:d,rowNames:A,colNames:y,factorNames:Z})})}),(0,l.jsxs)(eF,{children:[(0,l.jsx)(ts.Z,{children:"Projections"}),(0,l.jsx)(u.Z,{sx:{mt:2},children:(0,l.jsx)(tf,{scatterMode:d,setScatterMode:x,selectedPlot:m,selectedPlot2D:g,setSelectedPlot2D:f,rowNames:A,factorNames:Z,projections:i.projections})})]}),"1D"==d&&m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(eF,{sx:{mt:1},children:[(0,l.jsxs)(ts.Z,{variant:"h6",sx:{textAlign:"center"},children:["Feature Loading Analysis: ",m.Factor]}),(0,l.jsx)(tP,{fLVec:S,nFeatRef:M,plotHeatMap:D})]}),(0,l.jsxs)(eF,{children:[(0,l.jsx)(ts.Z,{children:"HeatMap"}),(0,l.jsx)(tO,{nFeatRef:M,fLVec:S,mdataCol:m.mdataCol,plotHM:P})]})]})]})})})};function tL(){let e=w(),{API_URL:t}=(0,b.useVars)(),a=(0,s.useRef)(),r=C().status,[i,o]=(0,s.useState)(r),c=C().value,[d,h]=(0,s.useState)(c),{jobID:m}=(0,n.tc)(),p=(0,s.useCallback)(async()=>{let l=await fetch("".concat(t,"/get_status/").concat(m)),s=await l.json();Object.keys(i).some(e=>i[e].status!=s[e].status)&&(console.log("Set status: ".concat(s)),o(s),e({type:"set-status",status:s})),Object.keys(s).map(e=>"waiting"!=s[e].status).every(e=>e)&&clearInterval(a.current)},[t,m,a,e,i]);return(0,s.useEffect)(()=>{if(console.log("useEffect: Check status"),Object.keys(r).some(e=>"waiting"==r[e].status))return console.log("useEffect: Initialize status fetching"),a.current=setInterval(p,2500),()=>clearInterval(a.current)},[a,p,r]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(x.Z,{variant:"body2",sx:{textAlign:"right",pr:4},children:["Job ID: ",m]}),(0,l.jsxs)(u.Z,{sx:{display:"flex",flexGrow:1,bgcolor:"background.paper"},children:[(0,l.jsx)(u.Z,{sx:{width:"15%",borderRight:1,borderColor:"divider"},children:(0,l.jsxs)(ei.Z,{orientation:"vertical",variant:"scrollable",value:d,onChange:(t,a)=>{h(a),e({type:"set-tab-value",value:a})},"aria-label":"Results Sections Tabs",sx:{width:"15%",position:"fixed"},children:[(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"EXPLORATORY DATA ANALYSIS",status:""}),value:.1,sx:{mt:2,p:0,color:0==Math.floor(d)?"#1976d2":"#00000099"}}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"DATA DISTRIBUTION",status:""}),value:.1,sx:{fontSize:12,m:0,p:0,borderTop:"1px solid #cccccc"}}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"PCA",status:i.EDA_PCA.status}),value:.2,sx:{fontSize:12,m:0,p:0,borderBottom:"1px solid #cccccc"},disabled:"ok"!=i.EDA_PCA.status}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"MULTIOMICS FACTOR ANALYSIS",status:i.MOFA.status}),value:1.1,sx:{fontSize:12,mt:2,p:0},disabled:"ok"!=i.MOFA.status}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"COMMUNITY ANALYSIS",status:""}),value:2.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"REGULARIZED CANONICAL CORRELATION ANALYSIS",status:""}),value:3.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"DIFFERENTIAL CORRELATION ANALYSIS",status:""}),value:4.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,l.jsx)(eo.Z,{label:(0,l.jsx)(tz,{text:"ELASTIC NET",status:""}),value:5.1,sx:{fontSize:12,mt:2,p:0},disabled:!0})]})}),(0,l.jsxs)(u.Z,{sx:{width:"85%",borderTop:"1px solid #cccccc"},children:[.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:(0,l.jsx)(eI,{})}),.2==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:(0,l.jsx)(ta,{})}),1.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:(0,l.jsx)(tR,{})}),2.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:"Community Analysis"}),3.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:"rCCA"}),4.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:"Differential Correlation Analysis"}),5.1==d&&(0,l.jsx)(u.Z,{sx:{p:1},children:"Elastic Net"})]})]})]})}let tz=e=>{let{text:t,status:a}=e;return(0,l.jsxs)(ed.ZP,{container:!0,sx:{m:"auto",height:55},children:["waiting"==a&&(0,l.jsx)(u.Z,{sx:{position:"absolute",height:"100%"},children:(0,l.jsx)(u.Z,{sx:{height:20,position:"relative",top:"35%",left:7},children:(0,l.jsx)(ec.Z,{sx:{verticalAlign:"middle",border:"0px solid red"},size:15,thickness:5})})}),(0,l.jsx)(x.Z,{sx:{m:"auto",width:"85%",fontSize:13,position:"relative",right:-12},children:t})]})};var tV=a(42834),t_=a(64173),tB=function(e){let{creatingJob:t,setCreatingJob:a,setPage:s}=e;return(0,l.jsx)(u.Z,{children:(0,l.jsxs)(I.Z,{open:"ask-annotations"==t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(E.Z,{id:"alert-dialog-title",children:"Obtain Putative Annotations from CMM & TurboPutative?"}),(0,l.jsx)(q.Z,{children:(0,l.jsxs)(t_.Z,{id:"alert-dialog-description",children:["Metabolomic features will be annotated using ",(0,l.jsx)("a",{target:"_blank",href:"http://ceumass.eps.uspceu.es/",children:"Ceu Mass Mediator"})," and simplified using ",(0,l.jsx)("a",{target:"_blank",href:"https://proteomics.cnic.es/TurboPutative/webserver",children:"TurboPutative"})," (not available yet)."]})}),(0,l.jsxs)(tV.Z,{sx:{border:"0px solid red"},children:[(0,l.jsx)(S.Z,{sx:{border:"0px solid blue",margin:"auto"},onClick:()=>{a(""),s("results")},children:"No"}),(0,l.jsx)(u.Z,{style:{margin:"auto",cursor:"not-allowed"},children:(0,l.jsx)(S.Z,{style:{color:"rgb(150,150,150)"},onClick:()=>{a("annotations-params")},children:"Yes"})})]})]})})},tJ=a(39350);function tK(e){let{creatingJob:t}=e,[a,r]=(0,s.useState)([{msg:"Sending data to server"}]),i=(0,s.useRef)(),{API_URL:o}=(0,b.useVars)(),{jobID:c}=(0,n.tc)();return(0,s.useEffect)(()=>(i.current=setInterval(async()=>{let e=await fetch("".concat(o,"/get_create_job_log/").concat(c)),t=await e.json();r(t)},2e3),()=>clearInterval(i.current)),[i,c,o]),(0,l.jsx)(u.Z,{children:(0,l.jsx)(tJ.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:"waiting"==t,children:(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(u.Z,{sx:{textAlign:"center"},children:(0,l.jsx)(ec.Z,{color:"inherit"})}),(0,l.jsx)(u.Z,{sx:{mt:2,textAlign:"center"},children:"This may take a while. Please be patient..."}),(0,l.jsx)(u.Z,{sx:{mt:0,textAlign:"center"},children:a[a.length-1].msg})]})})})}var tG=a(76500),tU=a(34989),tY=a(8088);let tH=s.forwardRef(function(e,t){return(0,l.jsx)(tY.Z,{direction:"up",ref:t,...e})});function tW(e){let{creatingJob:t,setCreatingJob:a}=e;return(0,l.jsx)("div",{children:(0,l.jsxs)(I.Z,{fullScreen:!0,open:"annotations-params"==t,TransitionComponent:tH,children:[(0,l.jsx)(tG.Z,{sx:{position:"relative",backgroundColor:"rgba(160, 0, 0, 1)"},children:(0,l.jsxs)(tU.Z,{children:[(0,l.jsx)(R.Z,{edge:"start",color:"inherit",onClick:()=>a("ask-annotations"),"aria-label":"close",children:(0,l.jsx)(z.Z,{})}),(0,l.jsx)(x.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Metabolomic Putative Annotations"})]})}),(0,l.jsx)(u.Z,{className:"m-2",children:(0,l.jsx)(tX,{})})]})})}let tX=()=>(0,l.jsx)(u.Z,{sx:{width:"100%"},children:"Annotations Params..."});function tQ(){let[e,t]=(0,s.useState)("new-job"),[a,r]=(0,s.useState)("");return(0,l.jsx)("div",{children:(0,l.jsx)(n.JV,{children:(0,l.jsxs)(A,{children:[(0,l.jsx)(F,{page:e,setPage:t,setCreatingJob:r}),"new-job"==e&&(0,l.jsxs)(i,{children:[(0,l.jsx)(es,{}),"waiting"==a&&(0,l.jsx)(tK,{creatingJob:a}),"ask-annotations"==a&&(0,l.jsx)(tB,{creatingJob:a,setCreatingJob:r,setPage:t}),"annotations-params"==a&&(0,l.jsx)(tW,{creatingJob:a,setCreatingJob:r})]}),"find-job"==e&&(0,l.jsx)(i,{children:(0,l.jsx)(er,{setPage:t})}),"results"==e&&(0,l.jsx)(i,{children:(0,l.jsx)(tL,{})})]})})})}},24983:function(e,t,a){"use strict";a.d(t,{JV:function(){return d},Lq:function(){return c},tc:function(){return o}});var l=a(57437),s=a(2265),n=a(36970);let r=(0,s.createContext)(null),i=(0,s.createContext)(null);function o(){return(0,s.useContext)(r)}function c(){return(0,s.useContext)(i)}function d(e){let{children:t}=e,[a,s]=(0,n.C)(u,x);return(0,l.jsx)(r.Provider,{value:a,children:(0,l.jsx)(i.Provider,{value:s,children:t})})}function u(e,t){switch(console.log("jobReducer called: ".concat(t.type)),console.log(t),t.type){case"find-job":return console.log("findJob"),t.results;case"user-upload":{let a=new dfd.DataFrame(t.dfJson);if(a.setIndex({column:a.columns[0],inplace:!0}),"xq"==t.fileType||"xm"==t.fileType){a.drop({columns:[a.columns[0]],inplace:!0});let l=a.isNa().sum({axis:0}).div(a.shape[0]),s=function(e,t,a){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof a)throw Error("All arguments must be numbers");if(e>t&&a>0)throw Error('The "step" value must be negative if "start" is greater than "end"');if(e<t&&a<0)throw Error('The "step" value must be positive if "start" is less than "end"');let l=[],s=e;for(;e<=t&&s<=t||e>=t&&s>=t;)l.push(s),s+=a;return l}(0,1.05,.05);s=s.map(e=>({MVThr:Math.round(100*e)/100,Features:l.le(e).sum()})),e.results.PRE.MV[t.fileType]=s}if("mdata"==t.fileType){let t=a.ctypes;t.values.map((l,s)=>{let n=t.index[s];if(l.includes("string"))e.mdataType[n]={type:"categorical"};else if(n.toLowerCase().includes("[categorical]")){let t=n.replace(/\[categorical\]/i,"");e.mdataType[t]={type:"categorical"},a.rename({[n]:t},{inplace:!0}),n=t}else l.includes("int")||l.includes("float")?e.mdataType[n]={type:"numeric"}:e.mdataType[n]={type:null};if("categorical"==e.mdataType[n].type){let t=new Set(a.column(n).values);t=(t=[...t]).filter(e=>null!=e),e.mdataType[n].nlevels=t.length,e.mdataType[n].levels=t,e.mdataType[n].level2id={},t.map(t=>{e.mdataType[n].level2id[t]=[]});let l=a.column(n);l.index.map((a,s)=>{t.includes(l.values[s])&&e.mdataType[n].level2id[l.values[s]].push(a)})}})}e.user[t.fileType]=a,e.userFileNames[t.fileType]=t.userFileName,e.index[t.fileType]=a.index;break}case"set-log":e.user[t.fileType].min().min()>0?e.results.PRE.log[t.fileType]=t.checked:alert("Logarithm cannot be calculated due to the presence of invalid values (<=0)");break;case"set-scale":e.results.PRE.scale[t.fileType]=t.checked;break;case"set-mv-thr":e.results.PRE.MVThr[t.fileType]=t.thr;break;case"set-mv-type":e.results.PRE.MVType[t.fileType]=t.MVType;break;case"set-annotations-mode":e.annotations.mode=t.mode;break;case"set-annotations-column":e.annotations.column=t.column;break;case"set-job-id":e.jobID=t.jobID;break;case"set-job-context":return t.jobContext}}let x={jobID:null,userFileNames:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},user:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},index:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},norm:{xq:null,xm:null},mdataType:{},annotations:{mode:0,column:null},results:{PRE:{log:{xq:!1,xm:!1},scale:{xq:!1,xm:!0},MV:{xq:null,xm:null},MVThr:{xq:.2,xm:.2},MVType:{xq:"KNN",xm:"KNN"}},EDA:null,MOFA:null,CORR:null,ML:null}}},93097:function(e,t,a){"use strict";let{default:l}=a(31863),s=async(e,t,a)=>{let s=e.container.firstChild.cloneNode(!0),n=t.firstChild.firstChild.firstChild,r=n.children[0].cloneNode(!0),i=n.children[2].cloneNode(!0),o=window.document.createElement("div");o.style.position="relative";let c=window.document.createElement("div");c.appendChild(s),c.style.paddingLeft="20px";let d=window.document.createElement("div");d.appendChild(r);let u=window.document.createElement("div");u.style.position="absolute",u.style.top="230px",u.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(u),l(o,"DataDistribution_".concat(a))};e.exports=s},31863:function(e,t,a){"use strict";function l(e,t){let a=new XMLSerializer().serializeToString(e),l=new Blob([a],{type:"image/svg+xml;charset=utf-8"});var s=URL.createObjectURL(l);let n=window.document.createElement("a");n.style="display:none",n.download="".concat(t),n.href=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),n.remove()}a.r(t),a.d(t,{default:function(){return l}})}},function(e){e.O(0,[683,400,971,596,744],function(){return e(e.s=19026)}),_N_E=e.O()}]);