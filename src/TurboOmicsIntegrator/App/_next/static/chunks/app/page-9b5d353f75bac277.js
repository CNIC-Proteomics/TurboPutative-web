(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{19026:function(e,t,l){Promise.resolve().then(l.bind(l,28325)),Promise.resolve().then(l.bind(l,17473)),Promise.resolve().then(l.bind(l,11093))},28325:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return x}});var a=l(57437),s=l(42824),n=l(57380),r=l(87550),i=l(57175),o=l(11093),c=l(16691),d=l.n(c);function x(){let e=(0,o.useVars)().BASE_URL;return(0,a.jsxs)(r.Z,{bg:"dark","data-bs-theme":"dark",className:"bg-body-tertiary",style:{fontSize:"1.2em"},children:[(0,a.jsxs)(s.Z,{className:"mx-0",children:[(0,a.jsx)(r.Z.Brand,{href:"#home",children:(0,a.jsx)(d(),{src:"".concat(e,"/icon.ico"),width:"30",height:"30",className:"d-inline-block align-top",alt:"TurboPutative"})}),(0,a.jsx)(r.Z.Toggle,{"aria-controls":"basic-navbar-nav"}),(0,a.jsx)(r.Z.Collapse,{id:"basic-navbar-nav",children:(0,a.jsxs)(n.Z,{className:"me-auto",children:[(0,a.jsx)(n.Z.Link,{href:"home",className:"mx-2",children:"Home"}),(0,a.jsx)(n.Z.Link,{href:"TurboOmicsApp.html",active:!0,className:"mx-2",children:"TurboOmics"}),(0,a.jsx)(n.Z.Link,{href:"webserver",className:"mx-2",children:"Web Server"}),(0,a.jsx)(n.Z.Link,{href:"webservices",className:"mx-2",children:"Web Services"}),(0,a.jsxs)(i.Z,{title:"Help",id:"basic-nav-dropdown",children:[(0,a.jsx)(i.Z.Item,{href:"webserverhelp",children:"Web Server"}),(0,a.jsx)(i.Z.Item,{href:"webserviceshelp",children:"Web Services"}),(0,a.jsx)(i.Z.Divider,{}),(0,a.jsx)(i.Z.Item,{href:"moduleshelp",children:"Modules"})]}),(0,a.jsx)(n.Z.Link,{href:"contactUs",className:"mx-2",children:"Contact us"})]})})]}),(0,a.jsx)(r.Z.Collapse,{className:"justify-content-end",children:(0,a.jsx)(r.Z.Brand,{href:"home",style:{fontSize:"1.2em"},children:"TurboPutative"})})]})}},11093:function(e,t,l){"use strict";l.r(t),l.d(t,{VarsProvider:function(){return r},useVars:function(){return i}});var a=l(57437),s=l(2265);let n=(0,s.createContext)({DEV_MODE:!1,BASE_URL:"/TurboPutative",API_URL:"https://proteomics.cnic.es/TurboPutative/api/tbomics"});function r(e){let{children:t}=e,l=i();return(0,a.jsx)(n.Provider,{value:l,children:t})}function i(){return(0,s.useContext)(n)}},17473:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return tQ}});var a=l(57437),s=l(2265),n=l(24983),r=l(59844);function i(e){let{children:t}=e;return(0,a.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{ease:"easeOut",duration:.5},children:t})}var o=l(49904),c=l(58991),d=l(62455),x=l(96507),u=l(43226),h=l(15133),p=l(35843);let m=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{width:110,height:70,textAlign:"center",backgroundColor:e,cursor:t?"not-allowed":"pointer",userSelect:"none",margin:"0px 15px"}},j=(0,p.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(204, 229, 255, 0.8)"}}});function g(e){let t,{children:l,text:s,id:r,setPage:i,page:o}=e,c=(0,n.tc)().jobID,d="results"==r&&null==c;t=d?"rgba(210,210,210,0.8)":o==r?"rgba(204, 229, 255, 0.8)":"rgba(255,255,255,1)";let p=m(t,d);return(0,a.jsx)(a.Fragment,{children:d?(0,a.jsxs)(h.Z,{sx:p,children:[(0,a.jsx)(x.Z,{sx:{py:1},children:l}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{gutterBottom:!0,variant:"h7",component:"div",children:s})})]}):(0,a.jsxs)(j,{sx:p,onClick:()=>i(r),children:[(0,a.jsx)(x.Z,{sx:{py:1},children:l}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{gutterBottom:!0,variant:"h7",component:"div",children:s})})]})})}var f=l(62970),b=l(11093),v=l(36970);let y=(0,s.createContext)(),Z=(0,s.createContext)();function C(){return(0,s.useContext)(y)}function w(){return(0,s.useContext)(Z)}function A(e){let{children:t}=e,[l,s]=(0,v.C)(P,k);return(0,a.jsx)(y.Provider,{value:l,children:(0,a.jsx)(Z.Provider,{value:s,children:t})})}function P(e,t){switch(console.log("Results object updated: ".concat(t.type)),console.log(t),t.type){case"reset-results":return k;case"set-status":e.status=t.status;break;case"set-tab-value":e.value=t.value;break;case"set-eda-dd-norm":e.EDA.DD.showNorm=t.showNorm;break;case"set-eda-dd-groupby":e.EDA.DD.groupby=t.groupby;break;case"set-eda-dd-filter":e.EDA.DD.filterCol[t.fileType]=t.filterCol;break;case"set-eda-dd-filter-text":e.EDA.DD.filterText[t.fileType]=t.filterText;break;case"set-eda-pca-data":e.EDA.PCA[t.omic].data=t.data;break;case"set-eda-pca-status":e.EDA.PCA[t.omic].status=t.status;break;case"set-scatter-mode":e.EDA.PCA[t.omic].displayOpts.scatterMode=t.mode;break;case"set-selected-plot-cell":e.EDA.PCA[t.omic].displayOpts.selectedCell={rowIndex:t.rowIndex,colIndex:t.colIndex},e.EDA.PCA[t.omic].displayOpts.selectedPlot={mdataCol:t.mdataCol,PCA:t.PCA};break;case"set-selected-plot-2d":e.EDA.PCA[t.omic].displayOpts.selectedPlot2D[t.option]=t.value;break;case"set-filter-col":e.EDA.PCA[t.omic].displayOpts.filterCol=t.value;break;case"set-mofa-data":e.MOFA.data=t.data;break;case"set-selected-plot-cell-mofa":e.MOFA.displayOpts.selectedCell={rowIndex:t.rowIndex,colIndex:t.colIndex},e.MOFA.displayOpts.selectedPlot={mdataCol:t.mdataCol,Factor:t.Factor};break;case"set-scatter-mode-mofa":e.MOFA.displayOpts.scatterMode=t.mode;break;case"set-selected-plot-2d-mofa":e.MOFA.displayOpts.selectedPlot2D[t.option]=t.value}}let k={value:.1,status:{EDA_PCA:{status:"waiting"},MOFA:{status:"waiting"}},EDA:{DD:{showNorm:!0,groupby:{label:"All values",value:"All values"},filterCol:{q2i:"All features",m2i:"All features"},filterText:{q2i:"",m2i:""}},PCA:{q:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"},displayOpts:{scatterMode:"1D",selectedPlot:null,selectedCell:null,selectedPlot2D:{x:1,y:2,g:"No color"},filterCol:"All features"}},m:{data:{projections:null,loadings:null,explained_variance:null,anova:null},status:{status:"waiting"},displayOpts:{scatterMode:"1D",selectedPlot:null,selectedCell:null,selectedPlot2D:{x:1,y:2,g:"No color"},filterCol:"All features"}}}},MOFA:{data:null,displayOpts:{selectedCell:null,selectedPlot:null,scatterMode:"1D",selectedPlot2D:{x:"Factor1",y:"Factor2",g:"No color"}}}},D=(0,p.ZP)(h.Z)(e=>{let{theme:t}=e;return{transition:"transform 0.15s ease-in-out, background 0.15s","&:hover":{transform:"scale3d(1.05, 1.05, 1)",backgroundColor:"rgba(255, 0, 0, 0.3)"}}});function M(e){let{setCreatingJob:t}=e,l=(0,n.Lq)(),s=w(),r=(0,n.tc)(),{DEV_MODE:i,API_URL:o}=(0,b.useVars)(),c=async()=>{t("waiting");let e=i?"123456":function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l="";for(let a=0;a<e;a++){let e=Math.floor(Math.random()*t.length);l+=t.charAt(e)}return l}(10);console.log("Creating job: ".concat(e)),l({type:"set-job-id",jobID:e});let a=await fetch("".concat(o,"/create_job"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...{...r,user:{xq:dfd.toJSON(r.user.xq),xm:dfd.toJSON(r.user.xm),mdata:dfd.toJSON(r.user.mdata),q2i:dfd.toJSON(r.user.q2i),m2i:dfd.toJSON(r.user.m2i)},norm:{xq:null,xm:null}},jobID:e})}),n=await a.json(),c={...n,user:{xq:new dfd.DataFrame(n.user.xq,{index:n.index.xq}),xm:new dfd.DataFrame(n.user.xm,{index:n.index.xm}),mdata:new dfd.DataFrame(n.user.mdata,{index:n.index.mdata}),q2i:new dfd.DataFrame(n.user.q2i,{index:n.index.q2i}),m2i:new dfd.DataFrame(n.user.m2i,{index:n.index.m2i})},norm:{xq:new dfd.DataFrame(n.norm.xq,{index:n.index.xq}),xm:new dfd.DataFrame(n.norm.xm,{index:n.index.xm})}};l({type:"set-job-context",jobContext:c}),s({type:"reset-results"}),t("ask-annotations")};return(0,a.jsxs)(D,{sx:{...m("rgba(255, 0, 0, 0.2)"),position:"absolute",right:"12%"},onClick:c,children:[(0,a.jsx)(x.Z,{sx:{py:1},children:(0,a.jsx)(f.Z,{})}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{gutterBottom:!0,variant:"h7",component:"div",children:"Create Job"})})]})}var S=l(35551),T=l(49381);function N(){let{API_URL:e}=(0,b.useVars)(),t=(0,n.Lq)(),l=async l=>{console.log("Loading sample data");let a=await fetch("".concat(e,"/load_sample_data")),s=await a.json();Object.keys(s).forEach(e=>{t({type:"user-upload",fileType:e,userFileName:"".concat(e,".tsv"),dfJson:s[e]})})};return(0,a.jsx)(x.Z,{sx:{alignSelf:"center",position:"absolute",left:"10%"},children:(0,a.jsx)(S.Z,{variant:"outlined",startIcon:(0,a.jsx)(T.Z,{}),onClick:l,children:"Load Sample Data"})})}function F(e){let{page:t,setPage:l,setCreatingJob:s}=e,{user:r}=(0,n.tc)();return(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:["new-job"==t&&(0,a.jsx)(N,{page:t}),(0,a.jsx)(g,{text:"New Job",id:"new-job",setPage:l,page:t,children:(0,a.jsx)(o.Z,{})}),(0,a.jsx)(g,{text:"Find Job",id:"find-job",setPage:l,page:t,children:(0,a.jsx)(c.Z,{})}),(0,a.jsx)(g,{text:"Results",id:"results",setPage:l,page:t,children:(0,a.jsx)(d.Z,{})}),"new-job"==t&&r.mdata&&r.xm&&r.m2i&&r.xq&&r.q2i&&(0,a.jsx)(i,{children:(0,a.jsx)(M,{setCreatingJob:s})})]})}var O=l(11922),I=l(89394),E=l(91797),q=l(26337),R=l(52653),L=l(6252),z=l(33533);l(16691);let V=(0,p.ZP)(I.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function _(e){let{title:t}=e,[l,n]=(0,s.useState)(!1),r=()=>n(!1),i=(0,b.useVars)().BASE_URL;return(0,a.jsxs)("div",{className:"mt-0 pt-0",children:[(0,a.jsx)(R.Z,{onClick:()=>n(!0),children:(0,a.jsx)(L.Z,{})}),(0,a.jsxs)(V,{onClose:r,"aria-labelledby":"customized-dialog-title",open:l,maxWidth:"md",children:[(0,a.jsxs)(E.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:[t," Table"]}),(0,a.jsx)(R.Z,{"aria-label":"close",onClick:r,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,a.jsx)(z.Z,{})}),(0,a.jsxs)(q.Z,{dividers:!0,children:[(0,a.jsx)(u.Z,{gutterBottom:!0,children:"Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1Paragraph 1"}),(0,a.jsx)(u.Z,{gutterBottom:!0,children:"Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2Paragraph 2"}),(0,a.jsx)("div",{className:"text-center mt-3",children:(0,a.jsx)("img",{src:"".concat(i,"/table.png"),alt:"Table"})})]})]})]})}let B=["","#N/A","#N/A","N/A","#NA","-1.#IND","-1.#QNAN","-NaN","-nan","1.#IND","1.#QNAN","<NA>","N/A","NA","NULL","NaN","None","n/a","nan","null"],J=["TSV"];function K(e){let{title:t,fileType:l}=e,s=(0,n.tc)().userFileNames[l],r=(0,n.Lq)();async function i(e){let t=await e.text(),a=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"	";return new Promise(l=>{let a=e.split(/[\r\n]+/);if(a.length<2)throw Error("String text does not have expected DataFrame format");let s=a[0].split(t).map(e=>e.trim()),n=[];for(let e=1;e<a.length;e++){let l=a[e].split(t).map(e=>e.trim());if(l.length===s.length){let e={};for(let t=0;t<s.length;t++)e[s[t]]=B.includes(l[t])?null:l[t];n.push(e)}else console.log(l),console.log("Row number ".concat(e," could not be read"))}l(n)})}(t);r({type:"user-upload",fileType:l,userFileName:e.name,dfJson:a})}return(0,a.jsx)("div",{className:"DragFile mx-2 text-center",style:{width:"30%"},children:(0,a.jsxs)(h.Z,{sx:{transition:"all 1s ease",backgroundColor:s?"rgba(220,220,220,0.5)":"rgba(250,250,250,0.5)"},children:[(0,a.jsx)(u.Z,{variant:"h6",className:"pt-2",children:t}),(0,a.jsx)(_,{title:t}),(0,a.jsx)(x.Z,{sx:{width:400,margin:"auto"},children:(0,a.jsx)(O.b,{multiple:!1,handleChange:i,name:l,types:J})}),(0,a.jsx)("p",{className:"mt-3",children:s?"File name: ".concat(s):"no files uploaded yet"})]})})}var G=l(73701),U=l(39279),Y=l(30666),H=l(15795),W=l(98489),X=l(29872),Q=l(39190);let $=(0,Q.Z)(Y.Z)(e=>{let{theme:t}=e;return{textAlign:"center"}});function ee(){let e=(0,n.tc)().results.PRE.MVThr.xq,t=(0,n.tc)().results.PRE.MVThr.xm,l=(0,n.tc)().user;return(0,a.jsx)(H.Z,{component:X.Z,sx:{width:300},children:(0,a.jsx)(G.Z,{size:"small","aria-label":"a dense table",children:(0,a.jsxs)(U.Z,{children:[null!=l.mdata&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(W.Z,{children:[(0,a.jsx)($,{children:"n"}),(0,a.jsx)($,{children:l.mdata.shape[0]})]}),(0,a.jsxs)(W.Z,{children:[(0,a.jsx)($,{children:"Meta-variables"}),(0,a.jsx)($,{children:l.mdata.shape[1]})]})]}),null!=l.xq&&(0,a.jsxs)(W.Z,{children:[(0,a.jsx)($,{children:"Proteomic features"}),(0,a.jsxs)($,{children:[l.xq.isNa().sum({axis:0}).div(l.xq.shape[0]).le(e).sum()," / ",l.xq.shape[1]]})]}),null!=l.xm&&(0,a.jsxs)(W.Z,{children:[(0,a.jsx)($,{children:"Metabolomic features"}),(0,a.jsxs)($,{children:[l.xm.isNa().sum({axis:0}).div(l.xm.shape[0]).le(t).sum()," / ",l.xm.shape[1]]})]})]})})})}var et=l(98864),el=l.n(et);let ea=el()(()=>l.e(508).then(l.bind(l,38508)),{loadableGenerated:{webpack:()=>[38508]},ssr:!1});function es(){return(0,a.jsxs)(x.Z,{sx:{width:"100%"},className:"p-2",children:[(0,a.jsxs)("div",{className:"py-2 d-flex justify-content-between",children:[(0,a.jsx)(K,{title:"Proteomic Metadata",fileType:"q2i"}),(0,a.jsx)(K,{title:"Metadata",fileType:"mdata"}),(0,a.jsx)(K,{title:"Metabolomic Metadata",fileType:"m2i"})]}),(0,a.jsxs)("div",{className:"py-2 d-flex justify-content-between align-items-center",children:[(0,a.jsx)(K,{title:"Proteomic Quantifications",fileType:"xq"}),(0,a.jsx)(ee,{}),(0,a.jsx)(K,{title:"Metabolomic Quantifications",fileType:"xm"})]}),(0,a.jsxs)(x.Z,{sx:{py:1,display:"flex",justifyContent:"space-around"},children:[(0,a.jsx)(ea,{fileType:"xq",omic:"Proteomic"}),(0,a.jsx)(x.Z,{sx:{width:"33%"}}),(0,a.jsx)(ea,{fileType:"xm",omic:"Metabolomic"})]})]})}var en=l(99960);function er(e){let{setPage:t}=e,[l,r]=(0,s.useState)(""),[i,o]=(0,s.useState)(!0),d=(0,n.Lq)(),x=(0,b.useVars)().API_URL;async function u(e){console.log("Search Job ID: ".concat(e));let l=await fetch("".concat(x,"/search/").concat(e)),a=await l.json();console.log("Server response received:"),a.exist?(d({type:"find-job",results:a.results}),t("results")):o(!1)}return(0,a.jsx)("div",{className:"mx-auto mt-4 text-center",children:(0,a.jsx)(en.Z,{id:"outlined-basic",label:"Search Job",variant:"outlined",onChange:e=>{r(e.target.value),o(!0)},value:l,InputProps:{endAdornment:(0,a.jsx)(()=>(0,a.jsx)(R.Z,{onClick:()=>u(l),children:(0,a.jsx)(c.Z,{})}),{})},sx:{width:"70%",marginTop:"20%"},autoFocus:!0,error:!i,helperText:!i&&"Job not found"})})}var ei=l(19045),eo=l(92277),ec=l(6882),ed=l(28874);function ex(e,t){let l=e.slice().sort((e,t)=>e-t),a=Math.floor(l.length*t),s=l[a];return s}function eu(e,t,l){let a=(t-e)/(l-1),s=[];for(let t=0;t<l;t++){let l=e+t*a;s.push(l)}return s.filter(e=>e<0).length>0&&s.filter(e=>e>0).length>0&&s.push(0),s.sort((e,t)=>e-t),s=s.map(e=>Math.floor(100*e)/100)}var eh=l(90045),ep=l(16573),em=l(24235),ej=l(50039),eg=l(2047),ef=l(51125);let eb=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function ev(e){let{dataHist:t,gValues:l,xrange:s,yrange:n,xTicks:r,histRef:i}=e;return(0,a.jsxs)(eh.T,{ref:i,style:{margin:"auto"},width:500,height:210,data:t,margin:{top:10,right:30,left:0,bottom:0},children:[(0,a.jsx)(ep.q,{strokeDasharray:"3 3"}),(0,a.jsx)(em.K,{dataKey:"binCenter",type:"number",ticks:r,domain:s}),(0,a.jsx)(ej.B,{domain:n}),(0,a.jsx)(eg.u,{}),l.map((e,t)=>(0,a.jsx)(ef.u,{connectNulls:!0,type:"monotone",dataKey:e,fillOpacity:.3,stroke:eb[t%eb.length],fill:eb[t%eb.length]},e))]})}let ey=el()(()=>Promise.all([l.e(934),l.e(901)]).then(l.bind(l,87022)),{loadableGenerated:{webpack:()=>[87022]},ssr:!1});function eZ(e){let{data:t,xrange:l,xTicks:s,boxRef:n}=e;return(0,a.jsx)(x.Z,{ref:n,children:(0,a.jsx)(ey,{style:{position:"relative",left:-20},data:t,layout:{width:570,height:280,showlegend:!0,legend:{orientation:"h"},xaxis:{zeroline:!1,range:l,tickvals:s},yaxis:{type:"category",showticklabels:!1},margin:{t:0}},config:{staticPlot:!0,displayModeBar:!1},onChange:e=>console.log(e)})})}function eC(e){let{fileType:t,filteredID:l,groupby:r,showNorm:o,histRef:c,boxRef:d}=e,u=(0,n.tc)().user.mdata,h={norm:(0,n.tc)().norm[t],user:(0,n.tc)().user[t]},p=o?h.norm:h.user,{myData:m,dataAnova:j,gValues:g,idx2g:f}=(0,s.useMemo)(()=>{let e;let t={};for(let e=0;e<u.shape[0];e++)u.columns.includes(r)?null!=u.column(r).values[e]&&(t[u.index[e]]=u.column(r).values[e]):t[u.index[e]]="All values";let a=Object.keys(t).map(e=>t[e]).filter((e,t,l)=>l.indexOf(e)===t),s=[],n={};a.map(e=>n[e]=[]);let i=(e={},dfd.toJSON(p).map((t,l)=>{e[p.index[l]]=t}),e);return Object.keys(i).map(e=>{Object.keys(t).includes(e)&&Object.keys(i[e]).map(a=>{null!=i[e][a]&&l.includes(a)&&(n[t[e]].push(i[e][a]),s.push({ID:e,feature:a,g:t[e],x:i[e][a]}))})}),{myData:n,dataAnova:s,gValues:a,idx2g:t}},[r,u,p,l]),{xrange:b,xTicks:v,minimum:y,maximum:Z}=(0,s.useMemo)(e=>{let t=Object.keys(m).map(e=>m[e]).flat(),l=ex(t,1e-4),a=ex(t,.9999),s=[l-Math.abs(.05*l),a+Math.abs(.05*a)],n=eu(l,a,6);return{xrange:s,xTicks:n,minimum:l,maximum:a}},[m]),{dataHist:C,yrange:w}=(0,s.useMemo)(()=>{let e={};Object.keys(m).map(t=>{e[t]=m[t].filter(e=>y<=e&&e<=Z)}),Object.keys(e).map(t=>{try{e[t].length>0?e[t]=function(e,t){let l=Math.min(...e),a=(Math.max(...e)-l)/t,s=Array(t).fill(0);e.forEach(e=>{let n=Math.floor((e-l)/a);n>=0&&n<t&&s[n]++});let n=s.map(t=>t/(e.length*a)),r=Array(t).fill(0).map((e,t)=>l+(t+.5)*a),i=[];for(let e=0;e<t;e++)i.push({binCenter:r[e],density:n[e]});return i}(e[t],1+Math.ceil(Math.log2(e[t].length))):delete e[t]}catch(e){console.error(e)}}),(e=(e=Object.keys(e).map(t=>e[t].map(e=>{let{binCenter:l,density:a}=e;return{binCenter:Math.round(100*l)/100,[t]:Number.parseFloat(a).toExponential(3),d:a}}))).flat()).sort((e,t)=>e.binCenter-t.binCenter);let t=Math.max(...e.map(e=>e.d)),l=[0,Number.parseFloat((1.05*t).toPrecision(2))];return{dataHist:e,yrange:l}},[m,y,Z]),A=(0,s.useMemo)(()=>Object.keys(m).map((e,t)=>m[e].length>0?{x:m[e],type:"box",name:"".concat(e),marker:{color:eb[t%eb.length]}}:null).filter(e=>null!=e),[m]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{sx:{height:210},children:(0,a.jsx)(ev,{dataHist:C,gValues:g,xrange:b,xTicks:v,yrange:w,histRef:c})}),(0,a.jsx)(x.Z,{sx:{height:280,width:500,margin:"auto",overflowX:"hidden",overflowY:"hidden"},children:(0,a.jsx)(i,{children:(0,a.jsx)(eZ,{data:A,xrange:b,xTicks:v,boxRef:d})})})]})}var ew=l(97472);function eA(e){let{options:t,handleSelect:l,label:n}=e,r=C().EDA.DD.groupby,i=w(),[o,c]=(0,s.useState)(r);return(0,s.useEffect)(()=>{i({type:"set-eda-dd-groupby",groupby:o})},[o,i]),(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:n}),(0,a.jsx)(ew.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:o,onChange:e=>{c({label:e.value,value:e.value}),setTimeout(()=>l(e),100)}})]})}function eP(e){let{options:t,value:l,onChange:s,label:n}=e;return(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("label",{id:"aria-label",htmlFor:"aria-example-input",children:n}),(0,a.jsx)(ew.ZP,{"aria-labelledby":"aria-label",inputId:"aria-example-input",className:"basic-single",classNamePrefix:"select",placeholder:"",isSearchable:!0,isClearable:!1,options:t,value:l,onChange:s})]})}var ek=l(43560);function eD(e){let{columns:t,data:l}=e,n=(0,s.useRef)(null),[r,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]);return(0,s.useEffect)(()=>{o(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=n.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,a.jsx)(i,{children:(0,a.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,a.jsx)(ek.P2,{columns:t,data:l,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:n,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}function eM(e){let{omic:t,fileType:l,setFilteredID:r,updatePlot:o}=e,c=C().EDA.DD.filterText[l],d=C().EDA.DD.filterCol[l],u=w(),[h,p]=(0,s.useState)(c),[m,j]=(0,s.useState)(d),g=(0,n.tc)().user[l],{filteredFeatures:f,columns:b}=(0,s.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:50}];return g.columns.includes(m)?(e=(e=(e=g.column(m)).values.map((t,l)=>({ID:e.index[l],[m]:t}))).filter(e=>null!=e[m]&&"".concat(e[m]).toLowerCase().includes(h.toLowerCase())),t.push({accessorKey:m,header:m,size:170})):e=(e=g.index).map((e,t)=>({ID:e})),{filteredFeatures:e,columns:t}},[h,m,g]);return(0,s.useEffect)(()=>{console.log("useEffect: Recalculating features");let e=setTimeout(()=>{r(e=>({...e,[l]:f.map(e=>e.ID)})),o([t]),console.log("Features recalculated")},500);return()=>clearTimeout(e)},[f,l,r,o,t]),(0,s.useEffect)(()=>{u({type:"set-eda-dd-filter",filterCol:m,fileType:l}),u({type:"set-eda-dd-filter-text",filterText:h,fileType:l})},[m,h,l,u]),(0,a.jsxs)(x.Z,{sx:{width:"95%",margin:"auto"},children:[(0,a.jsxs)(x.Z,{sx:{display:"flex",height:"10vh"},children:[(0,a.jsx)(x.Z,{sx:{width:"40%",pt:1},children:(0,a.jsx)(eP,{options:[{label:"All features",value:"All features"},...g.columns.map(e=>({label:e,value:e}))],onChange:e=>j(e.value),value:{label:m,value:m}})}),g.columns.includes(m)&&(0,a.jsx)(i,{children:(0,a.jsx)(x.Z,{sx:{mt:3,ml:3},children:(0,a.jsx)(en.Z,{id:"standard-name",placeholder:"Filter text",value:h,onChange:e=>p(e.target.value)})})})]}),(0,a.jsx)(x.Z,{sx:{mt:0},children:(0,a.jsx)(eD,{data:f,columns:b})})]})}var eS=l(89554),eT=l(93097),eN=l.n(eT);function eF(e){let{children:t,sx:l}=e;return(0,a.jsx)(x.Z,{sx:{...l},style:{scrollSnapAlign:"center",border:"0px solid yellow"},children:t})}function eO(e){let{children:t,height:l}=e;return(0,a.jsx)(x.Z,{sx:{height:{height:l},scrollSnapType:"y mandatory",overflow:"auto",border:"0px solid red"},children:t})}function eI(){let e=(0,s.useRef)(),t=(0,s.useRef)(),l=(0,s.useRef)(),r=(0,s.useRef)(),i=C().EDA.DD.showNorm,o=C().EDA.DD.groupby,[c,d]=(0,s.useState)({q:!1,m:!1}),[h,p]=(0,s.useState)({q2i:[],m2i:[]}),[m,j]=(0,s.useState)(i),[g,f]=(0,s.useState)(o),{mdataType:b}=(0,n.tc)(),v=(0,n.tc)().user.mdata.columns.map(e=>({label:e,value:e}));v=[{label:"All values",value:"All values"},...v=v.filter(e=>"categorical"==b[e.value].type)];let y=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["q","m"];e.map(e=>{d(t=>({...t,[e]:!1}))}),e.map(e=>setTimeout(()=>d(t=>({...t,[e]:!0})),300))},[]),Z=(0,s.useCallback)(e=>{f({label:e.value,value:e.value}),y(["q","m"])},[y]);return(0,s.useCallback)(e=>{j(e.target.checked),y(["q","m"])},[y]),(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)(ed.ZP,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",sx:{mb:3,mt:0},children:[!1,(0,a.jsx)(ed.ZP,{item:!0,xs:3,children:(0,a.jsx)(eA,{options:v,handleSelect:Z,label:"Group by"})})]}),(0,a.jsx)(eO,{height:"70vh",children:(0,a.jsx)(x.Z,{sx:{flexGrow:1,p:0,mt:0},children:(0,a.jsxs)(ed.ZP,{container:!0,direction:"row",justifyContent:"center",spacing:2,sx:{p:0},children:[(0,a.jsxs)(ed.ZP,{item:!0,sx:{borderRight:"1px solid #cccccc"},xs:6,children:[(0,a.jsxs)(eF,{children:[(0,a.jsxs)(u.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Proteomics",(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:l=>eN()(e.current,t.current,"Proteomics"),sx:{opacity:.5,visibility:c.q?"visible":"hidden",paddingBottom:1},children:(0,a.jsx)(eS.Z,{})})]}),c.q?(0,a.jsx)(x.Z,{sx:{height:550,overflowX:"auto"},children:(0,a.jsx)(eC,{fileType:"xq",filteredID:h.q2i,groupby:g.value,showNorm:m,histRef:e,boxRef:t})}):(0,a.jsx)(x.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,a.jsx)(ec.Z,{size:100,thickness:2})})]}),(0,a.jsx)(eF,{children:(0,a.jsx)(eM,{omic:"q",fileType:"q2i",setFilteredID:p,updatePlot:y})})]}),(0,a.jsxs)(ed.ZP,{item:!0,xs:6,sx:{borderLeft:"1px solid #cccccc"},children:[(0,a.jsxs)(eF,{children:[(0,a.jsxs)(u.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:["Metabolomics",(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:e=>eN()(l.current,r.current,"Metabolomics"),sx:{opacity:.5,visibility:c.m?"visible":"hidden",paddingBottom:1},children:(0,a.jsx)(eS.Z,{})})]}),c.m?(0,a.jsx)(x.Z,{sx:{height:550,overflowX:"auto"},children:(0,a.jsx)(eC,{fileType:"xm",filteredID:h.m2i,groupby:g.value,showNorm:m,histRef:l,boxRef:r})}):(0,a.jsx)(x.Z,{sx:{textAlign:"center",pt:20,height:"52vh"},children:(0,a.jsx)(ec.Z,{size:100,thickness:2})})]}),(0,a.jsx)(eF,{children:(0,a.jsx)(eM,{omic:"m",fileType:"m2i",setFilteredID:p,updatePlot:y})})]})]})})})]})}var eE=l(50817),eq=l(48389),eR=l(66988),eL=l(62254),ez=l(55183);let eV="rgba(200,200,200,0.5)",e_=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(eV),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV),"&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(eV)}}}),eB={textAlign:"center",padding:.5,border:"1px solid ".concat(eV),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},eJ=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),eK=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function eG(e){let{omic:t,data:l,rowNames:n,colNames:r,expVar:i,setSelectedPlot:o,scatterMode:c}=e,d=C().EDA.PCA[t].displayOpts.selectedCell,u=w(),h=e_(c),[p,m]=(0,s.useState)(d),j=(e,l)=>{"2D"!=c&&(m({rowIndex:e,colIndex:l}),o({mdataCol:n[e],PCA:r[l]}),u({omic:t,type:"set-selected-plot-cell",rowIndex:e,colIndex:l,mdataCol:n[e],PCA:r[l]}),console.log("Plot scatter: PCA ".concat(r[l]," vs ").concat(n[e])))},g=(0,s.useMemo)(()=>{let e=[];e.push(["PCA / Cond.",...r]),e.push(["%Variance",...i]);let t=l.map((e,t)=>[n[t],...e]);return[...e,...t]},[r,i,l,n]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,a.jsx)(ez.CSVLink,{data:g,filename:"PCA_Anova_pvalues.csv",separator:",",children:(0,a.jsx)(eL.Z,{})})})}),(0,a.jsxs)(ed.ZP,{container:!0,children:[(0,a.jsx)(ed.ZP,{item:!0,xs:2,children:(0,a.jsx)(H.Z,{sx:{margin:"auto"},children:(0,a.jsxs)(G.Z,{children:[(0,a.jsx)(eR.Z,{children:(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,textAlign:"center"},children:"PCA / Cond."})})}),(0,a.jsxs)(U.Z,{children:[(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsx)(x.Z,{sx:{...eB,borderBottom:"1px solid rgba(10,10,10,1)"},children:"%Variance"})})},"expVar"),n.map((e,t)=>(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsx)(x.Z,{sx:eB,children:e})})},t))]})]})})}),(0,a.jsx)(ed.ZP,{item:!0,xs:10,children:(0,a.jsx)(H.Z,{sx:{margin:"auto"},children:(0,a.jsxs)(G.Z,{children:[(0,a.jsx)(eR.Z,{children:(0,a.jsx)(W.Z,{children:l[0].map((e,t)=>(0,a.jsx)(Y.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:t+1},t))})}),(0,a.jsxs)(U.Z,{children:[(0,a.jsx)(W.Z,{children:i.map((e,t)=>(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsx)(x.Z,{sx:{padding:.5,border:"1px solid ".concat(eV),borderBottom:"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:eK(e),userSelect:"none"},children:e})},t))},"expVar"),l.map((e,t)=>(0,a.jsx)(W.Z,{children:e.map((e,l)=>(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},onClick:()=>j(t,l),children:(0,a.jsx)(x.Z,{sx:p&&p.rowIndex===t&&p.colIndex===l?{...h.cell,...h.selectedCell,...eJ(e)}:{...h.cell,...eJ(e)},children:e.toFixed(3)})},l))},t))]})]})})})]})]})}var eU=l(35048),eY=l(41125),eH=l(33343),eW=l(89366),eX=l(79857),eQ=l(31863);let e$=e=>{let{active:t,payload:l}=e;return t&&l&&l.length?(0,a.jsxs)(x.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,a.jsx)(u.Z,{variant:"h8",sx:{display:"block"},children:"".concat(l[0].payload.element)}),(0,a.jsx)(u.Z,{variant:"h9",sx:{display:"block"},children:"".concat(l[0].name,": ").concat("string"==typeof l[0].value?l[0].value:l[0].value.toFixed(3))}),(0,a.jsx)(u.Z,{variant:"h9",sx:{display:"block"},children:"".concat(l[1].name,": ").concat(l[1].value.toFixed(3))})]}):null},e0=e=>{let{scatterRef:t}=e;return(0,a.jsx)(x.Z,{sx:{height:0},children:(0,a.jsx)(x.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),l=window.document.createElement("div");l.appendChild(e),(0,eQ.default)(l,"PCA_Scatter")},sx:{opacity:.5},children:(0,a.jsx)(eS.Z,{})})})})};function e1(e){let t,{scatterData:l,mdataCol:r,PCA:i}=e,o=(0,s.useRef)(),c=(0,n.tc)().mdataType[r].type;return"categorical"==c&&(t="category"),"numeric"==c&&(t="number"),(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(e0,{scatterRef:o}),(0,a.jsx)(eU.h,{width:"100%",height:400,children:(0,a.jsxs)(eY.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,a.jsx)(ep.q,{}),(0,a.jsx)(em.K,{type:t,dataKey:"mdataValue",name:r,allowDuplicatedCategory:!1,children:(0,a.jsx)(eH._,{value:r,offset:-10,position:"insideBottom"})}),(0,a.jsx)(ej.B,{type:"number",dataKey:"projection",name:"PCA ".concat(i),children:(0,a.jsx)(eH._,{value:"PCA ".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,a.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,a.jsx)(e$,{})}),(0,a.jsx)(eW.b,{data:l,fill:"#8884d8"})]})})]})}function e2(e){let{scatterData:t,selectedPlot2D:l}=e,n=(0,s.useRef)();return(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(e0,{scatterRef:n}),(0,a.jsx)(eU.h,{width:"100%",height:400,children:(0,a.jsxs)(eY.G,{ref:n,margin:{top:20,right:20,bottom:20,left:20},children:[(0,a.jsx)(ep.q,{}),(0,a.jsx)(em.K,{type:"number",dataKey:"x",name:"PCA ".concat(l.x),children:(0,a.jsx)(eH._,{value:"PCA ".concat(l.x),offset:-10,position:"insideBottom"})}),(0,a.jsx)(ej.B,{type:"number",dataKey:"y",name:"PCA ".concat(l.y),children:(0,a.jsx)(eH._,{value:"PCA ".concat(l.y),offset:20,position:"insideLeft",angle:-90})}),(0,a.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,a.jsx)(e$,{})}),Object.keys(t).length>1&&(0,a.jsx)(eX.D,{verticalAlign:"top"}),Object.keys(t).map((e,l)=>(0,a.jsx)(eW.b,{data:t[e],fill:eb[l%eb.length],name:e},e))]})})]})}var e5=l(92069);function e3(e){let{omic:t,selectedLoadings:l,selectedPCA:r}=e,o=w(),{displayOpts:c}=C().EDA.PCA[t],[d,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(c.filterCol),m=(0,n.tc)().user["".concat(t,"2i")],{filteredFeatures:j,columns:g}=(0,s.useMemo)(()=>{console.log("calculating filteredFeatures");let e={},t=[{accessorKey:"ID",header:"ID",size:60},{accessorKey:"mdataValue",header:"",size:10},...r.map((e,t)=>({accessorKey:"PCA".concat(t),header:"Loadings PCA".concat(e),size:100}))];return m.columns.includes(h)?(e=(e=(e=m.column(h)).values.map((t,a)=>void 0==l[e.index[a]]?null:{ID:e.index[a],mdataValue:t,...l[e.index[a]].reduce((e,t,l)=>({...e,["PCA".concat(l)]:t}),{PCA0:l[e.index[a]][0]})}).filter(e=>null!=e)).filter(e=>null!=e.mdataValue&&"".concat(e.mdataValue).toLowerCase().includes(d.toLowerCase())),t[1].header=h,t[1].size=100):e=Object.keys(l).map((e,t)=>({ID:e,mdataValue:"",...l[e].reduce((e,t,l)=>({...e,["PCA".concat(l)]:t}),{PCA0:l[e][0]})})),{filteredFeatures:e,columns:t}},[l,d,h,m,r]);return(0,a.jsxs)(x.Z,{sx:{width:"95%",margin:"auto"},children:[(0,a.jsxs)(x.Z,{sx:{display:"flex",height:"10vh"},children:[(0,a.jsx)(x.Z,{sx:{mt:4,ml:0},children:(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:e=>e9(j,g),sx:{opacity:.5,color:"rgb(13,110,253)"},variant:"danger",children:(0,a.jsx)(eL.Z,{})})}),(0,a.jsx)(x.Z,{sx:{width:"40%",pt:1,ml:3},children:(0,a.jsx)(eP,{options:[{label:"All features",value:"All features"},...m.columns.map(e=>({label:e,value:e}))],onChange:e=>{p(e.value),o({type:"set-filter-col",value:e.value,omic:t})},value:{label:h,value:h}})}),m.columns.includes(h)&&(0,a.jsx)(i,{children:(0,a.jsx)(x.Z,{sx:{mt:3,ml:3},children:(0,a.jsx)(en.Z,{id:"standard-name",placeholder:"Filter text",value:d,onChange:e=>{u(e.target.value)}})})})]}),(0,a.jsx)(x.Z,{sx:{mt:0},children:(0,a.jsx)(e4,{data:j,columns:g})})]})}let e9=(e,t)=>{let l=(0,e5.iL)({useKeysAsHeaders:!0,filename:"PCA_Loading_Table"}),a=e.map(e=>{let l={};return t.map(t=>{""!=t.header&&(l[t.header]=e[t.accessorKey])}),l}),s=(0,e5.gB)(l)(a);(0,e5.LR)(l)(s)};function e4(e){let{columns:t,data:l}=e,n=(0,s.useRef)(null),[r,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]);return(0,s.useEffect)(()=>{o(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=n.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[c]),(0,a.jsx)(i,{children:(0,a.jsx)("div",{style:{opacity:.9,width:"100%",margin:"auto"},children:(0,a.jsx)(ek.P2,{columns:t,data:l,enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableColumnActions:!1,enableColumnFilters:!1,enableGlobalFilterModes:!1,enableFullScreenToggle:!1,enablePinning:!1,enablePagination:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"500px"}},onSortingChange:d,state:{isLoading:r,sorting:c},rowVirtualizerInstanceRef:n,rowVirtualizerProps:{overscan:1},columnVirtualizerProps:{overscan:2}})})})}var e8=function(e){let{pvColNames:t,pvRowNames:l,selectedPlot2D:s,setSelectedPlot2D:r,omic:i}=e,o=w(),{mdataType:c}=(0,n.tc)();return(0,a.jsxs)(x.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(x.Z,{sx:{width:"25%"},children:(0,a.jsx)(eP,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,x:e.value})),o({type:"set-selected-plot-2d",option:"x",value:e.value,omic:i})},value:{label:"PCA ".concat(s.x),value:s.x},label:"X axis"})}),(0,a.jsx)(x.Z,{sx:{width:"25%"},children:(0,a.jsx)(eP,{options:t.map(e=>({label:"PCA ".concat(e),value:e})),onChange:e=>{r(t=>({...t,y:e.value})),o({type:"set-selected-plot-2d",option:"y",value:e.value,omic:i})},value:{label:"PCA ".concat(s.y),value:s.y},label:"Y axis"})}),(0,a.jsx)(x.Z,{sx:{width:"40%"},children:(0,a.jsx)(eP,{options:[{label:"No color",value:"No color"},...l.filter(e=>"categorical"==c[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),o({type:"set-selected-plot-2d",option:"g",value:e.value,omic:i})},value:{label:s.g,value:s.g},label:"Color by"})})]})};function e6(e){let{title:t,omic:l}=e,r=(0,s.useRef)(null),{API_URL:i}=(0,b.useVars)(),o=w(),c=C().EDA.PCA[l].status,d=C().EDA.PCA[l].data,[h,p]=(0,s.useState)(c),[m,j]=(0,s.useState)(d),{projections:g,loadings:f,explained_variance:v,anova:y}=m,{mdata:Z}=(0,n.tc)().user,{mdataType:A}=(0,n.tc)(),{jobID:P}=(0,n.tc)(),{displayOpts:k}=C().EDA.PCA[l],[D,M]=(0,s.useState)(k.scatterMode),[S,T]=(0,s.useState)(k.selectedPlot),[N,F]=(0,s.useState)(k.selectedPlot2D),O=(0,s.useCallback)(async()=>{console.log("Fetching data");let e=await fetch("".concat(i,"/get_eda_pca/").concat(P,"/").concat(l)),{resStatus:t,dataPCA:a}=await e.json();console.log(t),"waiting"!=t.status&&(console.log("Status changed: ".concat(JSON.stringify(t))),j(a),p(t),o({type:"set-eda-pca-data",data:a,omic:l}),o({type:"set-eda-pca-status",status:t,omic:l}),clearInterval(r.current))},[i,P,l,o,r]);(0,s.useEffect)(()=>{if(console.log("useEffect to get data"),"waiting"==h.status)return console.log("Get data from server"),r.current=setInterval(O,2e3),()=>clearInterval(r.current)},[r,O,h.status]);let{pvTable:I,pvRowNames:E,pvColNames:q,pvExpVar:R}=(0,s.useMemo)(()=>e7(y,v,Z,h),[y,v,Z,h]),L=(0,s.useMemo)(()=>te(g,Z,A,S,N,h,D),[g,Z,A,S,N,h,D]),z=(0,s.useMemo)(()=>tt(f,S,N,h,D),[f,S,N,h,D]);return(0,a.jsx)(x.Z,{sx:{borderRight:"q"==l?"1px solid #cccccc":"0px"},children:"ok"==h.status?(0,a.jsxs)(x.Z,{sx:{padding:1},children:[(0,a.jsx)(eF,{children:(0,a.jsx)(x.Z,{sx:{pt:3},children:(0,a.jsx)(eG,{omic:l,data:I,rowNames:E,colNames:q,expVar:R,setSelectedPlot:T,scatterMode:D})})}),(0,a.jsxs)(eF,{children:[(0,a.jsx)(x.Z,{sx:{textAlign:"center",mt:2},children:(0,a.jsx)(x.Z,{sx:{mb:2},children:(0,a.jsxs)(eE.Z,{color:"primary",value:D,exclusive:!0,onChange:(e,t)=>{M(e.target.value),o({type:"set-scatter-mode",mode:e.target.value,omic:l})},"aria-label":"Platform",children:[(0,a.jsx)(eq.Z,{value:"1D",children:"1D"}),(0,a.jsx)(eq.Z,{value:"2D",children:"2D"})]})})}),(0,a.jsx)(x.Z,{sx:{textAlign:"center"},children:"1D"==D?(0,a.jsx)(x.Z,{sx:{height:75,pt:3},children:(0,a.jsx)(u.Z,{variant:"body1",children:"Select a pvalue cell to plot PCA"})}):(0,a.jsx)(e8,{pvColNames:q,pvRowNames:E,selectedPlot2D:N,setSelectedPlot2D:F,omic:l})}),L&&(0,a.jsx)(x.Z,{children:"1D"==D?(0,a.jsx)(e1,{scatterData:L,mdataCol:S.mdataCol,PCA:S.PCA}):(0,a.jsx)(e2,{scatterData:L,selectedPlot2D:N})})]}),z&&(0,a.jsx)(eF,{children:(0,a.jsx)(x.Z,{sx:{marginTop:5,textAlign:"center"},children:(0,a.jsx)(e3,{omic:l,selectedLoadings:z,selectedPCA:"1D"==D?[S.PCA]:[N.x,N.y]})})})]}):"waiting"==h.status?(0,a.jsx)(x.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:(0,a.jsx)(ec.Z,{size:100,thickness:2})}):"error"==h.status?(0,a.jsx)(x.Z,{sx:{textAlign:"center",pt:15,height:"30vh"},children:"An error occurred"}):void 0})}let e7=(e,t,l,a)=>{let s,n,r,i,o;if("ok"==a.status){s=l.columns.map(t=>Object.keys(e).map(l=>[t,parseInt(l),e[l][t]]));for(let e=0;e<s.length;e++)s[e].sort((e,t)=>e[1]-t[1]);r=(s=s.filter(e=>!e.map(e=>0==Object.keys(e[2]).length).every(e=>e))).map(e=>e[0][0]),i=s[0].map(e=>e[1]),n=s.map(e=>e.map(e=>e[2].pvalue)),o=Object.keys(t).map(e=>(100*t[e].Explained_Variance).toFixed(1))}return{pvTable:n,pvRowNames:r,pvColNames:i,pvExpVar:o}},te=(e,t,l,a,s,n,r)=>{let i=null;if("ok"==n.status&&"1D"==r&&a){let l=t.column(a.mdataCol);i=Object.keys(e).map(t=>({element:t,projection:e[t][a.PCA],mdataValue:l.values[l.index.indexOf(t)]}))}else"ok"==n.status&&"2D"==r&&s&&(Object.keys(l).includes(s.g)?(i={},l[s.g].levels.map(t=>{i[t]=[],l[s.g].level2id[t].map(l=>{Object.keys(e).includes(l)&&i[t].push({element:l,x:e[l][s.x],y:e[l][s.y]})})})):i={[s.g]:Object.keys(e).map(t=>({element:t,x:e[t][s.x],y:e[t][s.y]}))});return i},tt=(e,t,l,a,s)=>{let n=null;return"ok"==a.status&&"1D"==s&&t?(n={},Object.keys(e).map(l=>{n[l]=[parseFloat(e[l][t.PCA].toFixed(5))]})):"ok"==a.status&&"2D"==s&&(n={},Object.keys(e).map(t=>{n[t]=[parseFloat(e[t][l.x].toFixed(5)),parseFloat(e[t][l.y].toFixed(5))]})),n};function tl(){return(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)(ed.ZP,{container:!0,children:[(0,a.jsx)(ed.ZP,{item:!0,xs:6,children:(0,a.jsx)(ta,{children:"Proteomics"})}),(0,a.jsx)(ed.ZP,{item:!0,xs:6,children:(0,a.jsx)(ta,{children:"Metabolomics"})})]}),(0,a.jsx)(eO,{height:"75vh",children:(0,a.jsxs)(ed.ZP,{container:!0,children:[(0,a.jsx)(ed.ZP,{item:!0,xs:6,children:(0,a.jsx)(e6,{title:"Proteomics",omic:"q"})}),(0,a.jsx)(ed.ZP,{item:!0,xs:6,children:(0,a.jsx)(e6,{title:"Metabolomics",omic:"m"})})]})})]})}let ta=e=>{let{children:t}=e;return(0,a.jsx)(u.Z,{variant:"h6",sx:{textAlign:"center",color:"#555555"},children:t})};var ts=l(54986);let tn="rgba(200,200,200,0.5)",tr=e=>({cell:{transition:"background-color 0.3s, border-color 0.3s",border:"1px solid ".concat(tn),cursor:"1D"==e?"pointer":"",padding:.5,fontSize:15,textAlign:"center",userSelect:"none","&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn)}},selectedCell:{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn),"&:hover":{border:"1D"==e?"1px solid rgba(50,50,50,1)":"1px solid ".concat(tn)}}}),ti={textAlign:"center",padding:.5,border:"1px solid ".concat(tn),borderRight:"1px solid rgba(10,10,10,1)",fontSize:15,whiteSpace:"nowrap",userSelect:"none"},to=e=>({backgroundColor:e<.1?"rgba(".concat(2550*e,",").concat(200+550*e,",").concat(2550*e,", 0.5)"):"rgba(255,255,255,0.5)"}),tc=e=>({backgroundColor:"rgba(".concat(255,",").concat(255-255*e/100,",").concat(255-255*e/100,", 0.8)")});function td(e){let{anova:t,explained_variance:l,setSelectedPlot:n,scatterMode:r,factorNames:i,colNames:o,rowNames:c}=e,d=w(),u=tr(r),h=C().MOFA.displayOpts.selectedCell,[p,m]=(0,s.useState)(h),j=(0,s.useMemo)(()=>c.map(e=>i.map(l=>t[l][e].pvalue)),[t,c,i]),[g,f]=(0,s.useMemo)(()=>[i.map(e=>l.q[e].Explained_Variance),i.map(e=>l.m[e].Explained_Variance)],[l,i]),b=(e,t)=>{"2D"!=r&&(m({rowIndex:e,colIndex:t}),n({mdataCol:c[e],Factor:i[t]}),d({type:"set-selected-plot-cell-mofa",rowIndex:e,colIndex:t,mdataCol:c[e],Factor:i[t]}),console.log("Plot scatter: MOFA ".concat(i[t]," vs ").concat(c[e])))},v=(0,s.useMemo)(()=>{let e=[];e.push(["Factor / Cond.",...o]),e.push(["%Var (P)",...g]),e.push(["%Var (M)",...f]);let t=j.map((e,t)=>[c[t],...e]);return[...e,...t]},[o,g,f,j,c]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{sx:{height:0,width:50,zIndex:5e3,display:"flex",paddingLeft:.5},children:(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",sx:{opacity:.5,position:"relative",top:-21},children:(0,a.jsx)(ez.CSVLink,{data:v,filename:"MOFA_Anova_pvalues.csv",separator:",",children:(0,a.jsx)(eL.Z,{})})})}),(0,a.jsxs)(ed.ZP,{container:!0,children:[(0,a.jsx)(ed.ZP,{item:!0,xs:2,children:(0,a.jsx)(H.Z,{sx:{margin:"auto"},children:(0,a.jsxs)(G.Z,{children:[(0,a.jsx)(eR.Z,{children:(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,textAlign:"center"},children:"Factor / Cond."})})}),(0,a.jsxs)(U.Z,{children:[["P","M"].map(e=>(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsxs)(x.Z,{sx:{...ti,borderBottom:"M"==e&&"1px solid rgba(10,10,10,1)"},children:["%Var (",e,")"]})})},e)),c.map((e,t)=>(0,a.jsx)(W.Z,{children:(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsx)(x.Z,{sx:ti,children:e})})},t))]})]})})}),(0,a.jsx)(ed.ZP,{item:!0,xs:10,children:(0,a.jsx)(H.Z,{sx:{margin:"auto"},children:(0,a.jsxs)(G.Z,{children:[(0,a.jsx)(eR.Z,{children:(0,a.jsx)(W.Z,{children:o.map((e,t)=>(0,a.jsx)(Y.Z,{sx:{padding:0,textAlign:"center",width:50,userSelect:"none"},children:e},t))})}),(0,a.jsxs)(U.Z,{children:[[g,f].map((e,t)=>(0,a.jsx)(W.Z,{children:e.map((e,l)=>(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},children:(0,a.jsx)(x.Z,{sx:{padding:.5,border:"1px solid ".concat(tn),borderBottom:1==t&&"1px solid rgba(10,10,10,1)",fontSize:15,textAlign:"center",backgroundColor:tc(e),userSelect:"none"},children:e.toFixed(2)})},l))},t)),j.map((e,t)=>(0,a.jsx)(W.Z,{children:e.map((e,l)=>(0,a.jsx)(Y.Z,{sx:{padding:0,border:0},onClick:()=>b(t,l),children:(0,a.jsx)(x.Z,{sx:p&&p.rowIndex===t&&p.colIndex===l?{...u.cell,...u.selectedCell,...to(e)}:{...u.cell,...to(e)},children:e.toFixed(3)})},l))},t))]})]})})})]})]})}var tx=function(e){let{factorNames:t,rowNames:l,selectedPlot2D:s,setSelectedPlot2D:r}=e,i=w(),{mdataType:o}=(0,n.tc)();return(0,a.jsxs)(x.Z,{sx:{height:75,display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(x.Z,{sx:{width:"25%"},children:(0,a.jsx)(eP,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,x:e.value})),i({type:"set-selected-plot-2d-mofa",option:"x",value:e.value})},value:{label:"".concat(s.x),value:s.x},label:"X axis"})}),(0,a.jsx)(x.Z,{sx:{width:"25%"},children:(0,a.jsx)(eP,{options:t.map(e=>({label:e,value:e})),onChange:e=>{r(t=>({...t,y:e.value})),i({type:"set-selected-plot-2d-mofa",option:"y",value:e.value})},value:{label:"".concat(s.y),value:s.y},label:"Y axis"})}),(0,a.jsx)(x.Z,{sx:{width:"40%"},children:(0,a.jsx)(eP,{options:[{label:"No color",value:"No color"},...l.filter(e=>"categorical"==o[e].type).map(e=>({label:e,value:e}))],onChange:e=>{r(t=>({...t,g:e.value})),i({type:"set-selected-plot-2d-mofa",option:"g",value:e.value})},value:{label:s.g,value:s.g},label:"Color by"})})]})},tu=function(e){let{scatterMode:t,setScatterMode:l,disable2D:s}=e,n=w();return(0,a.jsx)(x.Z,{sx:{textAlign:"center"},children:(0,a.jsx)(x.Z,{sx:{mb:2},children:(0,a.jsxs)(eE.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{l(e.target.value),n({type:"set-scatter-mode-mofa",mode:e.target.value})},"aria-label":"Platform",children:[(0,a.jsx)(eq.Z,{value:"1D",children:"1D"}),(0,a.jsx)(eq.Z,{value:"2D",disabled:s,children:"2D"})]})})})};let th=e=>{let{active:t,payload:l}=e;return t&&l&&l.length?(0,a.jsxs)(x.Z,{className:"custom-tooltip",sx:{backgroundColor:"rgba(255,255,255,0.5)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,0.8)"},children:[(0,a.jsx)(u.Z,{variant:"h8",sx:{display:"block"},children:"".concat(l[0].payload.element)}),(0,a.jsx)(u.Z,{variant:"h9",sx:{display:"block"},children:"".concat(l[0].name,": ").concat("string"==typeof l[0].value?l[0].value:l[0].value.toFixed(3))}),(0,a.jsx)(u.Z,{variant:"h9",sx:{display:"block"},children:"".concat(l[1].name,": ").concat(l[1].value.toFixed(3))})]}):null},tp=e=>{let{scatterRef:t}=e;return(0,a.jsx)(x.Z,{sx:{height:0},children:(0,a.jsx)(x.Z,{sx:{width:50,position:"relative",top:5,zIndex:5e3},children:(0,a.jsx)(R.Z,{"aria-label":"download",size:"small",onClick:()=>{let e=t.current.container.cloneNode(!0),l=window.document.createElement("div");l.appendChild(e),(0,eQ.default)(l,"MOFA_Scatter")},sx:{opacity:.5},children:(0,a.jsx)(eS.Z,{})})})})};function tm(e){let t,{scatterData:l,mdataCol:r,Factor:i}=e,o=(0,s.useRef)(),c=(0,n.tc)().mdataType[r].type;return"categorical"==c&&(t="category"),"numeric"==c&&(t="number"),(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(tp,{scatterRef:o}),(0,a.jsx)(eU.h,{width:"100%",height:400,children:(0,a.jsxs)(eY.G,{ref:o,margin:{top:20,right:20,bottom:20,left:20},children:[(0,a.jsx)(ep.q,{}),(0,a.jsx)(em.K,{type:t,dataKey:"mdataValue",name:r,allowDuplicatedCategory:!1,children:(0,a.jsx)(eH._,{value:r,offset:-10,position:"insideBottom"})}),(0,a.jsx)(ej.B,{type:"number",dataKey:"projection",name:"".concat(i),children:(0,a.jsx)(eH._,{value:"".concat(i),offset:20,position:"insideLeft",angle:-90})}),(0,a.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,a.jsx)(th,{})}),(0,a.jsx)(eW.b,{data:l,fill:"#8884d8"})]})})]})}function tj(e){let{scatterData:t,selectedPlot2D:l}=e,n=(0,s.useRef)();return(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(tp,{scatterRef:n}),(0,a.jsx)(eU.h,{width:"100%",height:400,children:(0,a.jsxs)(eY.G,{ref:n,margin:{top:20,right:20,bottom:20,left:20},children:[(0,a.jsx)(ep.q,{}),(0,a.jsx)(em.K,{type:"number",dataKey:"x",name:"".concat(l.x),children:(0,a.jsx)(eH._,{value:"".concat(l.x),offset:-10,position:"insideBottom"})}),(0,a.jsx)(ej.B,{type:"number",dataKey:"y",name:"".concat(l.y),children:(0,a.jsx)(eH._,{value:"".concat(l.y),offset:20,position:"insideLeft",angle:-90})}),(0,a.jsx)(eg.u,{cursor:{strokeDasharray:"3 3"},content:(0,a.jsx)(th,{})}),Object.keys(t).length>1&&(0,a.jsx)(eX.D,{verticalAlign:"top"}),Object.keys(t).map((e,l)=>(0,a.jsx)(eW.b,{data:t[e],fill:eb[l%eb.length],name:e},e))]})})]})}let tg=(e,t,l,a,s,n)=>{let r=null;if(l&&"1D"==t){r=[];let t=s.column(l.mdataCol),a={};t.index.map((e,l)=>{a[e]=t.values[l]}),Object.keys(e).map(t=>{r.push({element:t,mdataValue:a[t],projection:e[t][l.Factor]})})}else"2D"==t&&(r={},Object.keys(n).includes(a.g)?n[a.g].levels.map(t=>{r[t]=[...n[a.g].level2id[t].map(t=>Object.keys(e).includes(t)?{element:t,x:e[t][a.x],y:e[t][a.y]}:null).filter(e=>null!=e)]}):r[a.g]=Object.keys(e).map(t=>({element:t,x:e[t][a.x],y:e[t][a.y]})));return r};var tf=function(e){let{scatterMode:t,setScatterMode:l,selectedPlot:r,selectedPlot2D:i,setSelectedPlot2D:o,factorNames:c,rowNames:d,projections:h}=e,{mdata:p}=(0,n.tc)().user,{mdataType:m}=(0,n.tc)(),j=(0,s.useMemo)(()=>tg(h,t,r,i,p,m),[h,t,r,i,p,m]);return(0,a.jsxs)(ed.ZP,{container:!0,children:[(0,a.jsxs)(ed.ZP,{sx:{pt:2},item:!0,xs:6,children:[(0,a.jsx)(tu,{scatterMode:t,setScatterMode:l,disable2D:Object.keys(Object.values(h)[0]).length<2}),(0,a.jsx)(x.Z,{sx:{px:3,pt:7,textAlign:"center"},children:"1D"==t?(0,a.jsx)(x.Z,{sx:{height:75,pt:3},children:(0,a.jsx)(u.Z,{variant:"body1",children:"Select a pvalue cell to plot Factor"})}):(0,a.jsx)(tx,{factorNames:c,rowNames:d,selectedPlot2D:i,setSelectedPlot2D:o})})]}),(0,a.jsx)(ed.ZP,{item:!0,xs:6,children:j&&(0,a.jsx)(x.Z,{sx:{height:400},children:"1D"==t?(0,a.jsx)(tm,{scatterData:j,mdataCol:r.mdataCol,Factor:r.Factor}):(0,a.jsx)(tj,{scatterData:j,selectedPlot2D:i})})})]})},tb=l(33),tv=l(38227),ty=l(20003),tZ=l(27978),tC=l(19223);function tw(e){return"".concat(e)}var tA=function(e){let{omic:t,fLVec:l,nFeatRef:n,plotHeatMap:r}=e,[i,o]=(0,s.useState)({down:0,up:0}),[c,d]=(0,s.useState)({down:0,up:0});(0,s.useEffect)(()=>{let e={down:Math.floor(.01*l.length),up:Math.floor(.01*l.length)};d(e),n.current[t]=e,o({down:l[e.down][1],up:l[l.length-e.up-1][1]})},[l,n,t]),(0,s.useEffect)(()=>{let e=setTimeout(r,100);return()=>clearInterval(e)},[c,r]);let h=(0,s.useMemo)(()=>{let e=Math.min(200,l.length),t=Math.floor(l.length/e);return l.map(e=>({f:e[0],loading:Math.floor(1e4*e[1])/1e4,quantile:e[2]})).filter((e,a)=>a%t==0||a==l.length-1).map(e=>e.loading>i.down&&e.loading<i.up?{...e,qNS:e.quantile}:{...e,qS:e.quantile})},[l,i]),p=e=>{let[a,s]=e,r={down:Math.min(a,0),up:Math.max(s,0)};o(r);let i={down:l.filter(e=>e[1]<r.down).length,up:l.filter(e=>e[1]>r.up).length};d(i),n.current[t]=i},m=e=>{if(e<0){o(t=>({...t,down:e}));let a=l.filter(t=>t[1]<e).length;d(e=>({...e,down:a})),n.current[t].down=a}else{o(t=>({...t,up:e}));let a=l.filter(t=>t[1]>e).length;d(e=>({...e,up:a})),n.current[t].up=a}},j=(e,a)=>{let s=parseInt(e);if(isNaN(s)){d(e=>({...e,[a]:0}));return}if("down"==a){let e=l.filter(e=>e[1]<0);s>=0&&s<e.length?(n.current[t].down=s,d(e=>({...e,down:s})),o(t=>({...t,down:e[s][1]}))):s<0?(n.current[t].down=0,d(e=>({...e,down:0})),o(t=>({...t,down:e[0][1]}))):s>=e.length&&(n.current[t].down=e.length,d(t=>({...t,down:e.length})),o(e=>({...e,down:0})))}if("up"==a){let e=l.filter(e=>e[1]>0);s>0&&s<e.length?(n.current[t].up=s,d(e=>({...e,up:s})),o(t=>({...t,up:e[e.length-s][1]}))):s<=0?(n.current[t].up=0,d(e=>({...e,up:0})),o(t=>({...t,up:e[e.length-1][1]}))):s>=e.length&&(n.current[t].up=e.length,d(t=>({...t,up:e.length})),o(e=>({...e,up:0})))}},g=Math.ceil(1e3*Math.max(Math.abs(l[0][1]),Math.abs(l[l.length-1][1])))/1e3;return(0,a.jsx)(x.Z,{sx:{overflow:"auto"},children:(0,a.jsxs)(x.Z,{sx:{mt:1,display:"block",m:"auto",width:600},children:[(0,a.jsx)(x.Z,{sx:{width:600,position:"relative"},children:(0,a.jsxs)(tv.w,{data:h,margin:{top:5,right:30,left:20,bottom:20},width:600,height:200,onClick:e=>null!=e&&m(e.activeLabel),children:[(0,a.jsx)(ep.q,{strokeDasharray:"3 3"}),(0,a.jsx)(em.K,{dataKey:"loading",type:"number",name:"Loadings",domain:[-g,g],label:{value:"Loading",position:"insideBottom",offset:-10},ticks:eu(-g,g,6)}),(0,a.jsx)(ej.B,{type:"number",label:{value:"Quantile",position:"insideLeft",angle:-90,dy:30,offset:-5}}),(0,a.jsx)(ty.z,{x1:i.down,x2:i.up,y1:0,y2:1}),(0,a.jsx)(tZ.d,{x:0,stroke:"#333333",strokeDasharray:"3 3"}),(0,a.jsx)(tC.x,{type:"monotone",dataKey:"quantile",stroke:"#aaaaaa",dot:!1,strokeWidth:1}),(0,a.jsx)(tC.x,{type:"monotone",dataKey:"qS",stroke:"#8884d8",dot:!1,strokeWidth:3})]})}),(0,a.jsx)(x.Z,{sx:{width:490,position:"relative",left:80},children:(0,a.jsx)(tb.ZP,{track:"inverted",value:[i.down,i.up],getAriaValueText:tw,valueLabelDisplay:"auto",step:.001,min:-g,max:g,onChange:e=>p(e.target.value)})}),(0,a.jsxs)(x.Z,{sx:{width:490,position:"relative",left:80,display:"flex",textAlign:"center",justifyContent:"space-around"},children:[(0,a.jsxs)(x.Z,{sx:{width:"33%"},children:[(0,a.jsx)(u.Z,{variant:"body1",children:"Negatively Associated Features"}),(0,a.jsx)(en.Z,{size:"small",value:c.down,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>j(e.target.value,"down")})]}),(0,a.jsxs)(x.Z,{sx:{width:"33%"},children:[(0,a.jsx)(u.Z,{variant:"body1",children:"Positively Associated Features"}),(0,a.jsx)(en.Z,{size:"small",value:c.up,inputProps:{min:0,style:{textAlign:"center",width:45,height:12}},onChange:e=>j(e.target.value,"up")})]})]})]})})},tP=function(e){let{fLVec:t,nFeatRef:l,plotHeatMap:s}=e;return(0,a.jsx)(ed.ZP,{sx:{mt:2},container:!0,children:["q","m"].map(e=>(0,a.jsxs)(ed.ZP,{item:!0,xs:6,children:[(0,a.jsx)(u.Z,{variant:"h6",sx:{textAlign:"center"},children:"q"==e?"Proteomics":"Metabolomics"}),(0,a.jsx)(tA,{omic:e,fLVec:t[e],nFeatRef:l,plotHeatMap:s})]},e))})},tk=l(63870);function tD(e){let{omic:t,myIndex:l,myFeat:r,mdataCol:i,updateZLegend:o,zLegend:c}=e,d=(0,n.tc)().norm["x".concat(t)],u=(0,n.tc)().mdataType[i],h=(0,s.useMemo)(()=>tS(l,r,d,u),[l,r,d,u]);return(0,s.useEffect)(()=>{let e=Object.keys(h).map(e=>h[e].data.map(e=>e.y)).flat();e.sort((e,t)=>e-t),o(l=>{l[t].min=Math.floor(Math.min(l[t].min,e[Math.floor(.1*e.length)])),l[t].max=Math.ceil(Math.max(l[t].max,e[Math.floor(.9*e.length)]))})},[h,t,o]),(0,a.jsx)(x.Z,{sx:{height:510,width:290,marginRight:.5,border:"2px solid #444444"},children:(0,a.jsx)(tk.Tu,{data:h,margin:{top:0,right:0,bottom:0,left:0},axisTop:{tickSize:0,tickPadding:0,tickRotation:0,legend:"",legendOffset:0},colors:{type:"diverging",scheme:"red_blue",minValue:c.min,maxValue:c.max},emptyColor:"#555555",isInteractive:!1,animate:!1,enableLabels:!1})})}let tM=e=>{let{myIndex:t,mdataCol:l}=e,r=(0,n.tc)().mdataType[l],i=(0,s.useMemo)(()=>tS(t,[],null,r),[t,r]),o=i.map(e=>e.id.split("##")).map(e=>e[e.length-1]);console.log(500/o.length);let c={};o.forEach(e=>{c[e]=(c[e]||0)+1});let d=[...new Set(o)];return(0,a.jsx)("table",{children:(0,a.jsx)("tbody",{children:d.map((e,t)=>(0,a.jsx)("tr",{style:{height:500*c[e]/o.length,borderTop:"2px solid #444444",borderBottom:"2px solid #444444"},children:(0,a.jsx)("td",{style:{paddingRight:5},children:(0,a.jsx)(u.Z,{variant:"h7",children:e})})},t))})})},tS=(e,t,l,a)=>{let s={};return e.map(e=>{s[e]=[]}),t.map(t=>{let a=l.column(t);a.index.map((e,t)=>[e,a.values[t]]).filter(t=>e.includes(t[0])).map(e=>{s[e[0]].push({x:t,y:-e[1]})})}),"categorical"==a.type?s=a.levels.map(t=>a.level2id[t].filter(t=>e.includes(t)).map(e=>({id:"".concat(e,"##").concat(t),data:s[e]}))).flat():"numeric"==a.type&&(s=e.map(e=>({id:e,data:s[e]}))),s};var tT=function(e){let{nFeatRef:t}=e;return(0,a.jsxs)(x.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,a.jsx)(x.Z,{sx:{width:"5%"}}),(0,a.jsx)(x.Z,{children:(t.current.q.up>0||t.current.q.down>0)&&(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{variant:"h6",children:"Proteomics"})}),(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.q.down>0&&(0,a.jsx)(x.Z,{sx:{width:290},children:"Negatively Associated"}),t.current.q.up>0&&(0,a.jsx)(x.Z,{sx:{width:290},children:"Positively Associated"})]})]})}),(0,a.jsx)(x.Z,{children:(t.current.m.up>0||t.current.m.down>0)&&(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{variant:"h6",children:"Metabolomics"})}),(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.m.down>0&&(0,a.jsx)(x.Z,{sx:{width:290},children:"Negatively Associated"}),t.current.m.up>0&&(0,a.jsx)(x.Z,{sx:{width:290},children:"Positively Associated"})]})]})})]})};let tN=e=>{let{a:t,b:l}=e,s=(t+l)/2,n={display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:"10px",background:"linear-gradient(to right, ".concat("#1f4e79",", ").concat("rgb(255, 255, 255)"," ").concat((s-t)/(l-t)*100,"%, ").concat("#9e2a2b",")"),color:"#fff",height:"15px"};return(0,a.jsxs)("div",{style:n,children:[(0,a.jsx)("div",{children:t}),(0,a.jsx)("div",{style:{color:"black"},children:s.toFixed(0)}),(0,a.jsx)("div",{children:l})]})};var tF=e=>{let{nFeatRef:t,zLegend:l}=e;return(0,a.jsxs)(x.Z,{sx:{mt:1,display:"flex",justifyContent:"center",textAlign:"center"},children:[(0,a.jsx)(x.Z,{sx:{width:"5%"}}),(0,a.jsx)(x.Z,{sx:{mx:1},children:(t.current.q.up>0||t.current.q.down>0)&&(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(tN,{a:l.q.min,b:l.q.max}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{variant:"h6"})}),(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.q.down>0&&(0,a.jsx)(x.Z,{sx:{width:290}}),t.current.q.up>0&&(0,a.jsx)(x.Z,{sx:{width:290}})]})]})}),(0,a.jsx)(x.Z,{sx:{mx:1},children:(t.current.m.up>0||t.current.m.down>0)&&(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(tN,{a:l.m.min,b:l.m.max}),(0,a.jsx)(x.Z,{children:(0,a.jsx)(u.Z,{variant:"h6"})}),(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[t.current.m.down>0&&(0,a.jsx)(x.Z,{sx:{width:290}}),t.current.m.up>0&&(0,a.jsx)(x.Z,{sx:{width:290}})]})]})})]})},tO=function(e){let{nFeatRef:t,fLVec:l,mdataCol:r,plotHM:i}=e,[o,c]=(0,v.x)({q:{min:0,max:0},m:{min:0,max:0}});(0,s.useEffect)(()=>{c({q:{min:0,max:0},m:{min:0,max:0}})},[i,c]);let{xq:d,xm:u}=(0,n.tc)().user,h=d.index.filter(e=>u.index.includes(e));return(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(tT,{nFeatRef:t}),(0,a.jsxs)(x.Z,{sx:{mt:1,display:"flex",justifyContent:"center"},children:[(0,a.jsxs)(x.Z,{sx:{width:"5%",display:"flex",justifyContent:"flex-end"},children:[!1,(0,a.jsx)(tM,{myIndex:h,mdataCol:r})]}),["q","m"].map(e=>(0,a.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"center"},children:[t.current[e].down>0&&(0,a.jsx)(tD,{omic:e,myIndex:h,myFeat:l[e].filter((l,a)=>a<[t.current[e].down]).map(e=>e[0]),mdataCol:r,updateZLegend:c,zLegend:o[e]}),t.current[e].up>0&&(0,a.jsx)(tD,{omic:e,myIndex:h,myFeat:l[e].filter((a,s)=>s>=l[e].length-[t.current[e].up]).map(e=>e[0]),mdataCol:r,updateZLegend:c,zLegend:o[e]})]},e))]}),(0,a.jsx)(tF,{nFeatRef:t,zLegend:o})]})};let tI=e=>{if(null==e)return[void 0,void 0];let t=Object.keys(e.anova),l=t.map((e,t)=>t+1);return[l,t]},tE=(e,t)=>{if(null!=e)return Object.keys(e.anova[t[0]]).map(l=>[l,t.map(t=>0==Object.keys(e.anova[t][l]).length).every(e=>e)]).filter(e=>!e[1]).map(e=>e[0])},tq=(e,t)=>{if(null==e||null==t)return null;let l={q:[],m:[]};return Object.keys(l).map(a=>{l[a]=Object.keys(e.loadings[a][t.Factor]).map(l=>[l,e.loadings[a][t.Factor][l]]),l[a].sort((e,t)=>e[1]-t[1]),l[a]=l[a].map((e,t)=>[...e,(t+1)/l[a].length])}),l};var tR=function(){let e=w(),{API_URL:t}=(0,b.useVars)(),{jobID:l}=(0,n.tc)(),r=C().MOFA.data,[i,o]=(0,s.useState)(r),c=C().MOFA.displayOpts.scatterMode,[d,u]=(0,s.useState)(c),h=C().MOFA.displayOpts.selectedPlot,[p,m]=(0,s.useState)(h),j=C().MOFA.displayOpts.selectedPlot2D,[g,f]=(0,s.useState)(j),v=(0,s.useCallback)(async()=>{if(console.log("Fetching MOFA data"),null==r){let a=await fetch("".concat(t,"/get_mofa/").concat(l)),s=await a.json();o(s.dataMOFA),e({type:"set-mofa-data",data:s.dataMOFA})}},[r,t,e,l]);(0,s.useEffect)(()=>{v()},[v]);let[y,Z]=(0,s.useMemo)(()=>tI(i),[i]),A=(0,s.useMemo)(()=>tE(i,Z),[i,Z]),P=(0,s.useRef)({q:{down:0,up:0},m:{down:0,up:0}}),[k,D]=(0,s.useState)(!1),M=(0,s.useCallback)(()=>D(e=>!e),[]);(0,s.useEffect)(()=>{let e=setTimeout(M,100);return()=>clearInterval(e)},[p,M]);let S=(0,s.useMemo)(()=>tq(i,p),[i,p]);return(0,a.jsx)(x.Z,{children:(0,a.jsx)(eO,{height:"80vh",children:null!=i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eF,{children:(0,a.jsx)(x.Z,{sx:{p:5},children:(0,a.jsx)(td,{anova:i.anova,explained_variance:i.explained_variance,setSelectedPlot:m,scatterMode:d,rowNames:A,colNames:y,factorNames:Z})})}),(0,a.jsxs)(eF,{children:[(0,a.jsx)(ts.Z,{children:"Projections"}),(0,a.jsx)(x.Z,{sx:{mt:2},children:(0,a.jsx)(tf,{scatterMode:d,setScatterMode:u,selectedPlot:p,selectedPlot2D:g,setSelectedPlot2D:f,rowNames:A,factorNames:Z,projections:i.projections})})]}),"1D"==d&&p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eF,{sx:{mt:1},children:[(0,a.jsxs)(ts.Z,{variant:"h6",sx:{textAlign:"center"},children:["Feature Loading Analysis: ",p.Factor]}),(0,a.jsx)(tP,{fLVec:S,nFeatRef:P,plotHeatMap:M})]}),(0,a.jsxs)(eF,{children:[(0,a.jsx)(ts.Z,{children:"HeatMap"}),(0,a.jsx)(tO,{nFeatRef:P,fLVec:S,mdataCol:p.mdataCol,plotHM:k})]})]})]})})})};function tL(){let e=w(),{API_URL:t}=(0,b.useVars)(),l=(0,s.useRef)(),r=C().status,[i,o]=(0,s.useState)(r),c=C().value,[d,h]=(0,s.useState)(c),{jobID:p}=(0,n.tc)(),m=(0,s.useCallback)(async()=>{let a=await fetch("".concat(t,"/get_status/").concat(p)),s=await a.json();Object.keys(i).some(e=>i[e].status!=s[e].status)&&(console.log("Set status: ".concat(s)),o(s),e({type:"set-status",status:s})),Object.keys(s).map(e=>"waiting"!=s[e].status).every(e=>e)&&clearInterval(l.current)},[t,p,l,e,i]);return(0,s.useEffect)(()=>{if(console.log("useEffect: Check status"),Object.keys(r).some(e=>"waiting"==r[e].status))return console.log("useEffect: Initialize status fetching"),l.current=setInterval(m,2500),()=>clearInterval(l.current)},[l,m,r]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.Z,{variant:"body2",sx:{textAlign:"right",pr:4},children:["Job ID: ",p]}),(0,a.jsxs)(x.Z,{sx:{display:"flex",flexGrow:1,bgcolor:"background.paper"},children:[(0,a.jsx)(x.Z,{sx:{width:"15%",borderRight:1,borderColor:"divider"},children:(0,a.jsxs)(ei.Z,{orientation:"vertical",variant:"scrollable",value:d,onChange:(t,l)=>{h(l),e({type:"set-tab-value",value:l})},"aria-label":"Results Sections Tabs",sx:{width:"15%",position:"fixed"},children:[(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"EXPLORATORY DATA ANALYSIS",status:""}),value:.1,sx:{mt:2,p:0,color:0==Math.floor(d)?"#1976d2":"#00000099"}}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"DATA DISTRIBUTION",status:""}),value:.1,sx:{fontSize:12,m:0,p:0,borderTop:"1px solid #cccccc"}}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"PCA",status:i.EDA_PCA.status}),value:.2,sx:{fontSize:12,m:0,p:0,borderBottom:"1px solid #cccccc"},disabled:"ok"!=i.EDA_PCA.status}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"MULTIOMICS FACTOR ANALYSIS",status:i.MOFA.status}),value:1.1,sx:{fontSize:12,mt:2,p:0},disabled:"ok"!=i.MOFA.status}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"COMMUNITY ANALYSIS",status:""}),value:2.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"REGULARIZED CANONICAL CORRELATION ANALYSIS",status:""}),value:3.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"DIFFERENTIAL CORRELATION ANALYSIS",status:""}),value:4.1,sx:{fontSize:12,mt:2,p:0},disabled:!0}),(0,a.jsx)(eo.Z,{label:(0,a.jsx)(tz,{text:"ELASTIC NET",status:""}),value:5.1,sx:{fontSize:12,mt:2,p:0},disabled:!0})]})}),(0,a.jsxs)(x.Z,{sx:{width:"85%",borderTop:"1px solid #cccccc"},children:[.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:(0,a.jsx)(eI,{})}),.2==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:(0,a.jsx)(tl,{})}),1.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:(0,a.jsx)(tR,{})}),2.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:"Community Analysis"}),3.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:"rCCA"}),4.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:"Differential Correlation Analysis"}),5.1==d&&(0,a.jsx)(x.Z,{sx:{p:1},children:"Elastic Net"})]})]})]})}let tz=e=>{let{text:t,status:l}=e;return(0,a.jsxs)(ed.ZP,{container:!0,sx:{m:"auto",height:55},children:["waiting"==l&&(0,a.jsx)(x.Z,{sx:{position:"absolute",height:"100%"},children:(0,a.jsx)(x.Z,{sx:{height:20,position:"relative",top:"35%",left:7},children:(0,a.jsx)(ec.Z,{sx:{verticalAlign:"middle",border:"0px solid red"},size:15,thickness:5})})}),(0,a.jsx)(u.Z,{sx:{m:"auto",width:"85%",fontSize:13,position:"relative",right:-12},children:t})]})};var tV=l(42834),t_=l(64173),tB=function(e){let{creatingJob:t,setCreatingJob:l,setPage:s}=e;return(0,a.jsx)(x.Z,{children:(0,a.jsxs)(I.Z,{open:"ask-annotations"==t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,a.jsx)(E.Z,{id:"alert-dialog-title",children:"Obtain Putative Annotations from CMM & TurboPutative?"}),(0,a.jsx)(q.Z,{children:(0,a.jsxs)(t_.Z,{id:"alert-dialog-description",children:["Metabolomic features will be annotated using ",(0,a.jsx)("a",{target:"_blank",href:"http://ceumass.eps.uspceu.es/",children:"Ceu Mass Mediator"})," and simplified using ",(0,a.jsx)("a",{target:"_blank",href:"https://proteomics.cnic.es/TurboPutative/webserver",children:"TurboPutative"})," (not available yet)."]})}),(0,a.jsxs)(tV.Z,{sx:{border:"0px solid red"},children:[(0,a.jsx)(S.Z,{sx:{border:"0px solid blue",margin:"auto"},onClick:()=>{l(""),s("results")},children:"No"}),(0,a.jsx)(x.Z,{style:{margin:"auto",cursor:"not-allowed"},children:(0,a.jsx)(S.Z,{style:{color:"rgb(150,150,150)"},onClick:()=>{l("annotations-params")},children:"Yes"})})]})]})})},tJ=l(39350);function tK(e){let{creatingJob:t}=e,[l,r]=(0,s.useState)([{msg:"Sending data to server"}]),i=(0,s.useRef)(),{API_URL:o}=(0,b.useVars)(),{jobID:c}=(0,n.tc)();return(0,s.useEffect)(()=>(i.current=setInterval(async()=>{let e=await fetch("".concat(o,"/get_create_job_log/").concat(c)),t=await e.json();r(t)},2e3),()=>clearInterval(i.current)),[i,c,o]),(0,a.jsx)(x.Z,{children:(0,a.jsx)(tJ.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:"waiting"==t,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(x.Z,{sx:{textAlign:"center"},children:(0,a.jsx)(ec.Z,{color:"inherit"})}),(0,a.jsx)(x.Z,{sx:{mt:2,textAlign:"center"},children:"This may take a while. Please be patient..."}),(0,a.jsx)(x.Z,{sx:{mt:0,textAlign:"center"},children:l[l.length-1].msg})]})})})}var tG=l(76500),tU=l(34989),tY=l(8088);let tH=s.forwardRef(function(e,t){return(0,a.jsx)(tY.Z,{direction:"up",ref:t,...e})});function tW(e){let{creatingJob:t,setCreatingJob:l}=e;return(0,a.jsx)("div",{children:(0,a.jsxs)(I.Z,{fullScreen:!0,open:"annotations-params"==t,TransitionComponent:tH,children:[(0,a.jsx)(tG.Z,{sx:{position:"relative",backgroundColor:"rgba(160, 0, 0, 1)"},children:(0,a.jsxs)(tU.Z,{children:[(0,a.jsx)(R.Z,{edge:"start",color:"inherit",onClick:()=>l("ask-annotations"),"aria-label":"close",children:(0,a.jsx)(z.Z,{})}),(0,a.jsx)(u.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Metabolomic Putative Annotations"})]})}),(0,a.jsx)(x.Z,{className:"m-2",children:(0,a.jsx)(tX,{})})]})})}let tX=()=>(0,a.jsx)(x.Z,{sx:{width:"100%"},children:"Annotations Params..."});function tQ(){let[e,t]=(0,s.useState)("new-job"),[l,r]=(0,s.useState)("");return(0,a.jsx)("div",{children:(0,a.jsx)(n.JV,{children:(0,a.jsxs)(A,{children:[(0,a.jsx)(F,{page:e,setPage:t,setCreatingJob:r}),"new-job"==e&&(0,a.jsxs)(i,{children:[(0,a.jsx)(es,{}),"waiting"==l&&(0,a.jsx)(tK,{creatingJob:l}),"ask-annotations"==l&&(0,a.jsx)(tB,{creatingJob:l,setCreatingJob:r,setPage:t}),"annotations-params"==l&&(0,a.jsx)(tW,{creatingJob:l,setCreatingJob:r})]}),"find-job"==e&&(0,a.jsx)(i,{children:(0,a.jsx)(er,{setPage:t})}),"results"==e&&(0,a.jsx)(i,{children:(0,a.jsx)(tL,{})})]})})})}},24983:function(e,t,l){"use strict";l.d(t,{JV:function(){return d},Lq:function(){return c},tc:function(){return o}});var a=l(57437),s=l(2265),n=l(36970);let r=(0,s.createContext)(null),i=(0,s.createContext)(null);function o(){return(0,s.useContext)(r)}function c(){return(0,s.useContext)(i)}function d(e){let{children:t}=e,[l,s]=(0,n.C)(x,u);return(0,a.jsx)(r.Provider,{value:l,children:(0,a.jsx)(i.Provider,{value:s,children:t})})}function x(e,t){switch(console.log("jobReducer called: ".concat(t.type)),console.log(t),t.type){case"find-job":return console.log("findJob"),t.results;case"user-upload":{let l=new dfd.DataFrame(t.dfJson);if(l.setIndex({column:l.columns[0],inplace:!0}),"xq"==t.fileType||"xm"==t.fileType){l.drop({columns:[l.columns[0]],inplace:!0});let a=l.isNa().sum({axis:0}).div(l.shape[0]),s=function(e,t,l){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof l)throw Error("All arguments must be numbers");if(e>t&&l>0)throw Error('The "step" value must be negative if "start" is greater than "end"');if(e<t&&l<0)throw Error('The "step" value must be positive if "start" is less than "end"');let a=[],s=e;for(;e<=t&&s<=t||e>=t&&s>=t;)a.push(s),s+=l;return a}(0,1.05,.05);s=s.map(e=>({MVThr:Math.round(100*e)/100,Features:a.le(e).sum()})),e.results.PRE.MV[t.fileType]=s}if("mdata"==t.fileType){let t=l.ctypes;t.values.map((a,s)=>{let n=t.index[s];if(a.includes("string"))e.mdataType[n]={type:"categorical"};else if(n.toLowerCase().includes("[categorical]")){let t=n.replace(/\[categorical\]/i,"");e.mdataType[t]={type:"categorical"},l.rename({[n]:t},{inplace:!0}),n=t}else a.includes("int")||a.includes("float")?e.mdataType[n]={type:"numeric"}:e.mdataType[n]={type:null};if("categorical"==e.mdataType[n].type){let t=new Set(l.column(n).values);t=(t=[...t]).filter(e=>null!=e),e.mdataType[n].nlevels=t.length,e.mdataType[n].levels=t,e.mdataType[n].level2id={},t.map(t=>{e.mdataType[n].level2id[t]=[]});let a=l.column(n);a.index.map((l,s)=>{t.includes(a.values[s])&&e.mdataType[n].level2id[a.values[s]].push(l)})}})}e.user[t.fileType]=l,e.userFileNames[t.fileType]=t.userFileName,e.index[t.fileType]=l.index;break}case"set-log":e.user[t.fileType].min().min()>0?e.results.PRE.log[t.fileType]=t.checked:alert("Logarithm cannot be calculated due to the presence of invalid values (<=0)");break;case"set-scale":e.results.PRE.scale[t.fileType]=t.checked;break;case"set-mv-thr":e.results.PRE.MVThr[t.fileType]=t.thr;break;case"set-mv-type":e.results.PRE.MVType[t.fileType]=t.MVType;break;case"set-annotations-mode":e.annotations.mode=t.mode;break;case"set-annotations-column":e.annotations.column=t.column;break;case"set-job-id":e.jobID=t.jobID;break;case"set-job-context":return t.jobContext}}let u={jobID:null,userFileNames:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},user:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},index:{xq:null,xm:null,mdata:null,q2i:null,m2i:null},norm:{xq:null,xm:null},mdataType:{},annotations:{mode:0,column:null},results:{PRE:{log:{xq:!1,xm:!1},scale:{xq:!1,xm:!0},MV:{xq:null,xm:null},MVThr:{xq:.2,xm:.2},MVType:{xq:"KNN",xm:"KNN"}},EDA:null,MOFA:null,CORR:null,ML:null}}},93097:function(e,t,l){"use strict";let{default:a}=l(31863),s=async(e,t,l)=>{let s=e.container.firstChild.cloneNode(!0),n=t.firstChild.firstChild.firstChild,r=n.children[0].cloneNode(!0),i=n.children[2].cloneNode(!0),o=window.document.createElement("div");o.style.position="relative";let c=window.document.createElement("div");c.appendChild(s),c.style.paddingLeft="20px";let d=window.document.createElement("div");d.appendChild(r);let x=window.document.createElement("div");x.style.position="absolute",x.style.top="230px",x.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(x),a(o,"DataDistribution_".concat(l))};e.exports=s},31863:function(e,t,l){"use strict";function a(e,t){let l=new XMLSerializer().serializeToString(e),a=new Blob([l],{type:"image/svg+xml;charset=utf-8"});var s=URL.createObjectURL(a);let n=window.document.createElement("a");n.style="display:none",n.download="".concat(t),n.href=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),n.remove()}l.r(t),l.d(t,{default:function(){return a}})}},function(e){e.O(0,[683,400,971,596,744],function(){return e(e.s=19026)}),_N_E=e.O()}]);