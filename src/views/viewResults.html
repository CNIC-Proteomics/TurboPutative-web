<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Results</title>

    <link href="/images/icon.ico" rel="icon">
    <link href="/assets/css/ubiquitous.css" rel="stylesheet">

    <!-- INSERT PARTIAL: ubiquitous/google_analytics_tag.html -->

    <!-- INSERT PARTIAL: ubiquitous/bootstrap_links.html -->

    <link href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/scroller/2.0.5/css/scroller.dataTables.min.css" rel="stylesheet">
    

    <script src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/scroller/2.0.5/js/dataTables.scroller.min.js"></script>

    <style>
        .nav-link {
            font-size: 1.2em;
        }
    </style>

</head>
<body>

    <div id="wrapper" class="d-flex flex-column min-vh-100">

        <!-- INSERT PARTIAL: ubiquitous/header.html -->

        <div class="card mx-4 my-2">

            <div class="card-header">
                <h5 class="card-title display-4">View Results</h5>
            </div>

            <div class="card-body">

                <ul class="nav nav-tabs" role="tablist">
                    <!-- INSERT VALUE: NavTab -->
                </ul>

                <div id="loading-element" class="text-center">
                    <div class="spinner-border text-danger m-5" id="loading-element" style="width:100px; height:100px;"></div>
                </div>
                <div id="table-content" class="mt-1">
                    <!-- INSERT VALUE: TabContent -->
                </div>
            </div>

        </div>

        <!-- INSERT PARTIAL: ubiquitous/footer.html -->

    </div>

</body>

<script>

    var jsonRows = {};
    $(document).ready( function () {

        

        var jobID = "/* INSERT VALUE: jobID */";

        const req = new XMLHttpRequest();
        req.responseType = "json";
        req.open('GET', `/viewresults/get/${jobID}`);
        req.onload = () => {
            jsonRows = req.response;

            for (key in jsonRows)
            {
                $(`#${key}`).DataTable( {
                    data:           jsonRows[key],
                    deferRender:    true,
                    scrollY:        500,
                    scrollX:        true,
                    scrollCollapse: true,
                    scroller:       true,
                    } );
            }  


            $('#loading-element').hide();
            $('.table-selector')[0].click();
        }
        req.send();
    } );

    $('.table-selector').click( function() {
        $('.table-selector').removeClass('active');
        this.classList.add('active');
        $('.table-container').hide();
        $(`#div-${$(this).attr('target')}`).show();
        $(`#${$(this).attr('target')}`).DataTable().columns.adjust().draw();
    })

    
</script>

</html>