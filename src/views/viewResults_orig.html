<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Results</title>

    <link href="/images/icon.ico" rel="icon">
    <link href="/assets/css/ubiquitous.css" rel="stylesheet">

    <!-- INSERT PARTIAL: ubiquitous/google_analytics_tag.html -->

    <!-- INSERT PARTIAL: ubiquitous/bootstrap_links.html -->

    <link href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/scroller/2.0.5/css/scroller.dataTables.min.css" rel="stylesheet">
    

    <script src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/scroller/2.0.5/js/dataTables.scroller.min.js"></script>

    <style>
        .nav-link {
            font-size: 1.2em;
        }
    </style>

</head>
<body>

    <div id="wrapper" class="d-flex flex-column min-vh-100">

        <!-- INSERT PARTIAL: ubiquitous/header.html -->

        <div class="container-fluid m-3 px-5">

            <div class="card">

                <div class="card-header">
                    <h5 class="card-title display-4">View Results</h5>
                </div>

                <div class="card-body">

                    <ul class="nav nav-tabs" role="tablist">
                        <!-- INSERTVALUE: NavTab -->
                    </ul>
                    <br>
                    <!--<div class="tab-content">-->
                    <div class="main-container">
                        <div class="text-center">
                            <div class="spinner-border text-danger m-5" id="loading-element" style="width:100px; height:100px;"></div>
                        </div>
                        <div class="table-container" style="display:none;">
                            <!-- INSERT VALUE: TabContent -->
                        </div>
                    <!-- <div class="container-fluid" id="table-container"> -->
                        
                    </div>

                </div>

            </div>

        </div>


        <!-- INSERT PARTIAL: ubiquitous/footer.html -->

    </div>

</body>

<script>

    var jsonRows = {};
    $(document).ready( function () {

        

        var jobID = "/* INSERT VALUE: jobID */";

        const req = new XMLHttpRequest();
        req.responseType = "json";
        req.open('GET', `/viewresults/get/${jobID}`);
        req.onload = () => {
            jsonRows = req.response;
            console.log(req.response);
            $('table').DataTable( {

                data:           jsonRows['test'].slice(1,-1),
                deferRender:    true,
                scrollY:        200,
                scrollX:        true,
                scrollCollapse: true,
                scroller:       true,
            } );
            //document.querySelectorAll('.table-selector')[0].click();
            $('#loading-element').hide();
            $('.table-container').show();
            $('table').DataTable().columns.adjust().draw();

        }
        req.send();



        // Setup - add a text input to each footer cell
        /*$('table thead th').each( function () {
            var title = $(this).text();
            $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
        } );*/


        //$('table').DataTable( {
            //scrollX: "100%",
          //  searching: false,
            /*dom: 'Bfrtip',
            buttons: [
                'copyHtml5',
                'excelHtml5',
                'csvHtml5',
            ],*/
            /*deferRender: true,
            scrollY:        400,
            scrollCollapse: true,
            scroller:       true,*/

            // ScrollX without wrong alignemnt: http://sforsuresh.in/datatables-header-body-not-aligned/
            /*'initComplete': function (settings, json) {
                $('table').wrap("<div style='overflow:auto; width:100%; position:relative;'></div>");

                // Apply the search
                /*this.api().columns().every( function () {
                    var that = this;
    
                    $( 'input', this.footer() ).on( 'keyup change clear', function () {
                        if ( that.search() !== this.value ) {
                            that
                                .search( this.value )
                                .draw();
                        }
                    } );
                } );*/
            //}

        //} );


        //$('#loading-element').hide();
        //document.querySelector('#loading-element').style.display=""
        //document.querySelectorAll('.table-selector')[0].click();
        //$('table').DataTable().columns.adjust().draw();
    } );


    $('.table-selector').click(function () {
        $('table').DataTable().columns.adjust().draw();
    })

    
</script>

</html>